







# å®ä¹ é—®ç‚¹

## æ ‘ä¼˜

**é€‚é…å™¨ç›¸å…³**

```java
package com.soyotec.unixde.prm.core.service.adapter;

import com.soyotec.unixde.prm.common.enums.ProjectTypeEnum;
import com.soyotec.unixde.prm.common.vo.ProjectTaskExtensionBaseVO;
import com.soyotec.unixde.prm.core.service.NpmProjectTaskExtensionService;
import com.soyotec.unixde.uap.framework.exception.UnixdeException;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.collections4.MapUtils;
import org.apache.commons.lang3.StringUtils;
import org.springframework.stereotype.Service;

import javax.validation.constraints.NotNull;
import java.util.*;

/**
 * @author edward
 * @description
 * @date 2025/3/31
 */

@Slf4j
@Service
@RequiredArgsConstructor
public class NpmProjectTaskExtensionServiceAdapter {

    /** bean å‰ç¼€ */
    public static final String PREFIX = "taskExtension";

    /** å¸¦æ‰©å±•è¡¨çš„é¡¹ç›®ç§ç±»åˆ—è¡¨ */
    private final List<String> extensions = new ArrayList<>(
            Arrays.asList(ProjectTypeEnum.KSM.code(), ProjectTypeEnum.HUB.code())
    );

    private final Map<String, NpmProjectTaskExtensionService<?>> map;

    /**
     * è·å–æŒ‡å®šæœåŠ¡å®ä¾‹
     *
     * @param beanName æœåŠ¡åç§°
     * @return æœåŠ¡å®ä¾‹
     * @author edward
     */
    @SuppressWarnings("unchecked")
    public NpmProjectTaskExtensionService<ProjectTaskExtensionBaseVO> getService(@NotNull String beanName) {
        if (StringUtils.isEmpty(beanName)) {
            throw new UnixdeException("service key is null.");
        } else if (MapUtils.isEmpty(map) || Objects.isNull(map.get(beanName))) {
            log.warn("no available bean for this service, beanName={}", beanName);
            return null;
        }
        return (NpmProjectTaskExtensionService<ProjectTaskExtensionBaseVO>) map.get(beanName);
    }

    /**
     * æ ¹æ®é¡¹ç›®ç±»å‹é€‚é…æœåŠ¡
     *
     * @param projectTypeCode é¡¹ç›®ç±»å‹ä»£ç 
     * @return é€‚é…çš„æœåŠ¡å®ä¾‹
     * @author edward
     */
    public NpmProjectTaskExtensionService<ProjectTaskExtensionBaseVO> adaptService(String projectTypeCode) {
        if (StringUtils.isEmpty(projectTypeCode) || !extensions.contains(projectTypeCode)) {
            return null;
        }
        return getService(PREFIX + projectTypeCode);
    }
}
```

éƒ¨åˆ†ä»£ç ï¼šäºŒçº§ç¼“å­˜

```java
package com.soyotec.unixde.uap.sysconfig.service.impl;

import com.alibaba.fastjson2.JSON;
import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.soyotec.unixde.uap.framework.base.PageVO;
import com.soyotec.unixde.uap.framework.exception.UnixdeException;
import com.soyotec.unixde.uap.sysconfig.domain.DTypeEntity;
import com.soyotec.unixde.uap.sysconfig.dao.DTypeMapper;
import com.soyotec.unixde.uap.framework.base.BaseServiceImpl;
import com.soyotec.unixde.uap.sysconfig.service.DTypeService;
import com.soyotec.unixde.uap.sysconfig.util.RedisStoreUtils;
import com.soyotec.unixde.uap.sysconfig.vo.DocumentTypeVO;
import org.apache.commons.lang3.ObjectUtils;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.env.Environment;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.StringUtils;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;
import java.util.stream.Collectors;

/**
* <p>
*  æœåŠ¡å®ç°ç±»
* </p>
*
* @author edward
* @since 2025-03-05
*/
@Service
public class DTypeServiceImpl extends BaseServiceImpl<DTypeMapper, DTypeEntity> implements DTypeService {
    @Autowired
    private DTypeMapper documentTypeMapper;

    @Autowired
    private RedisStoreUtils redisStoreUtils;

    @Autowired
    private Environment environment;

    public static final Map<String,DocumentTypeVO> documentTypeMap=new ConcurrentHashMap<>();
    public static final Map<String,DocumentTypeVO> documentCodeMap=new ConcurrentHashMap<>();

    private static final String VUE_CACHE_DOC_TYPE_KEY = "VUE_CACHE_DOC_TYPE_KEY";




    @Override
    public Map<String,DocumentTypeVO> findAll() {
        if (documentTypeMap.size()==0){
            List<DTypeEntity> types = documentTypeMapper.selectList(null);
            if (!types.isEmpty()){
                for (DTypeEntity type:types){
                    DocumentTypeVO documentTypeVO=new DocumentTypeVO();
                    BeanUtils.copyProperties(type,documentTypeVO);
                    documentTypeMap.put(type.getId(),documentTypeVO);
                }
            }
        }
        return documentTypeMap;
    }

    @Override
    public void findPage(PageVO<DocumentTypeVO> pageVO) {
        DocumentTypeVO condition = JSON.parseObject(pageVO.getContent(), DocumentTypeVO.class);
        // æ„å»ºæŸ¥è¯¢æ¡ä»¶
        QueryWrapper<DTypeEntity> queryWrapper = new QueryWrapper<>();
        if (condition != null) {
            if (StringUtils.hasText(condition.getStatus())) {
                queryWrapper.eq("status", condition.getStatus());
            }
            if (StringUtils.hasText(condition.getName())) {
                queryWrapper.like("name", condition.getName());
            }
            if (StringUtils.hasText(condition.getCode())) {
                queryWrapper.eq("code", condition.getCode());
            }
        }
        queryWrapper.orderByDesc("modify_time");
        Page<DTypeEntity> page = new Page<>(pageVO.getPageNo(), pageVO.getPageSize());
        page = documentTypeMapper.selectPage(page, queryWrapper);
        // è½¬æ¢ç»“æœ
        List<DocumentTypeVO> result = page.getRecords().stream().map(type -> {
            DocumentTypeVO typeVO = new DocumentTypeVO();
            BeanUtils.copyProperties(type, typeVO);
            return typeVO;
        }).collect(Collectors.toList());
        // è®¾ç½®è¿”å›ç»“æœ
        pageVO.setResult(result);
        pageVO.setTotal(page.getTotal());
    }

    /**
     * æ›´æ–°æ¥å£
     * @param documentTypeVO
     * @param tenantId
     */
    @Override
    @Transactional(rollbackFor = Exception.class,propagation = Propagation.REQUIRES_NEW)
    public void update(DocumentTypeVO documentTypeVO, String tenantId) {
        QueryWrapper<DTypeEntity> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("code",documentTypeVO.getCode())
                .ne("id",documentTypeVO.getId());
        Long count = documentTypeMapper.selectCount(queryWrapper);
        if(count > 0){
            throw new UnixdeException("ç¼–ç é‡å¤,è¯·é‡æ–°è¾“å…¥");
        }
        // æŸ¥è¯¢ç°æœ‰è®°å½•
        QueryWrapper<DTypeEntity> idWrapper = new QueryWrapper<>();
        idWrapper.eq("id", documentTypeVO.getId());
        List<DTypeEntity> documentTypeList = documentTypeMapper.selectList(idWrapper);
        if (documentTypeList == null || documentTypeList.isEmpty()) {
            throw new UnixdeException("æ‰¾ä¸åˆ°è¯¥ç±»å‹");
        }
        String oldCode = documentTypeList.get(0).getCode();
        DTypeEntity documentType = new DTypeEntity();
        BeanUtils.copyProperties(documentTypeVO, documentType);
        documentType.setUpdateTenantId(tenantId);
        documentTypeMapper.updateById(documentType);
        // æ›´æ–°åçš„å¯¹è±¡å¤åˆ¶å› VO
        BeanUtils.copyProperties(documentType, documentTypeVO);
        // æ›´æ–°å†…å­˜ç¼“å­˜
        documentTypeMap.put(documentType.getId(), documentTypeVO);
        if (!ObjectUtils.equals(oldCode, documentType.getCode())) {
            documentCodeMap.remove(oldCode);
        }
        documentCodeMap.put(documentType.getCode(), documentTypeVO);
        // è®¾ç½®ä¿®æ”¹æ ‡è®°
        setModifyMark();
    }

    /**
     * åˆ é™¤æ¥å£
     * @param id
     */
    @Override
    public void delete(String id) {
        QueryWrapper<DTypeEntity> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("id", id);
        //TODOç¡®è®¤åŸé€»è¾‘ä¸ºä»€ä¹ˆè¿™é‡Œæ˜¯æ‹¿å»ä¸€ä¸ªlist ä¸ç†è§£
        List<DTypeEntity> type = documentTypeMapper.selectList(queryWrapper);
        if(type!=null&& !type.isEmpty()){
            documentTypeMap.remove(type.get(0).getId());
            documentCodeMap.remove(type.get(0).getCode());
        }
        baseMapper.deleteById(id);
        setModifyMark();
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public void add(DocumentTypeVO documentTypeVO, String userId) {
        // æ£€æŸ¥ code æ˜¯å¦é‡å¤
        QueryWrapper<DTypeEntity> codeWrapper = new QueryWrapper<>();
        codeWrapper.eq("code", documentTypeVO.getCode());
        Long count = documentTypeMapper.selectCount(codeWrapper);
        if (count > 0) {
            throw new UnixdeException("codeä¸èƒ½é‡å¤");
        }
        // åˆ›å»ºæ–°è®°å½•
        DTypeEntity documentType = new DTypeEntity();
        BeanUtils.copyProperties(documentTypeVO, documentType);
        documentType.setCreator(userId);
        documentType.setTenantId("0");
        documentTypeMapper.insert(documentType);
        BeanUtils.copyProperties(documentType, documentTypeVO);
        // æ›´æ–°å†…å­˜ç¼“å­˜
        documentTypeMap.put(documentType.getId(), documentTypeVO);
        documentCodeMap.put(documentType.getCode(), documentTypeVO);
        // è®¾ç½®ä¿®æ”¹æ ‡è®°
        setModifyMark();
    }

    /**
     * æŸ¥è¯¢æ‰€æœ‰çŠ¶æ€ä¸ºæœ‰æ•ˆçš„æ–‡æ¡£ç±»å‹åˆ—è¡¨
     * @author edward
     * @return æ–‡æ¡£ç±»å‹è§†å›¾å¯¹è±¡åˆ—è¡¨
     */
    public List<DocumentTypeVO> find() {
        // è·å–æ•°æ®æº URLï¼Œç”¨äºé€‚é…ä¸åŒæ•°æ®åº“
        String url = environment.getProperty("spring.datasource.url", "");
        if (StringUtils.isEmpty(url)) {
            log.warn("æ•°æ®æºURLæœªé…ç½®");
            return new ArrayList<>(); // è¿”å›ç©ºåˆ—è¡¨
        }
        // æ„å»ºæŸ¥è¯¢æ¡ä»¶
        List<DTypeEntity> types;
        if (url.startsWith("jdbc:dm") || url.startsWith("jdbc:postgresql")) {
            types = queryTypesForDM(); // é€‚é… DM æˆ– PostgreSQL
        } else {
            types = queryTypesForDefault(); // é€‚é…å…¶ä»–æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰
        }
        // è½¬æ¢å®ä½“ä¸º VO å¯¹è±¡
        List<DocumentTypeVO> typeVOS = new ArrayList<>();
        for (DTypeEntity type : types) {
            DocumentTypeVO typeVO = new DocumentTypeVO();
            BeanUtils.copyProperties(type, typeVO);
            typeVOS.add(typeVO);
        }
        return typeVOS;
    }

    /**
     * æŸ¥è¯¢çŠ¶æ€ä¸º '1' çš„æ–‡æ¡£ç±»å‹ï¼ˆé€‚é… DM æˆ– PostgreSQLï¼‰
     * @author edward
     * @return æ–‡æ¡£ç±»å‹å®ä½“åˆ—è¡¨
     */
    private List<DTypeEntity> queryTypesForDM() {
        return documentTypeMapper.selectList(
                new QueryWrapper<DTypeEntity>()
                        .eq("status", "1")
                        .orderByAsc("cast(sequence as NUMERIC)")
        );
    }
    /**
     * æŸ¥è¯¢çŠ¶æ€ä¸º 1 çš„æ–‡æ¡£ç±»å‹ï¼ˆé€‚é…é»˜è®¤æ•°æ®åº“ï¼Œå¦‚ MySQLï¼‰
     * @author edward
     * @return æ–‡æ¡£ç±»å‹å®ä½“åˆ—è¡¨
     */
    private List<DTypeEntity> queryTypesForDefault() {
        return documentTypeMapper.selectList(
                new QueryWrapper<DTypeEntity>()
                        .eq("status", 1)
                        .orderByAsc("cast(sequence as SIGNED)")
        );
    }

    private void setModifyMark() {
        try {
            redisStoreUtils.putHashValue(RedisStoreUtils.VUE_CACHE_HASH_KEY, VUE_CACHE_DOC_TYPE_KEY, String.valueOf(System.currentTimeMillis()));
        } catch (Exception e) {
            log.error("DocumentTypeServiceImpl setModifyMark: ", e);
        }
    }
}
```

### ç®€å†ç‚¹ï¼š

è¿™å—å…ˆè¿›è¡Œç®€å•çš„æè¿°ï¼Œåç»­ç»™å‡ºæ›´åŠ å…·ä½“çš„ä¸šåŠ¡æè¿°ä»¥åŠç›¸å…³ä»£ç 

- ConcurrentHashMap+redisä¹è§‚é”å®ç°çš„å†…å­˜ç¼“å­˜ï¼Œå‰ç«¯æºå¸¦ç¼“å­˜keyæŸ¥çœ‹æ˜¯å¦å˜åŒ–
- @Lazyæ³¨è§£å®Œæˆæ‡’åŠ è½½ï¼Œè§£å†³ç¼“å­˜ä¾èµ–çš„é—®é¢˜
- è®¾è®¡æ¨¡å¼ï¼ŒåŠŸèƒ½å­˜åœ¨ä¸åŒæ•°æ®åº“ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼è§£å†³é—®é¢˜
- @UtilityClassï¼Œå·¥å…·ç±»æ³¨è§£ï¼Œä½¿å¾—å·¥å…·ç±»ä¸å¯è¢«å®ä¾‹åŒ–

![image-20250326104705573](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20250326104705573.png)

**å‡ºç°äº†å¾ªç¯ä¾èµ–**

```
@Lazy //è§£å†³å¾ªç¯ä¾èµ–
@Resource
private NpmProjectTaskService npmProjectTaskService;
```

- é€‚é…å™¨æ¨¡å¼+æœåŠ¡ä¸­å¿ƒæ¨¡å¼

bgï¼šæ ¹æ®ä¸åŒçš„é¡¹ç›®æ¨¡å¼è°ƒç”¨ä¸åŒçš„æœåŠ¡ä¸­å¿ƒï¼ŒæœåŠ¡ä¸­å¿ƒé€šè¿‡è½¬æ¢å¯¹æ¥ä¸åŒçš„é€‚é…

```java
@Slf4j
@Service
@RequiredArgsConstructor
public class ProjectTaskExtensionServiceAdapter {

    /** beanå‰ç¼€ */
    public static final String PREFIX = "taskExtension";

    /** å¸¦æ‰©å±•è¡¨çš„é¡¹ç›®ç§ç±»åˆ—è¡¨ */
    private final List<String> extensions = new ArrayList<>(
            Arrays.asList(ProjectTypeEnum.KSM.code(),ProjectTypeEnum.HUB.code())
    );

    private final Map<String, ProjectTaskExtensionService<?>> map;

    @SuppressWarnings("unchecked")
    public ProjectTaskExtensionService<ProjectTaskExtensionBaseVO> getService(@NotNull String beanName) {
        if (StringUtils.isEmpty(beanName)) {
            throw new SkrException("service key is null.");
        } else if (MapUtils.isEmpty(map) || Objects.isNull(map.get(beanName))) {
            log.warn("no available bean for this service, beanName={}", beanName);
            return null;
        }
        return (ProjectTaskExtensionService<ProjectTaskExtensionBaseVO>) map.get(beanName);
    }

    public ProjectTaskExtensionService<ProjectTaskExtensionBaseVO> adaptService(String projectTypeCode) {
        if (StringUtils.isEmpty(projectTypeCode) || !extensions.contains(projectTypeCode)) {
            return null;
        }
        return getService(PREFIX + projectTypeCode);
    }
}

```



```java
/**
 * ä»»åŠ¡æ‰©å±•è¡¨æ¥å£ï¼Œæ ¹æ®é¡¹ç›®ç§ç±»é€‚é…ã€‚
 * @param <T> æ‰©å±•è¡¨VO
 */
public interface ProjectTaskExtensionService<T extends ProjectTaskExtensionBaseVO> {

    T getExtensionByTaskId(String taskId, SkrUserDetails userDetails);

    List<T> getExtensionListByTaskId(List<String> taskIdList, SkrUserDetails userDetails);

    T create(T entity, SkrUserDetails userDetails);

    T create(String entityJson, SkrUserDetails userDetails);

    T update(T entity, SkrUserDetails userDetails);

    T update(String entityJson, SkrUserDetails userDetails);

    void deleteByTaskId(String taskId, SkrUserDetails userDetails);
}
```

## ç”¨å‹

### **JWT + Token è®¤è¯åŠç¼“å­˜ä¼˜åŒ–æ•´ç†**

------

#### **1ï¸âƒ£ JWTï¼ˆJSON Web Tokenï¼‰èº«ä»½è®¤è¯**

##### **âœ… ä»€ä¹ˆæ˜¯ JWTï¼Ÿ**

- **JWTï¼ˆJSON Web Tokenï¼‰** æ˜¯ä¸€ç§ **æ— çŠ¶æ€è®¤è¯** æœºåˆ¶ï¼ŒæœåŠ¡å™¨**ä¸å­˜å‚¨ Token**ï¼Œè€Œæ˜¯é€šè¿‡ Token æœ¬èº«æ¥è¿›è¡Œèº«ä»½éªŒè¯ã€‚
- é€‚ç”¨äº **å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ã€API è®¤è¯ã€å¾®æœåŠ¡é‰´æƒ** ç­‰åœºæ™¯ã€‚

##### **âœ… ä¸ºä»€ä¹ˆä½¿ç”¨ JWTï¼Ÿ**

| æ–¹æ¡ˆ             | æœåŠ¡å™¨æ˜¯å¦å­˜ Token         | é€‚ç”¨åœºæ™¯                          |
| ---------------- | -------------------------- | --------------------------------- |
| **Session è®¤è¯** | âœ… éœ€è¦å­˜ Session           | ä¼ ç»Ÿ Web åº”ç”¨ï¼Œé€‚ç”¨äºå•æœº         |
| **JWT è®¤è¯**     | âŒ æ— çŠ¶æ€ï¼ŒæœåŠ¡å™¨ä¸å­˜ Token | é€‚ç”¨äºå¾®æœåŠ¡ã€è·¨ç³»ç»Ÿè®¤è¯          |
| **JWT + Redis**  | âœ… æœåŠ¡å™¨å­˜ Token           | é€‚ç”¨äºéœ€è¦ Token å¯ä¸»åŠ¨å¤±æ•ˆçš„åœºæ™¯ |

- **ä¼ ç»Ÿ Session è®¤è¯**ï¼šéœ€è¦åœ¨æœåŠ¡å™¨å­˜å‚¨ç”¨æˆ· Sessionï¼Œåˆ†å¸ƒå¼ç¯å¢ƒä¸‹éœ€è¦å…±äº« Sessionï¼Œæˆæœ¬é«˜ã€‚
- **JWT è®¤è¯**ï¼šToken å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨åªéœ€éªŒè¯ Token æ˜¯å¦æœ‰æ•ˆï¼Œä¸éœ€è¦å­˜å‚¨ Sessionã€‚
- **JWT + Redis ç¼“å­˜**ï¼šæœåŠ¡å™¨å¯ä¸»åŠ¨è®© Token å¤±æ•ˆï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚

------

#### **2ï¸âƒ£ JWT ç»“æ„**

JWT ç”± **ä¸‰éƒ¨åˆ†** ç»„æˆï¼š

```
Header.Payload.Signature
```

ç¤ºä¾‹ï¼š

```json
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxMjMiLCJleHAiOjE3MDAyNTgwMDB9.XiJJcZp9dFZhXHnx_FTBlahkPT6pXtsfDtw4CD13EXE
```

##### **âœ… è§£æ JWT ä¸‰éƒ¨åˆ†**

| éƒ¨åˆ†                  | ä½œç”¨                                                |
| --------------------- | --------------------------------------------------- |
| **Headerï¼ˆå¤´éƒ¨ï¼‰**    | è¯´æ˜ JWT ç±»å‹ + ç­¾åç®—æ³•ï¼ˆå¦‚ HS256ï¼‰                |
| **Payloadï¼ˆè½½è·ï¼‰**   | è®°å½•ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚ `userId`ã€`role`ã€`exp` è¿‡æœŸæ—¶é—´ï¼‰ |
| **Signatureï¼ˆç­¾åï¼‰** | æœåŠ¡å™¨ç­¾åï¼Œé˜²æ­¢ Token è¢«ç¯¡æ”¹                       |

------

#### **3ï¸âƒ£ JWT è®¤è¯æµç¨‹**

##### **âœ… è®¤è¯æµç¨‹**

1. **ç”¨æˆ·ç™»å½•**ï¼ŒæœåŠ¡å™¨éªŒè¯èº«ä»½åç”Ÿæˆ **JWT Token** å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

2. **å®¢æˆ·ç«¯å­˜å‚¨ Token**ï¼ˆå¦‚ `localStorage` / `cookie`ï¼‰ã€‚

3. å®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œæºå¸¦ Token

   ï¼š

   ```http
   Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
   ```

4. **æœåŠ¡å™¨è§£æ Token**ï¼ŒéªŒè¯ Token æ˜¯å¦æœ‰æ•ˆï¼Œè¿”å›æ•°æ®ã€‚

5. **Token è¿‡æœŸåï¼Œç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•**ã€‚

##### **âœ… æœåŠ¡å™¨å¦‚ä½•éªŒè¯ Tokenï¼Ÿ**

```java
import io.jsonwebtoken.*;

public class JWTUtil {
    private static final String SECRET_KEY = "your-secret-key";

    public Claims parseToken(String token) {
        return Jwts.parser()
                .setSigningKey(SECRET_KEY)
                .parseClaimsJws(token)
                .getBody();  // è§£æ Tokenï¼Œè·å– Claims
    }

    public boolean validateToken(String token) {
        try {
            return parseToken(token) != null;
        } catch (Exception e) {
            return false;  // Token æ— æ•ˆæˆ–è¿‡æœŸ
        }
    }
}
```

------

#### **4ï¸âƒ£ JWT + Redis ç»“åˆä¼˜åŒ–**

##### **âœ… ä¸ºä»€ä¹ˆè¦ç»“åˆ Redisï¼Ÿ**

çº¯ JWT **æ— æ³•ä¸»åŠ¨å¤±æ•ˆ**ï¼Œå¦‚æœç”¨æˆ·ç™»å‡ºæˆ–æƒé™å˜æ›´ï¼Œæ—§ Token ä»ç„¶æœ‰æ•ˆã€‚ç»“åˆ Redis å¯ä»¥ï¼š

1. **ä¸»åŠ¨è®© Token å¤±æ•ˆ**ï¼ˆç™»å‡ºã€å¯†ç ä¿®æ”¹ã€æƒé™å˜æ›´ï¼‰ã€‚
2. **é»‘åå•æœºåˆ¶**ï¼Œé˜²æ­¢ Token è¢«ç›—ç”¨ã€‚
3. **å‡å°‘ JWT è§£æè®¡ç®—é‡**ï¼Œæé«˜ API è®¤è¯æ•ˆç‡ã€‚

------

##### **âœ… JWT + Redis æ–¹æ¡ˆ**

**1ï¸âƒ£ ç”¨æˆ·ç™»å½•æ—¶ï¼Œå°† Token å­˜å…¥ Redis**

```java
redisTemplate.opsForValue().set("token:" + userId, token, 1, TimeUnit.DAYS);
```

**2ï¸âƒ£ è§£æ Token æ—¶ï¼Œå…ˆæŸ¥è¯¢ Redis**

```java
public boolean validateToken(String token, String userId) {
    String cachedToken = redisTemplate.opsForValue().get("token:" + userId);
    return cachedToken != null && cachedToken.equals(token) && parseToken(token) != null;
}
```

**3ï¸âƒ£ ç”¨æˆ·ç™»å‡ºæ—¶ï¼Œè®© Token ç«‹å³å¤±æ•ˆ**

```java
@GetMapping("/logout")
public String logout(@RequestParam String userId) {
    redisTemplate.delete("token:" + userId);
    return "ç”¨æˆ·å·²ç™»å‡ºï¼ŒToken å¤±æ•ˆ";
}
```

------

#### **5ï¸âƒ£ JWT + åˆ·æ–° Tokenï¼ˆRefresh Token æœºåˆ¶ï¼‰**

**ğŸš€ ç›®æ ‡ï¼šè®©ç”¨æˆ·é•¿æ—¶é—´å…ç™»å½•ï¼Œæå‡å®‰å…¨æ€§**

| Token ç±»å‹              | ä½œç”¨                     |
| ----------------------- | ------------------------ |
| **çŸ­ Tokenï¼ˆ30 åˆ†é’Ÿï¼‰** | è®¿é—® APIï¼ŒçŸ­æ—¶é—´æœ‰æ•ˆ     |
| **åˆ·æ–° Tokenï¼ˆ7 å¤©ï¼‰**  | ç»­æœŸ Tokenï¼Œé˜²æ­¢é¢‘ç¹ç™»å½• |

##### **âœ… æ–¹æ¡ˆ**

1. **çŸ­ Token**ï¼ˆ30 åˆ†é’Ÿï¼‰ï¼Œç”¨äº API è®¿é—®ã€‚

2. åˆ·æ–° Token

   ï¼ˆ7 å¤©ï¼‰ï¼Œç”¨äºè·å–æ–° Tokenï¼š

   ```http
   POST /auth/refresh
   Authorization: Bearer <refresh_token>
   ```

3. æœåŠ¡å™¨éªŒè¯åˆ·æ–° Token åï¼Œè¿”å›æ–° Token

   ï¼š

   ```json
   {
     "access_token": "new_access_token",
     "refresh_token": "new_refresh_token"
   }
   ```

------

#### **âœ… ä»£ç å®ç°**

**1ï¸âƒ£ ç”ŸæˆçŸ­ Token + åˆ·æ–° Token**

```java
public Map<String, String> generateTokens(String userId) {
    String accessToken = Jwts.builder()
            .setSubject(userId)
            .setExpiration(new Date(System.currentTimeMillis() + 1800000)) // 30 åˆ†é’Ÿ
            .signWith(SignatureAlgorithm.HS256, SECRET_KEY)
            .compact();

    String refreshToken = Jwts.builder()
            .setSubject(userId)
            .setExpiration(new Date(System.currentTimeMillis() + 604800000)) // 7 å¤©
            .signWith(SignatureAlgorithm.HS256, SECRET_KEY)
            .compact();

    return Map.of("access_token", accessToken, "refresh_token", refreshToken);
}
```

**2ï¸âƒ£ å¤„ç†åˆ·æ–° Token**

```java
@PostMapping("/refresh")
public ResponseEntity<?> refresh(@RequestParam String refreshToken) {
    try {
        Claims claims = jwtUtil.parseToken(refreshToken);
        String userId = claims.getSubject();
        Map<String, String> newTokens = generateTokens(userId);
        return ResponseEntity.ok(newTokens);
    } catch (Exception e) {
        return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body("æ— æ•ˆçš„åˆ·æ–° Token");
    }
}
```





# HOT100

## æ»‘åŠ¨çª—å£

### æ— é‡å¤æœ€é•¿å­—ç¬¦ä¸²å­—ä¸²



#### 2. æ ¸å¿ƒæ€è·¯

è¦æ‰¾åˆ°ä¸å«é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **æ»‘åŠ¨çª—å£** æŠ€æœ¯ï¼ŒåŠ¨æ€ç»´æŠ¤ä¸€ä¸ªæ— é‡å¤å­—ç¬¦çš„å­ä¸²çª—å£ã€‚

##### 2.1 æ»‘åŠ¨çª—å£çš„æ ¸å¿ƒæ€æƒ³

- ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆ lï¼ˆå·¦è¾¹ç•Œï¼‰å’Œ rï¼ˆå³è¾¹ç•Œï¼‰è¡¨ç¤ºå½“å‰çª—å£ã€‚
- å‘å³æ‰©å±•çª—å£ï¼ˆç§»åŠ¨ rï¼‰ï¼Œå°†æ–°å­—ç¬¦åŠ å…¥çª—å£ã€‚
- å¦‚æœé‡åˆ°é‡å¤å­—ç¬¦ï¼Œæ”¶ç¼©çª—å£ï¼ˆç§»åŠ¨ lï¼‰ï¼Œç›´åˆ°çª—å£å†…æ²¡æœ‰é‡å¤å­—ç¬¦ã€‚
- åœ¨æ¯æ¬¡çª—å£æ›´æ–°åï¼Œè®°å½•å½“å‰çª—å£é•¿åº¦ï¼ˆr - l + 1ï¼‰ï¼Œç»´æŠ¤æœ€å¤§é•¿åº¦ã€‚

##### 2.2 å®ç°ç»†èŠ‚

- æ•°æ®ç»“æ„ï¼šä½¿ç”¨ HashSet æˆ– HashMap è®°å½•çª—å£å†…å­—ç¬¦çš„å‡ºç°æƒ…å†µï¼š
  - HashSetï¼šè®°å½•å­—ç¬¦æ˜¯å¦å‡ºç°ã€‚
  - HashMapï¼šè®°å½•å­—ç¬¦åŠå…¶æœ€æ–°ç´¢å¼•ï¼Œä¾¿äºå¿«é€Ÿå®šä½é‡å¤å­—ç¬¦ã€‚
- æ­¥éª¤ï¼š
  1. åˆå§‹åŒ–çª—å£ï¼šl = 0ï¼Œr = 0ï¼Œæœ€å¤§é•¿åº¦ nums = 0ã€‚
  2. éå†å­—ç¬¦ä¸²ï¼ˆrå³ç§»ï¼‰ï¼š
     - æ£€æŸ¥å½“å‰å­—ç¬¦ s.charAt(r) æ˜¯å¦åœ¨çª—å£å†…ï¼š
       - å¦‚æœä¸åœ¨ï¼ŒåŠ å…¥çª—å£ï¼Œæ›´æ–°æœ€å¤§é•¿åº¦ã€‚
       - å¦‚æœåœ¨ï¼Œç§»åŠ¨ l åˆ°é‡å¤å­—ç¬¦çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œç§»é™¤çª—å£å†…çš„é‡å¤å­—ç¬¦ã€‚
  3. è¿”å›æœ€å¤§é•¿åº¦ã€‚

```java
public int lengthOfLongestSubstring(String s) {
        int nums = 0; // è®°å½•æœ€å¤§é•¿åº¦
        int r = 0;    // å³æŒ‡é’ˆ
        int l = 0;    // å·¦æŒ‡é’ˆ
        // ä½¿ç”¨ HashSet è®°å½•çª—å£å†…å­—ç¬¦
        Set<Character> set = new HashSet<>();
        
        while (r < s.length()) {
            // å¦‚æœå½“å‰å­—ç¬¦ä¸åœ¨çª—å£å†…
            if (!set.contains(s.charAt(r))) {
                set.add(s.charAt(r));
                nums = Math.max(nums, r - l + 1); // æ›´æ–°æœ€å¤§é•¿åº¦
            } else {
                // é‡åˆ°é‡å¤å­—ç¬¦ï¼Œç§»é™¤å·¦è¾¹ç•Œå­—ç¬¦ï¼Œç›´åˆ°é‡å¤å­—ç¬¦è¢«ç§»é™¤
                while (set.contains(s.charAt(r))) {
                    set.remove(s.charAt(l));
                    l++;
                }
                set.add(s.charAt(r)); // åŠ å…¥æ–°å­—ç¬¦
            }
            r++; // å³æŒ‡é’ˆå³ç§»
        }
        
        return nums;
    }
```



## æŸ¥æ‰¾

### äºŒåˆ†æŸ¥æ‰¾

#### [æœç´¢æ’å…¥ä½ç½®](https://leetcode.cn/problems/search-insert-position/)

ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„å’Œä¸€ä¸ªç›®æ ‡å€¼ï¼Œåœ¨æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œå¹¶è¿”å›å…¶ç´¢å¼•ã€‚å¦‚æœç›®æ ‡å€¼ä¸å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œè¿”å›å®ƒå°†ä¼šè¢«æŒ‰é¡ºåºæ’å…¥çš„ä½ç½®ã€‚

è¯·å¿…é¡»ä½¿ç”¨æ—¶é—´å¤æ‚åº¦ä¸º `O(log n)` çš„ç®—æ³•ã€‚

**æ ¸å¿ƒï¼š**

- midçš„è®¡ç®— **l + (r - l) / 2**ï¼Œé€šè¿‡è®¡ç®—å·¦è¾¹ç•Œä¸ç›¸å¯¹åç§»æ¥å¾—å‡ºmidçš„ä½ç½®
- æœ€åæ’å…¥çš„åœ°æ–¹æ˜¯å·¦è¾¹ç•Œï¼ŒlæŒ‡å‘çš„æ˜¯æ¯”targetå¤§çš„ç¬¬ä¸€ä¸ªæ•°

 

code

```java
public int searchInsert(int[] nums, int target) {
        int l = 0;
        int r = nums.length - 1;

        while (l <= r) {
            int mid = l + (r - l) / 2; // æ¯æ¬¡å¾ªç¯é‡æ–°è®¡ç®— mid é€šè¿‡è®¡ç®—åç§»é‡çš„æ–¹å¼
            if (nums[mid] == target) {
                return mid; // æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œç›´æ¥è¿”å›
            } else if (nums[mid] < target) {
                l = mid + 1; // ç›®æ ‡å€¼åœ¨å³åŠéƒ¨åˆ†
            } else {
                r = mid - 1; // ç›®æ ‡å€¼åœ¨å·¦åŠéƒ¨åˆ†
            }
        }

        return l; // l æŒ‡å‘æ’å…¥ä½ç½®
    }
```



## äºŒå‰æ ‘

### ç†è®ºåŸºç¡€

- æ·±åº¦ï¼šå¶å­èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·ç¦»
- é«˜åº¦ï¼šèŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·ç¦»

### 1.äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦

- é€’å½’ç‰ˆå®ç°-----**1.ç¡®å®šè¿”å›ç±»å‹å’Œå‚æ•°ï¼Œ2.ç¡®å®šè¾¹ç•Œæ¡ä»¶ï¼Œ3.ç¡®å®šå•å±‚é€’å½’çš„é€»è¾‘**

```java
 public int maxDepth(TreeNode root) {
     	
        if(root == null) return 0;
        int leftHeight = maxDepth(root.left);
        int rightHeight = maxDepth(root.right);
        int depth = Math.max(leftHeight,rightHeight) + 1;
        return depth;
    }
```

### 2.åˆ¤æ–­äºŒå‰æ ‘æ˜¯å¦å¯¹ç§°

#### æ ¸å¿ƒæ€è·¯

- é€’å½’æ³•

**åˆ¤æ–­å·¦å­æ ‘çš„å·¦èŠ‚ç‚¹å’Œå³å­æ ‘çš„å³èŠ‚ç‚¹  ä»¥åŠ å·¦å­æ ‘çš„å³èŠ‚ç‚¹å’Œå³å­æ ‘çš„å·¦èŠ‚ç‚¹æ˜¯å¦ç›¸åŒ**

ä»£ç ï¼š

```java
 public boolean isSymmetric(TreeNode root) {
        // å¦‚æœæ ‘æ˜¯ç©ºçš„ï¼Œè‚¯å®šæ˜¯å¯¹ç§°çš„
        if (root == null) {
            return true;
        }
        // ä»æ ¹èŠ‚ç‚¹çš„å·¦å³å­æ ‘å¼€å§‹æ£€æŸ¥
        return checkMirror(root.left, root.right);
    }
    private boolean checkMirror(TreeNode left, TreeNode right){
        //å¤„ç†ä¸¤ä¸ªéƒ½ä¸ºnull
        if(left == null && right == null){
            return true;
        }
        //å·¦å³æœ‰ä¸€ä¸ªä¸ºnullä»£è¡¨ä¸å¯¹ç§°
        if(left == null || right == null){
            return false;
        }
        //éƒ½æœ‰å€¼ä¸”å€¼ç›¸ç­‰
        if(left.val == right.val){
            return checkMirror(left.left,right.right) && checkMirror(left.right,right.left);
        }else{
            return false;
        }
    }
```



## çŸ©é˜µ

### 1.èºæ—‹çŸ©é˜µ

#### 1. æè¿°

ç»™å®šä¸€ä¸ª m x n çš„çŸ©é˜µ matrixï¼ŒæŒ‰ç…§ **é¡ºæ—¶é’ˆèºæ—‹é¡ºåº** è¿”å›çŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚

**ç¤ºä¾‹**ï¼š

- è¾“å…¥ï¼šmatrix = [[1,2,3],[4,5,6],[7,8,9]]
- è¾“å‡ºï¼š[1,2,3,6,9,8,7,4,5]
- è§£é‡Šï¼šæŒ‰ç…§é¡ºæ—¶é’ˆèºæ—‹é¡ºåºéå†ã€‚

**çº¦æŸ**ï¼š

- m == matrix.length
- n == matrix[0].length
- 1 <= m, n <= 10
- -100 <= matrix[i][j] <= 100

#### æ ¸å¿ƒæ€è·¯ï¼š

- é¦–å…ˆéœ€è¦æ¨¡æ‹Ÿæ­£å¸¸æƒ…å†µéå†é¡ºåº

ä½¿ç”¨ **è¾¹ç•Œæ¨¡æ‹Ÿæ³•**ï¼š

1. å®šä¹‰å››ä¸ªè¾¹ç•Œï¼štopï¼ˆä¸Šï¼‰ã€bottomï¼ˆä¸‹ï¼‰ã€leftï¼ˆå·¦ï¼‰ã€rightï¼ˆå³ï¼‰ã€‚
2. æŒ‰ç…§é¡ºæ—¶é’ˆæ–¹å‘éå†ï¼š
   - ä»å·¦åˆ°å³ï¼ˆtop è¡Œï¼‰ã€‚
   - ä»ä¸Šåˆ°ä¸‹ï¼ˆright åˆ—ï¼‰ã€‚
   - ä»å³åˆ°å·¦ï¼ˆbottom è¡Œï¼‰ã€‚
   - ä»ä¸‹åˆ°ä¸Šï¼ˆleft åˆ—ï¼‰ã€‚
3. æ¯æ¬¡éå†åæ›´æ–°è¾¹ç•Œï¼Œé‡å¤ç›´åˆ°æ‰€æœ‰å…ƒç´ è¢«è®¿é—®ã€‚

#### 2.1 è¯¦ç»†æ­¥éª¤

- åˆå§‹è¾¹ç•Œï¼štop = 0, bottom = m-1, left = 0, right = n-1ã€‚
- éå†é¡ºåºï¼š
  1. ä» left åˆ° rightï¼Œéå† top è¡Œï¼Œtop++ã€‚
  2. ä» top åˆ° bottomï¼Œéå† right åˆ—ï¼Œright--ã€‚
  3. ä» right åˆ° leftï¼Œéå† bottom è¡Œï¼Œbottom--ã€‚
  4. ä» bottom åˆ° topï¼Œéå† left åˆ—ï¼Œleft++ã€‚
- å¾ªç¯æ¡ä»¶ï¼štop <= bottom ä¸” left <= rightã€‚

**æ³¨æ„ï¼šåœ¨whileå¾ªç¯å†…ç”±äºtopä¼šå…ˆ++,æ‰€ä»¥ä¹‹åçš„æ¯ä¸ªéå†éƒ½éœ€è¦å…ˆåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦è¶Šç•Œï¼**

#### code

```java
public List<Integer> spiralOrder(int[][] matrix) {
        List<Integer> retList = new ArrayList<>();
        //å®šä¹‰å››ä¸ªè¾¹ç•Œ
        int top = 0;
        int right = matrix[0].length - 1;
        int bottom = matrix.length - 1;
        int left = 0;

        //å¾ªç¯éå†æ‰€æœ‰å…ƒç´ 
        while(top <= bottom && right >= left){
            //éå†top
            for(int i = left;i <= right; i++){
                retList.add(matrix[top][i]);
            }
            top++;
            //åç»­éå†ä¹‹å‰å…ˆæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦å·²ç»è¶Šç•Œï¼
            if(top <= bottom){
                //éå†right
                for(int i = top; i <= bottom; i++){
                    retList.add(matrix[i][right]);
                }
                right--;
            }
            if(bottom >= top){
                //éå†bottom
                for(int i = right; i >= left; i--){
                    retList.add(matrix[bottom][i]);
                }
                bottom--;
            }

            if(left <= right){
                //éå†left
                for(int i = bottom; i >= top; i--){
                    retList.add(matrix[i][left]);
                }
                left++;
            }

        }
        return retList;
    }
```



## é“¾è¡¨

### 1.ç¯å½¢é“¾è¡¨

#### æè¿°

ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ `head` ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚

å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª `next` æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° `pos` æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚**æ³¨æ„ï¼š`pos` ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’** ã€‚ä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚

*å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯* ï¼Œåˆ™è¿”å› `true` ã€‚ å¦åˆ™ï¼Œè¿”å› `false` ã€‚

```
è¾“å…¥ï¼šhead = [3,2,0,-4], pos = 1
è¾“å‡ºï¼štrue
è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚
```

#### æ ¸å¿ƒæ€è·¯

`ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆ`,**å¦‚æœå¿«æŒ‡é’ˆè¿½ä¸Šæ»¡æŒ‡é’ˆ**ï¼Œå°±è¯æ˜æœ‰ç¯çš„å­˜åœ¨

- æ­¥é•¿å®šä¹‰ï¼šå¿«æŒ‡é’ˆä¸€æ¬¡èµ°ä¸¤æ­¥ï¼Œæ…¢æŒ‡é’ˆä¸€æ¬¡èµ°ä¸€æ­¥ï¼Œç›¸å¯¹è¿åŠ¨é€Ÿåº¦ä¸º1ï¼Œè‚¯å®šä¼šç›¸é‡

#### Code

```java
//å¿«æ…¢æŒ‡é’ˆ
    public boolean hasCycle(ListNode head) {
        if(head == null || head.next == null){
            return false;
        }
        //å¿«æŒ‡é’ˆä¸€æ¬¡èµ°ä¸¤ä¸ªï¼Œè¿™æ ·ä¿è¯å¿«æ…¢ç›¸é‡
        ListNode fast = head;
        ListNode slow = head;

        while(fast != null && fast.next != null){
            fast = fast.next.next;
            slow = slow.next;
            if(fast == slow) return true;
        }
        return false;
    }
```

### 2. ç¯å½¢é“¾è¡¨ IIï¼ˆLeetCode 142ï¼‰

#### æè¿°

ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ headï¼Œè¿”å›é“¾è¡¨ä¸­ç¯çš„å…¥å£èŠ‚ç‚¹ã€‚å¦‚æœé“¾è¡¨ä¸­æ²¡æœ‰ç¯ï¼Œåˆ™è¿”å› nullã€‚
 ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚**æ³¨æ„ï¼špos ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’**ï¼Œä»…ç”¨äºæ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚
 å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯ï¼Œåˆ™è¿”å›ç¯çš„å…¥å£èŠ‚ç‚¹ï¼›å¦åˆ™ï¼Œè¿”å› nullã€‚

**ç¤ºä¾‹**ï¼š

- è¾“å…¥ï¼šhead = [3,2,0,-4], pos = 1
- è¾“å‡ºï¼š2ï¼ˆè¿”å›å€¼ä¸ºèŠ‚ç‚¹ 2ï¼‰
- è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼ˆç´¢å¼• 1 çš„èŠ‚ç‚¹ 2ï¼‰ï¼Œç¯çš„å…¥å£æ˜¯ 2ã€‚

**çº¦æŸ**ï¼š

- é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´åœ¨ [0, 10^4] ä¹‹é—´ã€‚
- -10^5 <= Node.val <= 10^5ã€‚
- pos çš„å€¼ä¸º -1 æˆ–è€…é“¾è¡¨ä¸­çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•ã€‚

#### æ ¸å¿ƒæ€è·¯

ä½¿ç”¨ **å¿«æ…¢æŒ‡é’ˆæ³•**ï¼ˆFloyd åˆ¤åœˆç®—æ³•ï¼‰æ¥æ£€æµ‹ç¯å¹¶æ‰¾åˆ°å…¥å£ï¼š

1. æ£€æµ‹ç¯

   - æ…¢æŒ‡é’ˆï¼ˆslowï¼‰ï¼šæ¯æ¬¡ç§»åŠ¨ 1 æ­¥ã€‚
   - å¿«æŒ‡é’ˆï¼ˆfastï¼‰ï¼šæ¯æ¬¡ç§»åŠ¨ 2 æ­¥ã€‚
   - å¦‚æœå¿«æ…¢æŒ‡é’ˆç›¸é‡ï¼Œè¯´æ˜æœ‰ç¯ï¼›å¦åˆ™ï¼Œè¿”å› nullã€‚

2. æ‰¾åˆ°ç¯çš„å…¥å£

   **ç¬¬ä¸€æ¬¡ç›¸é‡ç‚¹ä¸ä¸€å®šæ˜¯å…¥å£ï¼Œä½†ç¬¬äºŒæ¬¡ç›¸é‡ç‚¹ä¸€å®šæ˜¯å…¥å£ã€‚**

   - ç›¸é‡åï¼Œå°†æ…¢æŒ‡é’ˆç§»å›é“¾è¡¨å¤´èŠ‚ç‚¹ï¼Œå¿«æŒ‡é’ˆä¿æŒåœ¨ç›¸é‡ç‚¹ã€‚
   - ç„¶åï¼Œæ…¢æŒ‡é’ˆå’Œå¿«æŒ‡é’ˆéƒ½ä»¥ç›¸åŒé€Ÿåº¦ï¼ˆæ¯æ¬¡ 1 æ­¥ï¼‰ç§»åŠ¨ã€‚
   - ä¸¤è€…å†æ¬¡ç›¸é‡æ—¶ï¼Œç›¸é‡ç‚¹å³ä¸ºç¯çš„å…¥å£ã€‚

3. æ•°å­¦åŸç†

   - è®¾ï¼š
     - aï¼šä»é“¾è¡¨å¤´åˆ°ç¯å…¥å£çš„è·ç¦»ã€‚
     - cï¼šç¯çš„é•¿åº¦ã€‚
     - bï¼šæ…¢æŒ‡é’ˆåœ¨ç¯å†…èµ°äº†å¤šè¿œæ‰ä¸å¿«æŒ‡é’ˆç›¸é‡ã€‚
   - æ…¢æŒ‡é’ˆç›¸é‡æ—¶èµ°äº† a + b æ­¥ï¼Œå¿«æŒ‡é’ˆèµ°äº† 2(a + b) æ­¥ï¼Œä¸”å¿«æŒ‡é’ˆå¯èƒ½åœ¨ç¯å†…å¤šè½¬äº† k åœˆï¼š
      2(a + b) = a + b + k * c
      åŒ–ç®€ï¼ša = k * c - bã€‚
   - è¿™è¡¨æ˜ï¼Œä»é“¾è¡¨å¤´åˆ°å…¥å£çš„è·ç¦» aï¼Œç­‰äºä»ç›¸é‡ç‚¹æ²¿ç¯èµ° k åœˆå†å‡å» b çš„è·ç¦»ã€‚
   - å› æ­¤ï¼Œæ…¢æŒ‡é’ˆä»å¤´èµ° a æ­¥åˆ°è¾¾å…¥å£æ—¶ï¼Œå¿«æŒ‡é’ˆä»ç›¸é‡ç‚¹èµ° a æ­¥ï¼ˆa = k * c - bï¼‰ï¼Œæ­£å¥½ç»•ç¯ k åœˆå›åˆ°å…¥å£ï¼Œä¸¤è€…ä¼šåœ¨å…¥å£ç›¸é‡ã€‚

#### ä»£ç å®ç°

```java
public ListNode detectCycle(ListNode head) {
    // è¾¹ç•Œæ£€æŸ¥ï¼šç©ºé“¾è¡¨æˆ–å•èŠ‚ç‚¹æ— ç¯
    if (head == null || head.next == null) {
        return null;
    }
    
    // æ­¥éª¤1ï¼šå¿«æ…¢æŒ‡é’ˆæ£€æµ‹ç¯
    ListNode slow = head;
    ListNode fast = head;
    while (fast != null && fast.next != null) {
        slow = slow.next;
        fast = fast.next.next;
        if (slow == fast) {
            // æ­¥éª¤2ï¼šä»å¤´å’Œç›¸é‡ç‚¹åŒæ­¥ç§»åŠ¨ï¼Œå¯»æ‰¾ç¯å…¥å£
            ListNode ptr1 = head;
            ListNode ptr2 = fast;
            while (ptr1 != ptr2) {
                ptr1 = ptr1.next;
                ptr2 = ptr2.next;
            }
            return ptr1; // å¾ªç¯ç»“æŸåè¿”å›ç¯å…¥å£
        }
    }
    
    // æ— ç¯ï¼Œè¿”å› null
    return null;
}
```

#### å¤æ‚åº¦åˆ†æ

- æ—¶é—´å¤æ‚åº¦O(n)
  - n æ˜¯é“¾è¡¨èŠ‚ç‚¹æ•°ã€‚
  - æ£€æµ‹ç¯é˜¶æ®µï¼šå¿«æ…¢æŒ‡é’ˆåœ¨ O(n) æ—¶é—´å†…ç›¸é‡ã€‚
  - æ‰¾å…¥å£é˜¶æ®µï¼šä»å¤´åˆ°å…¥å£çš„è·ç¦»ä¸º aï¼Œæœ€å¤š O(n) æ­¥ã€‚
- ç©ºé—´å¤æ‚åº¦O(1)
  - åªä½¿ç”¨å¸¸æ•°çº§é¢å¤–ç©ºé—´ï¼ˆå‡ ä¸ªæŒ‡é’ˆï¼‰ã€‚

#### æ³¨æ„äº‹é¡¹

- è¾¹ç•Œæ¡ä»¶
  - ç©ºé“¾è¡¨æˆ–å•èŠ‚ç‚¹æ— ç¯ï¼Œç›´æ¥è¿”å› nullã€‚
  - ç¯å¯èƒ½åœ¨é“¾è¡¨å¤´ï¼ˆå¦‚ [1,2]ã€pos=0ï¼‰ã€‚
- å¿«æŒ‡é’ˆç§»åŠ¨
  - å¿…é¡»æ£€æŸ¥ fast.next != nullï¼Œé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚
- ç›¸é‡ç‚¹
  - **ç¬¬ä¸€æ¬¡ç›¸é‡ç‚¹ä¸ä¸€å®šæ˜¯å…¥å£ï¼Œä½†ç¬¬äºŒæ¬¡ç›¸é‡ç‚¹ä¸€å®šæ˜¯å…¥å£ã€‚**



## åŒæŒ‡é’ˆ

### 1.ç§»åŠ¨é›¶

**æè¿°**ï¼šç»™å®šä¸€ä¸ªæ•°ç»„ `nums`ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ `0` ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚

**è¯·æ³¨æ„** ï¼Œå¿…é¡»åœ¨ä¸å¤åˆ¶æ•°ç»„çš„æƒ…å†µä¸‹åŸåœ°å¯¹æ•°ç»„è¿›è¡Œæ“ä½œã€‚

**ç¤ºä¾‹ 1:**

```
è¾“å…¥: nums = [0,1,0,3,12]
è¾“å‡º: [1,3,12,0,0]
```

**æ ¸å¿ƒæ€æƒ³ï¼š**

- ä½¿ç”¨åŒæŒ‡é’ˆ leftå’Œ right
  - leftï¼šæŒ‡å‘ä¸‹ä¸€ä¸ªé 0 å…ƒç´ åº”è¯¥æ”¾ç½®çš„ä½ç½®ã€‚
  - rightï¼šéå†æ•°ç»„ï¼Œå¯»æ‰¾é 0 å…ƒç´ ã€‚
- å°†é 0 å…ƒç´ ç§»åŠ¨åˆ° left ä½ç½®ï¼Œleft å‰è¿›ã€‚
- æœ€åå°† left ä¹‹åçš„å…ƒç´ ç½®ä¸º 0ã€‚

**æ­¥éª¤ï¼š**

1. åˆå§‹åŒ– left = 0ï¼Œright = 0ã€‚

2. right

    éå†æ•°ç»„ï¼š

   - å¦‚æœ nums[right] != 0ï¼Œå°† nums[right] èµ‹å€¼ç»™ nums[left]ï¼Œleft++ã€‚
   - right ç»§ç»­å‘å‰ç§»åŠ¨ã€‚

3. éå†ç»“æŸåï¼Œä» left åˆ°æ•°ç»„æœ«å°¾è¡¥ 0ã€‚

CODE

```java
class Solution {
    public void moveZeroes(int[] nums) {
       if(nums.length == 0 || nums.length == 1){
        return;
       } 
       int left = 0;
       for(int right = 0; right < nums.length; right++){
        //å³æŒ‡é’ˆæ‰¾åˆ°éé›¶å…ƒç´ 
          if(nums[right] != 0){
            if(right != left){
                nums[left] = nums[right];
                left++;
            }else{
                left++;
            }
          }
       }
       //è¡¥0
       while(left <= nums.length - 1){
            nums[left] = 0;
            left++;
       }
    }
}
```



### 2.ç››æ°´æœ€å¤šçš„å®¹å™¨

#### 1. é¢˜ç›®æè¿°

- **é—®é¢˜ï¼š** ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ heightï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è¡¨ç¤ºä¸€ä¸ªå‚ç›´çº¿çš„é«˜åº¦ï¼Œå‚ç›´çº¿çš„å®½åº¦ä¸º 1ã€‚æ‰¾åˆ°ä¸¤æ¡å‚ç›´çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ x è½´å½¢æˆçš„å®¹å™¨èƒ½è£…æœ€å¤šçš„æ°´ã€‚

- è§„åˆ™ï¼š

  - å®¹å™¨çš„é¢ç§¯ = ä¸¤çº¿ä¹‹é—´çš„è·ç¦» Ã— è¾ƒçŸ­çš„å‚ç›´çº¿çš„é«˜åº¦ã€‚
  - è·ç¦» = ä¸¤çº¿ä¸‹æ ‡ä¹‹å·®ï¼ˆç»å¯¹å€¼ï¼‰ã€‚
  - é«˜åº¦ = ä¸¤çº¿ä¸­è¾ƒçŸ­è€…ã€‚

- **è¾“å…¥ï¼š** æ•´æ•°æ•°ç»„ heightã€‚

- **è¾“å‡ºï¼š** æœ€å¤§é¢ç§¯ã€‚

- ç¤ºä¾‹ï¼š

  - è¾“å…¥ï¼šheight = [1, 8, 6, 2, 5, 4, 8, 3, 7]
  - è¾“å‡ºï¼š49
  - è§£é‡Šï¼šç”¨ä¸‹æ ‡ 1ï¼ˆé«˜åº¦ 8ï¼‰å’Œä¸‹æ ‡ 7ï¼ˆé«˜åº¦ 7ï¼‰çš„çº¿ï¼Œé¢ç§¯ = (7-1) * min(8, 7) = 6 * 7 = 42ã€‚ä½†æœ€ä½³ç»„åˆå¯èƒ½æ˜¯å…¶ä»–ä½ç½®ï¼ˆå¦‚è°ƒæ•´åè®¡ç®—ï¼‰ï¼Œå®é™…æœ€å¤§ä¸º 49ã€‚

  

  

  #### æ ¸å¿ƒæ€æƒ³ï¼š

  - ä½¿ç”¨åŒæŒ‡é’ˆä»ä¸¤ç«¯å‘ä¸­é—´ç§»åŠ¨ï¼ŒåŠ¨æ€è®¡ç®—æœ€å¤§é¢ç§¯ã€‚
  - é¢ç§¯ç”±ä¸¤ä¸ªå› ç´ å†³å®šï¼šå®½åº¦ï¼ˆr - lï¼‰å’Œé«˜åº¦ï¼ˆè¾ƒçŸ­çš„çº¿çš„é«˜åº¦ï¼‰ã€‚
  - æ¯æ¬¡ç§»åŠ¨è¾ƒçŸ­çš„çº¿ä¸€ç«¯ï¼Œå› ä¸ºï¼š
    - å¦‚æœç§»åŠ¨è¾ƒé«˜çš„çº¿ï¼Œé¢ç§¯ä¸ä¼šå¢åŠ ï¼ˆå› ä¸ºé«˜åº¦ä¸ä¼šå˜å¤§ï¼Œå®½åº¦å‡å°ï¼‰ã€‚
    - ç§»åŠ¨è¾ƒä½çš„çº¿å¯èƒ½æ‰¾åˆ°æ›´é«˜çš„çº¿ï¼Œä»è€Œå¢åŠ é¢ç§¯ã€‚

  **æ­¥éª¤ï¼š**

  1. åˆå§‹åŒ– left = 0ï¼ˆå·¦æŒ‡é’ˆï¼‰ï¼Œright = height.length - 1ï¼ˆå³æŒ‡é’ˆï¼‰ã€‚

  2. è®¡ç®—åˆå§‹é¢ç§¯ï¼šarea = (right - left) * min(height[left], height[right])ã€‚

  3. å¾ªç¯ç›´åˆ° 

     left >= right

     ï¼š

     - æ¯”è¾ƒ height[left] å’Œ height[right]ã€‚
     - å¦‚æœ height[left] < height[right]ï¼Œç§»åŠ¨ left++ï¼ˆå°è¯•æ‰¾æ›´é«˜çš„å·¦çº¿ï¼‰ã€‚
     - å¦åˆ™ï¼Œç§»åŠ¨ right--ï¼ˆå°è¯•æ‰¾æ›´é«˜çš„å³çº¿ï¼‰ã€‚
     - è®¡ç®—æ–°é¢ç§¯ï¼Œæ›´æ–°æœ€å¤§å€¼ã€‚

  4. è¿”å›æœ€å¤§é¢ç§¯ã€‚

  #### ä»£ç 

  ```java
  /**
   * ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•´æ•°æ•°ç»„ height ã€‚æœ‰ n æ¡å‚çº¿ï¼Œç¬¬ i æ¡çº¿çš„ä¸¤ä¸ªç«¯ç‚¹æ˜¯ (i, 0) å’Œ (i, height[i]) ã€‚
   * æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ x è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚
   * è¿”å›å®¹å™¨å¯ä»¥å‚¨å­˜çš„æœ€å¤§æ°´é‡ã€‚
   * è¯´æ˜ï¼šä½ ä¸èƒ½å€¾æ–œå®¹å™¨ã€‚
   * @author edward
   * @date 2025/3/19
   */
  
  public class ContainerMostWater {
      public static void main(String[] args) {
          // åˆ›å»ºä¸€ä¸ªContainerMostWaterå¯¹è±¡
          ContainerMostWater containerMostWater = new ContainerMostWater();
          // å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œå­˜å‚¨å®¹å™¨çš„é«˜åº¦
          int[] height = {1,8,6,2,5,4,8,3,7};
          // è¾“å‡ºå®¹å™¨ä¸­æ°´çš„æœ€å¤§é¢ç§¯
          System.out.println(containerMostWater.maxArea(height));
      }
      public int maxArea(int[] height) {
          // å®šä¹‰å³æŒ‡é’ˆ
          int r = height.length - 1;
          // å®šä¹‰å·¦æŒ‡é’ˆ
          int l = 0;
          int high = height[r] > height[l] ? height[l] : height[r];//å–æ¯”è¾ƒçŸ­çš„é«˜åº¦
          int res = (r - l) * high;
  
          while(l < r){
              if(height[l] < height[r]){
                  l++;
              }else{
                  r--;
              }
              int tempRes = (r - l) * (height[r] > height[l] ? height[l] : height[r]);
              // æ›´æ–°æœ€å¤§é¢ç§¯
              if(tempRes > res){
                  res = tempRes;
              }
          }
          return res;
      }
  }
  ```

  
  
  ### LeetCode 15. ä¸‰æ•°ä¹‹å’Œ è§£é¢˜ç¬”è®°
  
  #### 1. æè¿°
  ç»™å®šæ•´æ•°æ•°ç»„ `nums`ï¼Œæ‰¾å‡ºæ‰€æœ‰æ»¡è¶³ `nums[i] + nums[j] + nums[k] == 0` ä¸” `i != j != k` çš„ä¸‰å…ƒç»„ï¼Œç­”æ¡ˆä¸å¯é‡å¤ã€‚
  
  **ç¤ºä¾‹**ï¼š  
  - è¾“å…¥ï¼š`nums = [-1,0,1,2,-1,-4]`  
  - è¾“å‡ºï¼š`[[-1,-1,2],[-1,0,1]]`
  
  **çº¦æŸ**ï¼š  
  - `0 <= nums.length <= 3000`  
  - `-10^5 <= nums[i] <= 10^5`
  
  ---
  
  #### 2. æ ¸å¿ƒæ€è·¯
  ä½¿ç”¨ **æ’åº + åŒæŒ‡é’ˆ**ï¼š  
  1. æ’åºæ•°ç»„ï¼š`O(n log n)`ã€‚  
  2. å›ºå®š `nums[i]`ï¼Œç”¨åŒæŒ‡é’ˆ `left` å’Œ `right` æ‰¾ `nums[left] + nums[right] = -nums[i]`ã€‚  
  3. å»é‡ï¼šè·³è¿‡é‡å¤çš„ `nums[i]`ã€`nums[left]` å’Œ `nums[right]`ã€‚  
  4. æå‰ç»ˆæ­¢ï¼šè‹¥ `nums[i] > 0`ï¼Œé€€å‡ºã€‚
  
  ---
  
  ### 3. ä»£ç å®ç°
  ```java
  class Solution {
      public List<List<Integer>> threeSum(int[] nums) {
          List<List<Integer>> ret = new ArrayList<>();
          int n = nums.length;
          if (n < 3) return ret; // è¾¹ç•Œæ£€æŸ¥
          
          Arrays.sort(nums); // æ’åº
          if (nums[0] > 0) return ret; // æå‰ç»ˆæ­¢
          
          for (int i = 0; i < n - 2; i++) {
              if (i > 0 && nums[i] == nums[i - 1]) continue; // å»é‡ nums[i]
              
              int left = i + 1, right = n - 1;
              while (right > left) {
                  int sum = nums[i] + nums[left] + nums[right];
                  if (sum == 0) {
                      ret.add(Arrays.asList(nums[i], nums[left], nums[right]));
                      while (right > left && nums[left] == nums[left + 1]) left++; // å»é‡ nums[left]
                      while (right > left && nums[right] == nums[right - 1]) right--; // å»é‡ nums[right]
                      left++;
                      right--;
                  } else if (sum < 0) {
                      left++;
                  } else {
                      right--;
                  }
              }
          }
          return ret;
      }
  }
  ```
  
  ---
  
  #### 4. å¤æ‚åº¦åˆ†æ
  - **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n^2)`  
    - æ’åºï¼š`O(n log n)`  
    - åŒæŒ‡é’ˆï¼š`O(n^2)`  
  - **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼ˆå­˜å‚¨ç»“æœï¼‰
  
  ---
  
  #### 5. æ³¨æ„äº‹é¡¹
  - **å»é‡**ï¼šé€šè¿‡æ¯”è¾ƒç›¸é‚»å…ƒç´ å»é‡ï¼Œé¿å…ä½¿ç”¨ `List.contains()`ï¼ˆ`O(n)` æ•ˆç‡ä½ï¼‰ã€‚  
  - **è¾¹ç•Œ**ï¼šæ£€æŸ¥ `n < 3` å’Œ `nums[0] > 0`ã€‚  
  - **å¾ªç¯èŒƒå›´**ï¼š`i < n - 2` ç¡®ä¿å³ä¾§æœ‰è¶³å¤Ÿå…ƒç´ ã€‚
  
  #### ç¼–ç ä¹ æƒ¯é—®é¢˜ä¸æ”¹è¿›
  - **é—®é¢˜**ï¼š  
    - ä½¿ç”¨ `List.contains()` å»é‡æ•ˆç‡ä½ï¼Œå¯èƒ½è¶…æ—¶ã€‚  
    - å»é‡é€»è¾‘é”™è¯¯ï¼ˆå¦‚æ¯”è¾ƒ `nums[i] == nums[left]`ï¼‰ã€‚  
  - **æ”¹è¿›**ï¼š  
    1. å»é‡ç”¨æ’åºç‰¹æ€§ï¼Œè·³è¿‡é‡å¤å…ƒç´ ã€‚  
    2. ç¡®ä¿è¾¹ç•Œæ£€æŸ¥å®Œæ•´ï¼Œå…ˆæ£€æŸ¥é•¿åº¦å†è®¿é—®å…ƒç´ ã€‚  
  - **å¥½å¤„**ï¼šæé«˜æ•ˆç‡ï¼Œé™ä½å¤æ‚åº¦ã€‚
  
  ---
  
  #### 6. æ€»ç»“ä¸å­¦ä¹ å»ºè®®
  - **æ€»ç»“**ï¼šæ’åº + åŒæŒ‡é’ˆæ˜¯é«˜æ•ˆè§£æ³•ï¼Œæ³¨æ„å»é‡å’Œè¾¹ç•Œã€‚  
  - **å»ºè®®**ï¼š  
    1. ç»ƒä¹ å»é‡æŠ€å·§ï¼šæ’åºåè·³è¿‡é‡å¤å…ƒç´ ã€‚  
    2. é¿å…ä½æ•ˆæ“ä½œï¼šä¸ç”¨ `List.contains()`ã€‚  
    3. æ‰©å±•é¢˜ç›®ï¼š**LeetCode 18. å››æ•°ä¹‹å’Œ**ã€**LeetCode 16. æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ**ã€‚

## åŠ¨æ€è§„åˆ’

### æœ€å¤§å­æ•°ç»„å’Œï¼ˆLeetCode 53ï¼‰

#### é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums`ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚

**å­æ•°ç»„** æ˜¯æ•°ç»„ä¸­çš„ä¸€ä¸ªè¿ç»­éƒ¨åˆ†ã€‚

------

#### ç¤ºä¾‹

- è¾“å…¥: `nums = [-2,1,-3,4,-1,2,1,-5,4]`
   è¾“å‡º: `6`
   è§£é‡Š: å­æ•°ç»„ `[4,-1,2,1]` çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚
- è¾“å…¥: `nums = [1]`
   è¾“å‡º: `1`
- è¾“å…¥: `nums = [5,4,-1,7,8]`
   è¾“å‡º: `23`

------

#### è§£é¢˜æ€è·¯

##### æ–¹æ³•ä¸€ï¼šæš´åŠ›è§£æ³•

1. éå†æ‰€æœ‰å¯èƒ½çš„å­æ•°ç»„ã€‚
2. è®¡ç®—æ¯ä¸ªå­æ•°ç»„çš„å’Œï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ªå˜é‡ `maxSum` ä¿å­˜æœ€å¤§çš„å­æ•°ç»„å’Œã€‚
3. æ—¶é—´å¤æ‚åº¦ä¸º O(n^2)ã€‚

**æš´åŠ›è§£æ³•ä»£ç ï¼š**

```java
class Solution {
    public int maxSubArray(int[] nums) {
        int maxSum = Integer.MIN_VALUE; // åˆå§‹æœ€å¤§å€¼
        for (int i = 0; i < nums.length; i++) {
            int currentSum = 0;
            for (int j = i; j < nums.length; j++) {
                currentSum += nums[j]; // ç´¯åŠ å­æ•°ç»„å…ƒç´ 
                maxSum = Math.max(maxSum, currentSum); // æ›´æ–°æœ€å¤§å€¼
            }
        }
        return maxSum;
    }
}
```

------

##### æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’ï¼ˆKadane'sç®—æ³•ï¼‰

1. å®šä¹‰çŠ¶æ€ï¼š

   - `dp[i]` è¡¨ç¤ºä»¥ç¬¬ `i` ä¸ªå…ƒç´ ç»“å°¾çš„æœ€å¤§å­æ•°ç»„å’Œã€‚

2. çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š

   - å¦‚æœå°† `nums[i]` ä¸å‰é¢çš„å­æ•°ç»„è¿æ¥ï¼Œç»“æœæ¯” `nums[i]` å¤§ï¼Œåˆ™é€‰æ‹©è¿æ¥ã€‚

   - å¦åˆ™ä»¥ `nums[i]` å¼€å§‹æ–°çš„å­æ•°ç»„ã€‚

   - è½¬ç§»æ–¹ç¨‹ä¸ºï¼š

     ```java
     dp[i] = Math.max(dp[i-1] + nums[i], nums[i])
     ```

3. åˆå§‹çŠ¶æ€ï¼š

   - `dp[0] = nums[0]`

4. ä¼˜åŒ–ï¼šåŠ¨æ€è§„åˆ’åªéœ€è®°å½•å½“å‰çŠ¶æ€å’Œæœ€å¤§å€¼ï¼Œå› æ­¤å¯ä»¥å°†ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–ä¸º O(1)ã€‚

**åŠ¨æ€è§„åˆ’ä»£ç ï¼š**

```java
class Solution {
    public int maxSubArray(int[] nums) {
        int maxSum = nums[0]; // åˆå§‹åŒ–æœ€å¤§å€¼
        int currentSum = nums[0]; // å½“å‰å­æ•°ç»„å’Œ

        for (int i = 1; i < nums.length; i++) {
            currentSum = Math.max(currentSum + nums[i], nums[i]); // çŠ¶æ€è½¬ç§»
            maxSum = Math.max(maxSum, currentSum); // æ›´æ–°æœ€å¤§å€¼
        }

        return maxSum;
    }
}
```

------

#### æ¯”è¾ƒåˆ†æ

| æ–¹æ³•     | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | ä¼˜ç‚¹                         | ç¼ºç‚¹                   |
| -------- | ---------- | ---------- | ---------------------------- | ---------------------- |
| æš´åŠ›è§£æ³• | O(n^2)     | O(1)       | é€»è¾‘ç®€å•ï¼Œå®¹æ˜“å®ç°           | æ—¶é—´å¤æ‚åº¦è¾ƒé«˜ï¼Œæ•ˆç‡ä½ |
| åŠ¨æ€è§„åˆ’ | O(n)       | O(1)       | æ—¶é—´å¤æ‚åº¦ä½ï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ® | éœ€è¦ç†è§£çŠ¶æ€è½¬ç§»æ–¹ç¨‹   |

------

#### ç¬”è®°æ€»ç»“

1. **åŠ¨æ€è§„åˆ’æ ¸å¿ƒ**ï¼š
    å°†é—®é¢˜åˆ†è§£ä¸ºå­é—®é¢˜ï¼Œåˆ©ç”¨å­é—®é¢˜çš„æœ€ä¼˜è§£æ¥æ¨å¯¼æ•´ä¸ªé—®é¢˜çš„æœ€ä¼˜è§£ã€‚
2. **Kadane'sç®—æ³•** æ˜¯åŠ¨æ€è§„åˆ’çš„ç®€åŒ–å®ç°ï¼Œä¼˜åŒ–äº†ç©ºé—´å¤æ‚åº¦ã€‚
3. æ¨èä½¿ç”¨åŠ¨æ€è§„åˆ’è§£æ³•ï¼Œå°¤å…¶åœ¨è¾“å…¥è§„æ¨¡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦ O(n) æ›´é«˜æ•ˆ

## å“ˆå¸Œè¡¨

### 1.ä¸¤æ•°å­—ä¹‹å’Œ

- ç›´æ¥æš´åŠ›

å¤æ‚åº¦Oï¼ˆnæ–¹ï¼‰

```java
class Solution {
    public int[] twoSum(int[] nums, int target) {
        for (int i = 0; i < nums.length - 1; i++) {
            for (int j = i + 1; j < nums.length; j++) {
                if (nums[i] + nums[j] == target) {
                    return new int[]{i, j};
                }
            }
        }
        return null;
    }
}

```

- å“ˆå¸Œè¡¨

```java
class Solution {
    public int[] twoSum(int[] nums, int target) {
        Map<Integer,Integer> map = new HashMap<>();
        for(int i = 0; i < nums.length; i++){
            int subSum = target - nums[i];
            if(map.containsKey(subSum)){
                return new int[]{map.get(subSum),i};
            }
            else map.put(nums[i],i);
        }
        return null;
    }
}

```

### 2.æœ€é•¿åºåˆ—å’Œ(å¤æ‚åº¦on)

#### é¢˜ç›®æè¿°

â€‹	ç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ `nums` ï¼Œæ‰¾å‡ºæ•°å­—è¿ç»­çš„æœ€é•¿åºåˆ—ï¼ˆä¸è¦æ±‚åºåˆ—å…ƒç´ åœ¨åŸæ•°ç»„ä¸­è¿ç»­ï¼‰çš„é•¿åº¦ã€‚

è¯·ä½ è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º `O(n)` çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šnums = [100,4,200,1,3,2]
è¾“å‡ºï¼š4
è§£é‡Šï¼šæœ€é•¿æ•°å­—è¿ç»­åºåˆ—æ˜¯ [1, 2, 3, 4]ã€‚å®ƒçš„é•¿åº¦ä¸º 4
```

#### ä¼˜åŒ–æ€è·¯ï¼ˆä½¿ç”¨ HashSetï¼‰

- æ ¸å¿ƒæ€æƒ³ï¼š

  - å°†æ‰€æœ‰æ•°å­—æ”¾å…¥ HashSetï¼Œåˆ©ç”¨å…¶ O(1) çš„æŸ¥æ‰¾æ•ˆç‡ã€‚
  - åªä»æ¯ä¸ªå¯èƒ½çš„åºåˆ—èµ·ç‚¹ï¼ˆå³æ²¡æœ‰å‰é©±çš„æ•°å­—ï¼‰å¼€å§‹æ‰©å±•ï¼Œè¿™æ ·é¿å…é‡å¤è®¡ç®—ã€‚
  - ä¸€ä¸ªæ•°å­— num å¦‚æœæ˜¯åºåˆ—èµ·ç‚¹ï¼Œè¯´æ˜ num - 1 ä¸åœ¨é›†åˆä¸­ã€‚

- æ­¥éª¤ï¼š

  1. å°†æ•°ç»„ nums æ”¾å…¥ HashSetã€‚

  2. éå†æ•°ç»„ä¸­çš„æ¯ä¸ªæ•°å­— 

     num

     ï¼š

     - å¦‚æœ num - 1 ä¸åœ¨ HashSet ä¸­ï¼Œåˆ™ä»¥ num ä¸ºèµ·ç‚¹ï¼Œæ‰©å±•è¿ç»­åºåˆ—ã€‚
     - ä» num å¼€å§‹ï¼Œæ£€æŸ¥ num + 1, num + 2, ...ï¼Œç›´åˆ°åºåˆ—æ–­å¼€ã€‚
     - è®°å½•å½“å‰åºåˆ—é•¿åº¦ï¼Œå¹¶æ›´æ–°æœ€å¤§é•¿åº¦ã€‚

  3. è¿”å›æœ€å¤§é•¿åº¦ã€‚

- **æ—¶é—´å¤æ‚åº¦ï¼š** O(n)ï¼ˆæ¯ä¸ªæ•°å­—æœ€å¤šè¢«è®¿é—®ä¸€æ¬¡ï¼‰ã€‚

- **ç©ºé—´å¤æ‚åº¦ï¼š** O(n)ï¼ˆå­˜å‚¨ HashSetï¼‰ã€‚

#### ä¸ºä»€ä¹ˆæ˜¯ O(n)ï¼Ÿ

- æ¯ä¸ªæ•°å­—æœ€å¤šè¢«è®¿é—®ä¸¤æ¬¡ï¼šä¸€æ¬¡ä½œä¸ºèµ·ç‚¹ï¼Œä¸€æ¬¡ä½œä¸ºæ‰©å±•ä¸­çš„å…ƒç´ ã€‚
- HashSet çš„æŸ¥æ‰¾å’Œæ·»åŠ æ“ä½œæ˜¯ O(1)ã€‚
- æ€»æ—¶é—´å¤æ‚åº¦ç”±æ•°ç»„é•¿åº¦ n å†³å®šã€‚

```java
class Solution {
    public int longestConsecutive(int[] nums) {
        if(nums.length == 0) return 0;
        Set<Integer> set = new HashSet<>();
        for(int num : nums){
            set.add(num);
        }
        int max = 1;
        for(Integer num : set){
            int tempMax = 1;
            if(set.contains(num - 1)){
                continue;
            }
            //æ˜¯èµ·ç‚¹
            while(set.contains(num + 1)){
                //å‘åæ‰©å±•
                num = num + 1;
                tempMax++;
            }
            if(max < tempMax){
                max = tempMax;
            }
        }
        return max;
    }
}
```



### 3.[å’Œä¸º K çš„å­æ•°ç»„](https://leetcode.cn/problems/subarray-sum-equals-k/)

**æè¿°**ï¼š ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` å’Œä¸€ä¸ªæ•´æ•° `k` ï¼Œè¯·ä½ ç»Ÿè®¡å¹¶è¿”å› *è¯¥æ•°ç»„ä¸­å’Œä¸º `k` çš„å­æ•°ç»„çš„ä¸ªæ•°* ã€‚

å­æ•°ç»„æ˜¯æ•°ç»„ä¸­å…ƒç´ çš„è¿ç»­éç©ºåºåˆ—ã€‚

 

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šnums = [1,1,1], k = 2
è¾“å‡ºï¼š2
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šnums = [1,2,3], k = 3
è¾“å‡ºï¼š2
```

**æ ¸å¿ƒæ€è·¯**ï¼šå‰ç¼€å’Œ+å“ˆå¸Œè¡¨

**ç”¨å½“å‰å‰ç¼€å’Œ  - kå€¼ï¼Œå¦‚æœè¿™ä¸ªå€¼å­˜åœ¨åœ¨åŸæœ‰çš„å“ˆå¸Œè¡¨ä¸­ï¼Œé‚£å°±å­˜åœ¨å­æ•°ç»„**

â€‹	





 code

```java
 public int subarraySum(int[] nums, int k) {
        //ç”¨å“ˆå¸Œè¡¨å­˜å‚¨å‰ç¼€å’Œå’Œå‡ºç°çš„æ¬¡æ•°
        Map<Integer,Integer> preSum = new HashMap<>();
        //0é»˜è®¤åœ¨å‰ç¼€å’Œé‡Œé¢
        preSum.put(0,1);
        int sum = 0;
        int ret = 0;
        //å­˜å‚¨å‰ç¼€å’Œ
        for(int i = 0; i < nums.length; i++){
            sum += nums[i];
            //å¦‚æœå­˜åœ¨sum-kçš„å‰ç¼€å’Œï¼Œåˆ™è¯´æ˜å­˜åœ¨å­æ•°ç»„
            if(preSum.containsKey(sum - k)){
                ret += preSum.get(sum - k);
            }
            //æ›´æ–°å‰ç¼€å’Œ
            preSum.put(sum,preSum.getOrDefault(sum,0) + 1);
        }

        return ret;
    }
```



## é“¾è¡¨

### åˆ é™¤å€’æ˜¯ç¬¬nä¸ªèŠ‚ç‚¹

#### 1. æè¿°
ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤å€’æ•°ç¬¬ `n` ä¸ªèŠ‚ç‚¹ï¼Œå¹¶è¿”å›å¤´èŠ‚ç‚¹ã€‚

**ç¤ºä¾‹**ï¼š  
- è¾“å…¥ï¼š`head = [1], n = 1`  
- è¾“å‡ºï¼š`[]`  
- è§£é‡Šï¼šåˆ é™¤å”¯ä¸€èŠ‚ç‚¹åï¼Œé“¾è¡¨ä¸ºç©ºã€‚

**çº¦æŸ**ï¼š  
- é“¾è¡¨èŠ‚ç‚¹æ•°ä¸º `sz`ï¼Œ`1 <= sz <= 30`  
- `0 <= Node.val <= 100`  
- `1 <= n <= sz`

---

#### 2. æ–¹æ³• 1ï¼šè®¡ç®—é•¿åº¦æ³•
##### 2.1 æ ¸å¿ƒæ€è·¯
1. éå†é“¾è¡¨ï¼Œè®¡ç®—é•¿åº¦ `count`ã€‚  
2. å¤„ç†ç‰¹æ®Šæƒ…å†µï¼š  
   - å¦‚æœ `count == 1`ï¼Œè¿”å› `null`ã€‚  
   - å¦‚æœ `n == count`ï¼Œåˆ é™¤å¤´èŠ‚ç‚¹ï¼Œè¿”å› `head.next`ã€‚  
3. éå†åˆ°å€’æ•°ç¬¬ `n+1` ä¸ªèŠ‚ç‚¹ï¼Œåˆ é™¤å…¶ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚

##### 2.2 ä»£ç å®ç°
```java
class Solution {
    public ListNode removeNthFromEnd(ListNode head, int n) {
        // è®¡ç®—é“¾è¡¨é•¿åº¦
        int count = 0;
        ListNode countNode = head;
        while (countNode != null) {
            count++;
            countNode = countNode.next;
        }
        
        // ç‰¹æ®Šæƒ…å†µï¼šåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹
        if (count == 1) {
            return null;
        }
        
        // ç‰¹æ®Šæƒ…å†µï¼šåˆ é™¤å¤´èŠ‚ç‚¹
        if (n == count) {
            return head.next;
        }
        
        // æ‰¾åˆ°å€’æ•°ç¬¬ n+1 ä¸ªèŠ‚ç‚¹
        ListNode curNode = head;
        int tarIndex = 1;
        while (tarIndex < count - n) {
            curNode = curNode.next;
            tarIndex++;
        }
        // åˆ é™¤å€’æ•°ç¬¬ n ä¸ªèŠ‚ç‚¹
        curNode.next = curNode.next.next;
        
        return head;
    }
}
```

##### 2.3 å¤æ‚åº¦åˆ†æ
- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`  
  - ç¬¬ä¸€æ¬¡éå†ï¼š`O(n)`ã€‚  
  - ç¬¬äºŒæ¬¡éå†ï¼š`O(n)`ã€‚  
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(1)`  
  - åªä½¿ç”¨å¸¸æ•°é¢å¤–ç©ºé—´ã€‚

##### 2.4 ä¼˜ç¼ºç‚¹
- **ä¼˜ç‚¹**ï¼š  
  - é€»è¾‘ç›´è§‚ï¼Œæ˜“äºç†è§£ã€‚  
  - ç‰¹æ®Šæƒ…å†µå¤„ç†æ¸…æ™°ã€‚  
- **ç¼ºç‚¹**ï¼š  
  - éœ€è¦ä¸¤æ¬¡éå†ï¼Œå®é™…æ“ä½œæ¬¡æ•°è¾ƒå¤šã€‚  
  - å‘½åä¸å¤Ÿç›´è§‚ï¼ˆ`countNode`ã€`tarIndex`ï¼‰ã€‚  
  - ç¼ºå°‘é˜²å¾¡æ€§æ£€æŸ¥ï¼ˆå¦‚ `head == null`ï¼‰ã€‚

---

#### 3. æ–¹æ³• 2ï¼šå¿«æ…¢æŒ‡é’ˆæ³•
##### 3.1 æ ¸å¿ƒæ€è·¯
1. ä½¿ç”¨å“‘èŠ‚ç‚¹ï¼Œç»Ÿä¸€å¤„ç†åˆ é™¤å¤´èŠ‚ç‚¹çš„æƒ…å†µã€‚  
2. å¿«æŒ‡é’ˆå…ˆèµ° `n` æ­¥ã€‚  
3. å¿«æ…¢æŒ‡é’ˆä¸€èµ·èµ°ï¼Œç›´åˆ°å¿«æŒ‡é’ˆåˆ°è¾¾æœ«å°¾ï¼Œæ…¢æŒ‡é’ˆæŒ‡å‘å€’æ•°ç¬¬ `n+1` ä¸ªèŠ‚ç‚¹ã€‚  
4. åˆ é™¤æ…¢æŒ‡é’ˆçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚

##### 3.2 ä»£ç å®ç°
```java
class Solution {
    public ListNode removeNthFromEnd(ListNode head, int n) {
        // é˜²å¾¡æ€§æ£€æŸ¥
        if (head == null) return null;
        
        // ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆ
        ListNode dummy = new ListNode(0, head);
        ListNode fast = dummy;
        ListNode slow = dummy;
        
        // å¿«æŒ‡é’ˆå…ˆèµ° n æ­¥
        for (int i = 0; i < n; i++) {
            fast = fast.next;
        }
        
        // å¿«æ…¢æŒ‡é’ˆä¸€èµ·èµ°
        while (fast.next != null) {
            fast = fast.next;
            slow = slow.next;
        }
        
        // åˆ é™¤å€’æ•°ç¬¬ n ä¸ªèŠ‚ç‚¹
        slow.next = slow.next.next;
        
        return dummy.next;
    }
}
```

##### 3.3 å¤æ‚åº¦åˆ†æ
- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`  
  - ä¸€æ¬¡éå†ï¼š`O(n)`ã€‚  
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(1)`  
  - åªä½¿ç”¨å¸¸æ•°é¢å¤–ç©ºé—´ã€‚

##### 3.4 ä¼˜ç¼ºç‚¹
- **ä¼˜ç‚¹**ï¼š  
  - ä¸€æ¬¡éå†ï¼Œæ•ˆç‡æ›´é«˜ã€‚  
  - ä½¿ç”¨å“‘èŠ‚ç‚¹ï¼Œç»Ÿä¸€å¤„ç†ç‰¹æ®Šæƒ…å†µã€‚  
  - å‘½åç›´è§‚ï¼ˆ`fast`ã€`slow`ï¼‰ã€‚  
- **ç¼ºç‚¹**ï¼š  
  - é€»è¾‘ç¨å¤æ‚ï¼Œåˆå­¦è€…å¯èƒ½ä¸æ˜“ç†è§£ã€‚  
  - éœ€è¦é¢å¤–å“‘èŠ‚ç‚¹ï¼ˆç©ºé—´ä»ä¸º `O(1)`ï¼‰ã€‚

---

#### 4. æ–¹æ³•å¯¹æ¯”
| **æ–¹é¢**         | **è®¡ç®—é•¿åº¦æ³•**                      | **å¿«æ…¢æŒ‡é’ˆæ³•**         |
| ---------------- | ----------------------------------- | ---------------------- |
| **æ—¶é—´å¤æ‚åº¦**   | `O(n)`ï¼ˆä¸¤æ¬¡éå†ï¼‰                  | `O(n)`ï¼ˆä¸€æ¬¡éå†ï¼‰     |
| **å®é™…æ•ˆç‡**     | è¾ƒæ…¢ï¼ˆæ“ä½œæ¬¡æ•°æ¥è¿‘ `2n`ï¼‰           | è¾ƒå¿«ï¼ˆæ“ä½œæ¬¡æ•°ä¸º `n`ï¼‰ |
| **ç©ºé—´å¤æ‚åº¦**   | `O(1)`                              | `O(1)`                 |
| **ä»£ç å¯è¯»æ€§**   | ç›´è§‚ï¼Œé€‚åˆåˆå­¦è€…                    | ç¨å¤æ‚ï¼Œä½†é€»è¾‘æ›´ä¼˜é›…   |
| **ç‰¹æ®Šæƒ…å†µå¤„ç†** | æ˜¾å¼å¤„ç†ï¼Œåˆ†æ”¯è¾ƒå¤š                  | ä½¿ç”¨å“‘èŠ‚ç‚¹ï¼Œç»Ÿä¸€å¤„ç†   |
| **å‘½å**         | ä¸å¤Ÿç›´è§‚ï¼ˆ`countNode`ã€`tarIndex`ï¼‰ | ç›´è§‚ï¼ˆ`fast`ã€`slow`ï¼‰ |

---



### ç›¸äº¤é“¾è¡¨

- é€šè¿‡hashè¡¨ï¼Œå…ˆæŠŠAé“¾è¡¨çš„æ‰€æœ‰nodeå­˜å…¥seté›†åˆï¼Œç„¶åå†éå†Bé“¾è¡¨ï¼Œå¦‚æœbé“¾è¡¨çš„æŸä¸ªnodeåœ¨é›†åˆä¸­ï¼Œå°±ç›´æ¥è¿”å›è¿™ä¸ªèŠ‚ç‚¹

```java
/**
 * Definition for singly-linked list.
 * public class ListNode {
 *     int val;
 *     ListNode next;
 *     ListNode(int x) {
 *         val = x;
 *         next = null;
 *     }
 * }
 */
public class Solution {
    public ListNode getIntersectionNode(ListNode headA, ListNode headB) {
        Set<ListNode> nodeSet = new HashSet<>();
        ListNode visitA = headA;
        while(visitA != null){
            nodeSet.add(visitA);
            visitA = visitA.next;
        }
        visitA = headB;
        while(visitA != null){
            if(nodeSet.contains(visitA)) return visitA;
            else visitA = visitA.next;
        }
        return null;
    }
}
```



# ç®€å†åº“

## æœ‰ç”¨å‹å®ä¹ å‚è€ƒ

<img src="https://uploadfiles.nowcoder.com/message_images/20241025/850730041_1729829149938/discuss_1729829150082.jpeg?x-oss-process=image%2Fresize%2Cw_276%2Ch_276%2Cm_mfit%2Fformat%2Cpng" alt="img"  />

# è®¡ç½‘

## Httpå’ŒHttpsçš„åŒºåˆ«ï¼Ÿä»–æ˜¯å¦‚ä½•è§£å†³åŠ å¯†é—®é¢˜çš„

- é™¤æ­¤ä¹‹å¤–ï¼Œ**æ€§èƒ½ä¸ŠHttpsä¼šæ¶ˆè€—æ›´å¤šçš„æœåŠ¡å™¨èµ„æº**

![image-20250109155510570](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109155510570.png)

### å¦‚ä½•è§£å†³åŠ å¯†



### å…³é”®è¯

- **æ··åˆåŠ å¯†+æ‘˜è¦ç®—æ³•+æ•°å­—ç­¾å+CAè®¤è¯**

ä¸»è¦è§£å†³äº†ä¸‰ä¸ªé—®é¢˜ï¼š

- **ä¿¡æ¯åŠ å¯†**ï¼šé˜²æ­¢ä¼ è¾“è¿‡ç¨‹çš„æ˜æ–‡è¢«çªƒå–ï¼Œä½¿ç”¨**æ··åˆåŠ å¯†**ï¼ˆå»ºç«‹è¿æ¥å‰éå¯¹ç§°åŠ å¯†ï¼Œå»ºç«‹è¿æ¥ä¹‹åå¯¹ç§°åŠ å¯†ï¼‰çš„æ–¹å¼ã€‚
- **æ ¡éªŒæœºåˆ¶**ï¼šä½¿ç”¨**æ‘˜è¦ç®—æ³•ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰+æ•°å­—ç­¾å**ï¼Œä¸ºåŸå§‹æ•°æ®ç”Ÿæˆç‹¬ä¸€æ— äºŒçš„æŒ‡çº¹ï¼ˆcodeï¼‰ï¼Œæ£€éªŒå‰åçš„æŒ‡çº¹æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´çš„è¯å°±ä¸å±•ç¤ºï¼Œè§£å†³äº†**ç¯¡æ”¹é£é™©**	
- **èº«ä»½éªŒè¯**ï¼šé€šè¿‡å…¬é’¥æ¥éªŒè¯æœåŠ¡å™¨èº«ä»½ã€‚

**å“ˆå¸Œå‡½æ•°**æ¥ä¿è¯åŠ å¯†çš„å®Œæ•´æ€§ï¼Œ**æ•°å­—ç­¾åæ¥ä¿è¯æ¶ˆæ¯æ¥æºçš„å¯é æ€§**

![image-20250109161258652](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109161258652.png)

*è¿˜æ²¡æœ‰å¢åŠ æ•°å­—ç­¾åä¹‹å‰çš„æµç¨‹*

![img](https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/HTTP/%E6%91%98%E8%A6%81%E7%AE%97%E6%B3%95.png)

### æ•°å­—ç­¾åç®—æ³•

![image-20250109164021436](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109164021436.png)

åŠ äº†æ•°å­—ç­¾åä¹‹å

![image-20250109164132370](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109164132370.png)

### æ•°å­—è¯ä¹¦

ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†çš„æ–¹å¼å¯ä»¥ç¡®å®šä¸€ç»„ç­¾åçš„å¯é æ€§ï¼Œä½†æ˜¯æ— æ³•è¾¨åˆ«**ç§é’¥çš„æ¥æºæ˜¯å¦æ˜¯æƒ³è¦æ¥æº**ï¼Œå°±æ¯”å¦‚å§ç§é’¥å’Œå…¬é’¥ä¸€èµ·ç¯¡æ”¹äº†ï¼Œé‚£è¿™æ ·è¯†åˆ«æ˜¯å¯ä»¥é€šè¿‡ï¼Œä½†æ˜¯å´æ˜¯å†’ç‰Œçš„æ•°æ®

![image-20250109164607956](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109164607956.png)

æ‰€ä»¥éœ€è¦é€šè¿‡å°†ç§é’¥æ”¾å…¥**CA**æœåŠ¡å™¨è¿›è¡Œè®¤è¯ï¼Œæ¥è®¤è¯ä¸€ä¸‹å‘é€çš„æ•°æ®æºæ˜¯å¦æ˜¯æƒ³è¦çš„

![image-20250109165001375](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109165001375.png)

## TCP

**æ–‡æ¡£**ï¼š[TCPå°æ—Coding](https://xiaolincoding.com/network/3_tcp/tcp_interview.html#)

### TCPå’ŒUDPçš„åŒºåˆ«ï¼Ÿ

![TCP å¤´æ ¼å¼](https://cdn.xiaolincoding.com//mysql/other/format,png-20230309230534096.png)

![image-20250107173309905](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250107173309905.png)

![image-20250107172916015](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250107172916015.png)

![image-20250107172938404](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250107172938404.png)

![image-20250107173012445](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250107173012445.png)

![image-20250107173210993](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250107173210993.png)

- UDPçš„å¤´éƒ¨æ²¡æœ‰**é¦–éƒ¨é•¿åº¦**ï¼Œå› ä¸ºUDPçš„é¦–éƒ¨é•¿åº¦æ˜¯å›ºå®šçš„
- TCPæ²¡æœ‰**åŒ…é•¿åº¦**ï¼Œå› ä¸ºTCPçš„åŒ…é•¿åº¦å¯ä»¥ä½¿ç”¨ä¸€å®šçš„å…¬å¼è®¡ç®—å‡ºæ¥

![image-20250107173444882](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250107173444882.png)

```
+-------------------------+-------------------------+
|         TCP             |         UDP             |
+-------------------------+-------------------------+
| é¢å‘è¿æ¥               | æ— è¿æ¥                 |
| å¯é æ€§é«˜               | ä¸ä¿è¯å¯é æ€§           |
| æœ‰åºæ•°æ®ä¼ è¾“           | æ•°æ®å¯èƒ½ä¹±åº           |
| é€Ÿåº¦è¾ƒæ…¢               | é€Ÿåº¦è¾ƒå¿«               |
| åº”ç”¨åœºæ™¯ï¼šæ–‡ä»¶ä¼ è¾“ç­‰   | åº”ç”¨åœºæ™¯ï¼šå®æ—¶æµåª’ä½“ç­‰ |
+-------------------------+-------------------------+
```



### TCPçš„ä¸‰æ¬¡æ¡æ‰‹

#### å›ç­”é‡ç‚¹

TCP çš„ä¸‰æ¬¡æ¡æ‰‹æ˜¯å»ºç«‹å¯é è¿æ¥çš„è¿‡ç¨‹ï¼Œç”¨äºç¡®ä¿é€šä¿¡åŒæ–¹å‡†å¤‡å°±ç»ªå¹¶äº¤æ¢å¿…è¦ä¿¡æ¯ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

1. **ç¬¬ä¸€æ¬¡æ¡æ‰‹**ï¼š
    å®¢æˆ·ç«¯å‘é€ `SYN` æŠ¥æ–‡ï¼Œè¡¨ç¤ºè¯·æ±‚å»ºç«‹è¿æ¥ï¼Œå¹¶é™„ä¸Šåˆå§‹åºåˆ—å·ï¼ˆ`ISN(client)`ï¼‰ã€‚
   - æŠ¥æ–‡ï¼š`SYN=1, seq=ISN(client)`
   - æ„å›¾ï¼šå‘Šè¯‰æœåŠ¡ç«¯è‡ªå·±å‡†å¤‡å¥½å¹¶è¯·æ±‚é€šä¿¡ã€‚
2. **ç¬¬äºŒæ¬¡æ¡æ‰‹**ï¼š
    æœåŠ¡ç«¯æ”¶åˆ° `SYN` åï¼Œå›å¤ `SYN+ACK`ï¼Œè¡¨ç¤ºåŒæ„å»ºç«‹è¿æ¥ï¼Œå¹¶é™„ä¸Šè‡ªå·±çš„åˆå§‹åºåˆ—å·ï¼ˆ`ISN(server)`ï¼‰ã€‚
   - æŠ¥æ–‡ï¼š`SYN=1, ACK=ISN(client)+1, seq=ISN(server)`
   - æ„å›¾ï¼šå‘Šè¯‰å®¢æˆ·ç«¯è‡ªå·±ä¹Ÿå·²å‡†å¤‡å¥½ï¼Œå¹¶ç¡®è®¤å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚
3. **ç¬¬ä¸‰æ¬¡æ¡æ‰‹**ï¼š
    å®¢æˆ·ç«¯æ”¶åˆ° `SYN+ACK` åï¼Œå›å¤ä¸€ä¸ª `ACK` æŠ¥æ–‡ï¼Œç¡®è®¤æœåŠ¡ç«¯çš„ä¿¡æ¯ã€‚
   - æŠ¥æ–‡ï¼š`ACK=ISN(server)+1, seq=ISN(client)+1`
   - æ„å›¾ï¼šå‘Šè¯‰æœåŠ¡ç«¯è¿æ¥å·²ç¡®è®¤å®Œæˆã€‚

å®Œæˆä¸Šè¿°ä¸‰æ¬¡æ¡æ‰‹åï¼Œè¿æ¥å»ºç«‹æˆåŠŸï¼ŒåŒæ–¹å¯ä»¥å¼€å§‹æ•°æ®ä¼ è¾“ã€‚

------

#### è¯¦ç»†è§£æ

##### ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ

- ç¡®ä¿é€šä¿¡åŒæ–¹å‡†å¤‡å°±ç»ªï¼š
  - ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯ç¡®è®¤è‡ªå·±èƒ½å‘é€ï¼ŒæœåŠ¡ç«¯èƒ½æ¥æ”¶ã€‚
  - ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡ç«¯ç¡®è®¤è‡ªå·±èƒ½å‘é€ï¼Œå®¢æˆ·ç«¯èƒ½æ¥æ”¶ã€‚
  - ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯ç¡®è®¤æœåŠ¡ç«¯çš„ç¡®è®¤ä¿¡æ¯ï¼ŒåŒæ–¹åŒæ­¥é€šä¿¡çŠ¶æ€ã€‚
- **é˜²æ­¢å†å²è¿æ¥è¯¯è§¦ï¼š**
   æ—§çš„ SYN è¯·æ±‚å¯èƒ½è¢«è¯¯å¤„ç†ï¼Œå¦‚æœæ²¡æœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ç¡®è®¤ï¼Œä¼šå¯¼è‡´æœåŠ¡ç«¯è¯¯ä»¥ä¸ºå»ºç«‹äº†æ–°çš„è¿æ¥ï¼Œæµªè´¹èµ„æºã€‚

##### ç¤ºä¾‹çŠ¶æ€å˜åŒ–

1. å®¢æˆ·ç«¯ä» `CLOSED â†’ SYN-SENT`ã€‚
2. æœåŠ¡ç«¯ä» `CLOSED â†’ SYN-RECEIVED`ï¼Œå‘é€ `SYN+ACK`ã€‚
3. å®¢æˆ·ç«¯ä» `SYN-SENT â†’ ESTABLISHED`ï¼Œå‘é€ `ACK`ã€‚
4. æœåŠ¡ç«¯ä» `SYN-RECEIVED â†’ ESTABLISHED`ï¼Œå®Œæˆè¿æ¥ã€‚

------

#### çŸ¥è¯†æ‰©å±•

ä¸‹å›¾å±•ç¤ºäº†ä¸‰æ¬¡æ¡æ‰‹çš„äº¤äº’æµç¨‹ï¼š

```
å®¢æˆ·ç«¯                        æœåŠ¡ç«¯
  | ----SYN(seq=x)---->        |
  |                           |
  | <----SYN+ACK(seq=y, ack=x+1)-- |
  |                           |
  | ----ACK(ack=y+1)---->      |
  |                           |
```

- `SYN`ï¼šåŒæ­¥åºåˆ—å·ï¼Œç”¨äºå»ºç«‹è¿æ¥ã€‚
- `ACK`ï¼šç¡®è®¤åºåˆ—å·ï¼Œç¡®ä¿æŠ¥æ–‡æ¥æ”¶æ— è¯¯ã€‚

------

#### æ€»ç»“

TCP çš„ä¸‰æ¬¡æ¡æ‰‹é€šè¿‡ `SYN` å’Œ `ACK` æŠ¥æ–‡åè°ƒåŒæ–¹çŠ¶æ€ï¼Œç¡®ä¿å¯é è¿æ¥çš„å»ºç«‹ï¼ŒåŒæ—¶é˜²æ­¢å†å²è¿æ¥å¹²æ‰°ï¼Œæ˜¯ TCP åè®®å¯é æ€§çš„åŸºç¡€æœºåˆ¶ä¹‹ä¸€ã€‚

![image-20250107174809806](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250107174809806.png)

**å‰ä¸¤æ¬¡çš„æ¡æ‰‹æ˜¯ä¸æºå¸¦æ•°æ®çš„**

### ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿä¸æ˜¯ä¸¤æ¬¡ã€å››æ¬¡ï¼Ÿ

**å›ç­”çš„é‡ç‚¹ä»TCP**ä¸ºä»€ä¹ˆä¸‰æ¬¡æ¡æ‰‹**æ‰**å¯ä»¥**åˆå§‹åŒ– Socketã€åºåˆ—å·å’Œçª—å£å¤§å°å¹¶å»ºç«‹ TCP è¿æ¥**ã€‚å…¥æ‰‹

ä¸¤æ¬¡æ¡æ‰‹ï¼š![image-20250108144916879](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250108144916879.png)

![image-20250108145018726](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250108145018726.png)

![ä¸¤æ¬¡æ¡æ‰‹ä¼šé€ æˆèµ„æºæµªè´¹](https://cdn.xiaolincoding.com//mysql/other/format,png-20230309230636571.png)

å››æ¬¡æ¡æ‰‹ï¼š![image-20250108144957600](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250108144957600.png)

#### å°ç»“

![image-20250108144744417](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250108144744417.png)

## WebSocketå’Œhttp

> websocketæœ€ä¸»è¦çš„ç‰¹å¾å°±æ˜¯ï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®

### **1. HTTP vs WebSocket**

- **HTTP åè®®ç‰¹ç‚¹**ï¼š
  - **åŠåŒå·¥**ï¼šå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å“åº”ï¼Œé€šä¿¡è¿‡ç¨‹æœ‰æ˜ç¡®çš„ä¸»ä»å…³ç³»ã€‚
  - **è¯·æ±‚/å“åº”æ¨¡å‹**ï¼šæœåŠ¡ç«¯æ— æ³•ä¸»åŠ¨æ¨é€æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚
  - **é€‚ç”¨åœºæ™¯**ï¼šé™æ€ç½‘é¡µã€æ™®é€šæ¥å£è°ƒç”¨ç­‰å•æ¬¡è¯·æ±‚-å“åº”çš„åœºæ™¯ã€‚
  
- **WebSocket åè®®ç‰¹ç‚¹**ï¼š
  - **å…¨åŒå·¥**ï¼šåŸºäº TCPï¼Œé€šä¿¡åŒæ–¹å¯éšæ—¶ä¸»åŠ¨å‘é€æ•°æ®ã€‚
  - **é•¿è¿æ¥**ï¼šåªéœ€ä¸€æ¬¡æ¡æ‰‹ï¼Œè¿æ¥ä¿æŒæœŸé—´å¯å¤šæ¬¡å‘é€æ•°æ®ï¼Œæ— éœ€é‡å¤åˆ›å»ºè¿æ¥ã€‚
  - **é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦é¢‘ç¹äº¤äº’ã€æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€çš„åœºæ™¯ï¼Œå¦‚å®æ—¶èŠå¤©ã€ç½‘é¡µæ¸¸æˆã€åä½œåŠå…¬ã€‚

- **ä¸ºä»€ä¹ˆéœ€è¦ WebSocketï¼Ÿ**
  - HTTP é€‚ç”¨äºé™æ€å†…å®¹äº¤äº’ï¼Œä½†åœ¨ **å®æ—¶é€šä¿¡** åœºæ™¯ä¸‹æ•ˆç‡ä½ï¼ˆå¦‚æ‰«ç ç™»å½•ã€å®æ—¶æ¨é€ï¼‰ã€‚
  - WebSocket è¡¥è¶³äº† HTTP çš„ä¸è¶³ï¼Œä¸ºå®æ—¶æ€§éœ€æ±‚æä¾›äº†é«˜æ•ˆè§£å†³æ–¹æ¡ˆã€‚

---

### **2. WebSocket è¿æ¥å»ºç«‹è¿‡ç¨‹**

1. **HTTP å‡çº§æœºåˆ¶**ï¼š
   - æµè§ˆå™¨å‘èµ· HTTP è¯·æ±‚æ—¶ï¼Œå¸¦ä¸Šä»¥ä¸‹ Headerï¼š
     - `Connection: Upgrade`
     - `Upgrade: websocket`
     - `Sec-WebSocket-Key`ï¼šéšæœº Base64 å­—ç¬¦ä¸²ï¼Œç”¨äºæ ¡éªŒã€‚
   - æœåŠ¡å™¨è¿”å›ï¼š
     - çŠ¶æ€ç  `101 Switching Protocols` è¡¨ç¤ºåè®®åˆ‡æ¢ã€‚
     - `Sec-WebSocket-Accept`ï¼šæ ¹æ®å®¢æˆ·ç«¯çš„ `Sec-WebSocket-Key` è®¡ç®—å¾—åˆ°ï¼Œç”¨äºéªŒè¯åˆæ³•æ€§ã€‚

2. **é€šä¿¡å»ºç«‹å**ï¼š
   - åŒæ–¹é€šè¿‡ WebSocket çš„æ•°æ®æ ¼å¼é€šä¿¡ï¼Œå®Œå…¨è„±ç¦» HTTPã€‚

---

### **3. WebSocket æŠ¥æ–‡æ ¼å¼**
- **å¸§ï¼ˆFrameï¼‰ç»“æ„**ï¼š
  - **FIN**ï¼šæ˜¯å¦æ˜¯æ¶ˆæ¯çš„æœ€åä¸€å¸§ã€‚
  - **Opcode**ï¼š
    - `0x1`ï¼šæ–‡æœ¬æ•°æ®ï¼ˆstringï¼‰ã€‚
    - `0x2`ï¼šäºŒè¿›åˆ¶æ•°æ®ï¼ˆbyte[]ï¼‰ã€‚
    - `0x8`ï¼šå…³é—­è¿æ¥ã€‚
  - **Payload length**ï¼šæ•°æ®é•¿åº¦ï¼ˆåŠ¨æ€ç¼–ç ï¼Œå¯èƒ½æ˜¯ 7ã€7+16 æˆ– 7+64 bitsï¼‰ã€‚
  - **Masking-key**ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€æ•°æ®æ—¶çš„æ©ç ï¼Œç”¨äºæ•°æ®åŠ å¯†ã€‚
  - **Payload data**ï¼šå®é™…æ•°æ®ã€‚

- **Payload é•¿åº¦ç¼–ç è§„åˆ™**ï¼š
  - 0-125ï¼šç›´æ¥ä½¿ç”¨ 7 bits è¡¨ç¤ºé•¿åº¦ã€‚
  - 126ï¼šé¢å¤–ä½¿ç”¨ 16 bits è¡¨ç¤ºé•¿åº¦ã€‚
  - 127ï¼šé¢å¤–ä½¿ç”¨ 64 bits è¡¨ç¤ºé•¿åº¦ã€‚

---

### **4. HTTP é•¿è½®è¯¢ï¼ˆLong Pollingï¼‰**
- **æœºåˆ¶**ï¼š
  - å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¸ç«‹å³å“åº”ï¼Œè€Œæ˜¯ä¿æŒè¿æ¥ç›´åˆ°æœ‰æ•°æ®æˆ–è¶…æ—¶ã€‚
  - è‹¥è¶…æ—¶æ— å“åº”ï¼Œå®¢æˆ·ç«¯é‡æ–°å‘èµ·ä¸‹ä¸€æ¬¡è¯·æ±‚ã€‚
- **ä¼˜ç‚¹**ï¼š
  - å‡å°‘é‡å¤è¯·æ±‚çš„å¸¦å®½æµªè´¹ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚
- **ç¼ºç‚¹**ï¼š
  - ä¿æŒè¿æ¥æ—¶é—´è¾ƒé•¿ï¼Œå ç”¨æœåŠ¡ç«¯èµ„æºï¼Œéæœ€ä½³å®æ—¶é€šä¿¡æ–¹å¼ã€‚

---

### **5. æœåŠ¡å™¨æ¨é€æŠ€æœ¯**
- **ä¼ªæ¨é€ï¼šè½®è¯¢**ï¼š
  - å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·è¯·æ±‚ï¼ˆçŸ­è½®è¯¢ã€é•¿è½®è¯¢ï¼‰ï¼Œçœ‹ä¼¼æœåŠ¡ç«¯æ¨é€ï¼Œå®é™…æ˜¯å®¢æˆ·ç«¯è¯·æ±‚ã€‚
- **çœŸæ¨é€ï¼šWebSocket**ï¼š
  - æœåŠ¡ç«¯ä¸»åŠ¨å°†æ¶ˆæ¯å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œæ— éœ€ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚ã€‚

---

### **6. ä½¿ç”¨åœºæ™¯**
1. **HTTP å®šæ—¶è½®è¯¢**ï¼š
   - åœºæ™¯ï¼šæ‰«ç ç™»å½•ã€ç®€å•çŠ¶æ€æ£€æŸ¥ã€‚
   - ç‰¹ç‚¹ï¼šå®ç°ç®€å•ï¼Œä½†ä¸é€‚åˆå¤æ‚å®æ—¶éœ€æ±‚ã€‚
2. **HTTP é•¿è½®è¯¢**ï¼š
   - åœºæ™¯ï¼šæ–‡ä»¶ä¸Šä¼ è¿›åº¦é€šçŸ¥ã€å³æ—¶é€šçŸ¥ã€‚
   - ç‰¹ç‚¹ï¼šå‡å°‘è½®è¯¢æ¬¡æ•°ï¼Œä½†èµ„æºå ç”¨è¾ƒå¤§ã€‚
3. **WebSocket**ï¼š
   - åœºæ™¯ï¼šå®æ—¶æ¸¸æˆã€åœ¨çº¿èŠå¤©ã€åä½œå·¥å…·ï¼ˆå¦‚é£ä¹¦ï¼‰ã€‚
   - ç‰¹ç‚¹ï¼šé«˜æ•ˆã€å®æ—¶ã€é€‚åˆé¢‘ç¹é€šä¿¡ã€‚

---

### **7. æ€»ç»“å¯¹æ¯”**
| **ç‰¹æ€§**     | **HTTP**            | **WebSocket**          |
| ------------ | ------------------- | ---------------------- |
| **é€šä¿¡æ¨¡å¼** | åŠåŒå·¥              | å…¨åŒå·¥                 |
| **è¿æ¥æ–¹å¼** | çŸ­è¿æ¥              | é•¿è¿æ¥                 |
| **æ•°æ®æ¨é€** | å®¢æˆ·ç«¯ä¸»åŠ¨æ‹‰å–      | æœåŠ¡ç«¯å¯ä¸»åŠ¨æ¨é€       |
| **é€‚ç”¨åœºæ™¯** | è¯·æ±‚-å“åº”å¼åº”ç”¨åœºæ™¯ | å®æ—¶æ€§å¼ºçš„åœºæ™¯         |
| **åè®®å»ºç«‹** | æ— éœ€é¢å¤–æ“ä½œ        | éœ€è¿›è¡Œåè®®å‡çº§ï¼ˆHTTPï¼‰ |

---

### **8. ç¤ºä¾‹ï¼šWebSocket ä¸ HTTP æŠ“åŒ…åˆ†æ**
- WebSocket å»ºç«‹è¿æ¥å‰ï¼š
  - HTTP è¯·æ±‚å¸¦ç‰¹æ®Šå¤´éƒ¨ (`Upgrade: websocket`)ã€‚
- WebSocket åè®®åˆ‡æ¢åï¼š
  - ä¸å†ä½¿ç”¨ HTTP æŠ¥æ–‡ï¼Œè€Œæ˜¯ç›´æ¥åŸºäº WebSocket å¸§ç»“æ„é€šä¿¡ã€‚

---

### **9. å»¶ä¼¸é—®é¢˜**
- **WebSocket ä¸ Socket çš„å…³ç³»**ï¼š
  - WebSocket æ˜¯åŸºäº TCP çš„åº”ç”¨å±‚åè®®ï¼Œè§£å†³äº†åº”ç”¨å±‚é€šä¿¡çš„æ ¼å¼å’Œæ•°æ®è¾¹ç•Œé—®é¢˜ã€‚
  - Socket æ˜¯ç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰ï¼Œç”¨äºå®ç°ç½‘ç»œé€šä¿¡ï¼Œä¸é™åˆ¶åè®®å±‚çº§ã€‚

- **HTTP/2 ä¸ WebSocket çš„å¯¹æ¯”**ï¼š
  - HTTP/2 å¼•å…¥äº†æµçš„æ¦‚å¿µï¼Œæ”¯æŒæœåŠ¡ç«¯æ¨é€ï¼Œä½†åœ¨å…¨åŒå·¥é€šä¿¡å’Œå®æ—¶æ€§ä¸Šä»ä¸å¦‚ WebSocket ä¸“ç”¨ã€‚

---

è¿™ç¯‡ç¬”è®°ç³»ç»ŸåŒ–åœ°æ€»ç»“äº† HTTP å’Œ WebSocket çš„åŒºåˆ«ã€æŠ€æœ¯åŸç†ã€ä½¿ç”¨åœºæ™¯å’Œå®è·µæ„ä¹‰ï¼Œé€‚åˆåˆå­¦è€…æˆ–å¤ä¹ æ—¶å‚è€ƒã€‚

<img src="https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241117114500583.png" alt="image-20241117114500583" style="zoom:50%;" />

websocketå’Œhttpæ˜¯ä¸¤ç§åè®®ï¼Œåªä¸è¿‡å‰è€…çš„å»ºç«‹å®åœ¨åè€…å…ˆè¿æ¥çš„åŸºç¡€ä¸Šå†headerä¸­putå“åº”çš„è¯·æ±‚å¤´ä¿¡æ¯æ¥å‡çº§åè®®

# æ“ä½œç³»ç»Ÿ

# JavaåŸºç¡€

## privateå’Œprotectedçš„åŒºåˆ«

- ### å›ç­”é‡ç‚¹

  åœ¨Javaä¸­ï¼Œ`protected` å’Œ `private` æ˜¯ä¸¤ç§è®¿é—®ä¿®é¥°ç¬¦ï¼Œç”¨äºæ§åˆ¶ç±»çš„æˆå‘˜ï¼ˆå­—æ®µã€æ–¹æ³•æˆ–æ„é€ æ–¹æ³•ï¼‰çš„å¯è§æ€§å’Œè®¿é—®æƒé™ï¼š

  1. **`protected`**
     - è®¿é—®èŒƒå›´ï¼š
       - å½“å‰ç±»
       - åŒä¸€åŒ…ä¸­çš„å…¶ä»–ç±»
       - ç»§æ‰¿è¯¥ç±»çš„å­ç±»ï¼ˆå³ä½¿ä¸åœ¨åŒä¸€åŒ…ä¸­ï¼Œä¹Ÿå¯ä»¥è®¿é—® `protected` çš„æˆå‘˜ï¼‰
     - **å…¸å‹åœºæ™¯ï¼š**
        é€‚åˆåœ¨ç»§æ‰¿å…³ç³»ä¸­æä¾›å­ç±»è®¿é—®æƒé™ï¼ŒåŒæ—¶å¯¹æ— å…³ç±»éšè—ã€‚
  2. **`private`**
     - è®¿é—®èŒƒå›´ï¼š
       - ä»…é™å½“å‰ç±»å†…éƒ¨ã€‚
     - **å…¸å‹åœºæ™¯ï¼š**
        ç”¨äºéšè—ç±»çš„å®ç°ç»†èŠ‚ï¼Œåªå…è®¸é€šè¿‡å…¬æœ‰æ–¹æ³•ï¼ˆgetterã€setterï¼‰æˆ–å…¶ä»–å†…éƒ¨é€»è¾‘è®¿é—®ã€‚

  ------

  ### è¯¦ç»†è§£æ

  #### `protected` å…³é”®ç‚¹

  - è·¨åŒ…è®¿é—®é™åˆ¶ï¼š

     åªèƒ½é€šè¿‡å­ç±»è®¿é—®ï¼Œä¸èƒ½ç›´æ¥é€šè¿‡å¯¹è±¡è®¿é—®ã€‚ä¾‹å¦‚ï¼š

    ```java
    package packageA;
    public class Parent {
        protected void display() {
            System.out.println("Protected method");
        }
    }
    
    package packageB;
    import packageA.Parent;
    
    public class Child extends Parent {
        public void test() {
            display(); // åˆæ³•ï¼Œå­ç±»ç»§æ‰¿è®¿é—®
        }
    }
    ```

    å¦‚æœ 

    ```
    Child
    ```

     å’Œ 

    ```
    Parent
    ```

     æ˜¯ä¸åŒåŒ…ä¸­çš„ç±»ï¼Œ

    ```
    display
    ```

     æ–¹æ³•åªèƒ½é€šè¿‡ç»§æ‰¿è®¿é—®ï¼Œä¸èƒ½é€šè¿‡å®ä¾‹ç›´æ¥è°ƒç”¨ã€‚

  #### `private` å…³é”®ç‚¹

  - **å®Œå…¨éšè—ï¼š** ä»»ä½•å…¶ä»–ç±»ï¼ŒåŒ…æ‹¬å­ç±»ï¼Œå‡æ— æ³•ç›´æ¥è®¿é—®ã€‚

    ```java
    public class Parent {
        private String secret = "Hidden";
    
        private void showSecret() {
            System.out.println(secret);
        }
    
        public void accessSecret() {
            showSecret(); // å¯é€šè¿‡å…¬æœ‰æ–¹æ³•é—´æ¥è®¿é—®
        }
    }
    ```

  - **å°è£…æ€§ï¼š** å¼ºåˆ¶ä½¿ç”¨è€…é€šè¿‡æ§åˆ¶æ–¹æ³•ï¼ˆå¦‚ getter æˆ– setterï¼‰è®¿é—®å’Œä¿®æ”¹æ•°æ®ï¼Œä¾¿äºæ§åˆ¶è¾“å…¥è¾“å‡ºçš„åˆæ³•æ€§ã€‚

  ------

  ### çŸ¥è¯†æ‰©å±•

  | å…³é”®å­—      | å½“å‰ç±» | åŒåŒ… | å­ç±»ï¼ˆè·¨åŒ…ï¼‰ | å…¶ä»–åŒ… |
  | ----------- | ------ | ---- | ------------ | ------ |
  | `public`    | âœ”      | âœ”    | âœ”            | âœ”      |
  | `protected` | âœ”      | âœ”    | âœ”            | âœ˜      |
  | `default`   | âœ”      | âœ”    | âœ˜            | âœ˜      |
  | `private`   | âœ”      | âœ˜    | âœ˜            | âœ˜      |

  1. **`protected` vs `default` (æ— ä¿®é¥°ç¬¦)**
      é»˜è®¤è®¿é—®ä¿®é¥°ç¬¦ï¼ˆ`default`ï¼‰ä»…é™äºåŒ…å†…è®¿é—®ï¼Œè€Œ `protected` å…è®¸å­ç±»è·¨åŒ…è®¿é—®ã€‚

  2. **è®¿é—®æ§åˆ¶ä¼˜å…ˆçº§ï¼š** `private` < `default` < `protected` < `public`

  3. **ç¤ºæ„å›¾ï¼š**

     ```text
     åŒ…A:
     ----------------------
     [ ç±»A ]  protectedæˆå‘˜
             â†—
     åŒ…B:
     ----------------------
     [ ç±»B (å­ç±») ]
     ```

  ------

  ### æ€»ç»“

  - `private` æä¾›æœ€ä¸¥æ ¼çš„å°è£…ï¼Œä»…ä¾›ç±»å†…éƒ¨ä½¿ç”¨ã€‚
  - `protected` æä¾›åŒ…è®¿é—®æƒé™ï¼Œå¹¶æ‰©å±•åˆ°å­ç±»ï¼Œ**å³åœ¨ç»§æ‰¿å…³ç³»ä¸­æä¾›æ›´é«˜çš„çµæ´»æ€§ã€‚**

  



## Javaä¸­æŠ½è±¡ç±»å’Œæ¥å£æœ‰ä»€ä¹ˆåŒºåˆ«

### è®¾è®¡åŠ¨æœº

![image-20250110112841711](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250110112841711.png)



## Javaä¸­ä¸ºä»€ä¹ˆä¸æ”¯æŒå¤šç»§æ‰¿

Javaä¸æ”¯æŒå¤šé‡ç»§æ‰¿æ˜¯å› ä¸ºå®ƒå¯èƒ½å¯¼è‡´ **â€œé’»çŸ³é—®é¢˜â€**ï¼ˆDiamond Problemï¼‰ï¼Œå¢åŠ ä»£ç çš„å¤æ‚æ€§å’Œæ¨¡ç³Šæ€§ã€‚é€šè¿‡æ¥å£ï¼ˆ`interface`ï¼‰çš„æœºåˆ¶ï¼ŒJavaåœ¨ä¸€å®šç¨‹åº¦ä¸Šå®ç°äº†å¤šç»§æ‰¿çš„çµæ´»æ€§ï¼ŒåŒæ—¶é¿å…äº†å¤šé‡ç»§æ‰¿çš„ä¸»è¦ç¼ºé™·ã€‚

**æ‹“å±•ï¼šä¸ºä»€ä¹ˆæ¥å£å¯ä»¥å®ä¹ å¤šå®ç°**

ç†è§£ï¼šå¯¹äºç›¸åŒçš„é‡å¤æ–¹æ³•ä¸”æœ‰ä¸åŒçš„å†™æ³•ï¼Œå­ç±»å¿…é¡»é‡å†™æ¥å£ï¼Œç›¸å½“äºå½’ä¸€åŒ–ã€‚

![image-20250110111210207](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250110111210207.png)

## ä¸ºä»€ä¹ˆç»§æ‰¿åªå…è®¸å•ç»§æ‰¿ï¼Œæ¥å£å¯ä»¥å¤šå®ç°å‘¢ï¼Ÿ

ä»è®¾è®¡è§’åº¦ä¸Šç†è§£

- æ¥å£æ˜¯å†³å®šç±»æœ‰å“ªäº›èƒ½åŠ›can-do ï¼Œä¸€ä¸ªå¯¹è±¡ç±»å¯ä»¥æŒæ¡å¤šä¸ªèƒ½åŠ›ï¼ˆè§„èŒƒï¼‰ï¼ˆå®ç°å¤šä¸ªæ¥å£ï¼‰
- ç»§æ‰¿æ˜¯å†³å®šè¿™ä¸ªç±»æ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥ä»åˆç†æ€§è§£é‡Šä¸€ä¸ªç±»ä¹Ÿåªèƒ½æ˜¯æŸä¸€ä¸ªçˆ¶ç±»çš„ç»§æ‰¿

![image-20250110111836362](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250110111836362.png)



## JDK å’Œ JRE æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å›ç­”é‡ç‚¹ï¼š**

**JRE(Java Runtime Environment)æŒ‡çš„æ˜¯ Java è¿è¡Œç¯å¢ƒï¼ŒåŒ…å«äº† JVMã€æ ¸å¿ƒç±»åº“å’Œå…¶ä»–æ”¯æŒè¿è¡Œ Java ç¨‹åºçš„æ–‡ä»¶ã€‚**

- JVMï¼ˆJava Virtual Machineï¼‰ï¼šæ‰§è¡Œ Java å­—èŠ‚ç ï¼Œæä¾›äº† Java ç¨‹åºçš„è¿è¡Œç¯å¢ƒã€‚
- æ ¸å¿ƒç±»åº“ï¼šä¸€ç»„æ ‡å‡†çš„ç±»åº“ï¼ˆå¦‚ java.langã€java.util ç­‰ï¼‰ï¼Œä¾› Java ç¨‹åºä½¿ç”¨ã€‚
- å…¶ä»–æ–‡ä»¶ï¼šå¦‚é…ç½®æ–‡ä»¶ã€åº“æ–‡ä»¶ç­‰ï¼Œæ”¯æŒ JVM çš„è¿è¡Œã€‚

JDKï¼ˆJava Development Kitï¼‰å¯ä»¥è§†ä¸º JRE çš„è¶…é›†ï¼Œæ˜¯ç”¨äºå¼€å‘ Java ç¨‹åºçš„å®Œæ•´å¼€å‘ç¯å¢ƒï¼Œå®ƒåŒ…å«äº† JREï¼Œä»¥åŠç”¨äºå¼€å‘ã€è°ƒè¯•å’Œç›‘æ§ Java åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚

- JREï¼šJDK åŒ…å«äº†å®Œæ•´çš„ JREï¼Œå› æ­¤å®ƒä¹Ÿèƒ½è¿è¡Œ Java ç¨‹åºã€‚
- å¼€å‘å·¥å…·ï¼šå¦‚ç¼–è¯‘å™¨ï¼ˆjavacï¼‰ã€è°ƒè¯•å™¨ï¼ˆjdbï¼‰ã€æ‰“åŒ…å·¥å…·ï¼ˆjarï¼‰ç­‰ï¼Œç”¨äºå¼€å‘å’Œç®¡ç† Java ç¨‹åºã€‚
- é™„åŠ åº“å’Œæ–‡ä»¶ï¼šæ”¯æŒå¼€å‘ã€æ–‡æ¡£ç”Ÿæˆå’Œå…¶ä»–å¼€å‘ç›¸å…³çš„ä»»åŠ¡ã€‚

## Javaä¸­Exceptionå’ŒErrorçš„åŒºåˆ«ï¼Ÿ

![image-20250110092220609](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250110092220609.png)

![image-20250110092355583](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250110092355583.png)

## Javaçš„ä¼ å‚æœ¬è´¨

åœ¨ Java ä¸­ï¼Œæ‰€æœ‰çš„å‚æ•°ä¼ é€’æœ¬è´¨ä¸Šæ˜¯ **å€¼ä¼ é€’**ã€‚ç„¶è€Œï¼Œè¿™ç§å€¼ä¼ é€’åœ¨ä¸åŒçš„æƒ…å¢ƒä¸‹å¯èƒ½è¡¨ç°å¾—åƒâ€œå¼•ç”¨ä¼ é€’â€ï¼Œè¿™æ˜¯å› ä¸º Java çš„å¯¹è±¡å¼•ç”¨æœ¬èº«æ˜¯ä»¥å€¼çš„å½¢å¼ä¼ é€’çš„ã€‚æˆ‘ä»¬å…·ä½“æ¥çœ‹ï¼š

------

### 1. åŸºæœ¬æ•°æ®ç±»å‹

å¯¹äº **åŸºæœ¬æ•°æ®ç±»å‹**ï¼ˆ`int`, `double`, `char`, `boolean` ç­‰ï¼‰ï¼Œå‚æ•°ä¼ é€’çš„æ˜¯å˜é‡çš„å€¼ï¼Œå³å¤åˆ¶äº†ä¸€ä»½å˜é‡çš„å†…å®¹ã€‚

**ç¤ºä¾‹ï¼š**

```java
public class Test {
    public static void main(String[] args) {
        int num = 10;
        modifyValue(num);
        System.out.println("num çš„å€¼: " + num); // è¾“å‡º: num çš„å€¼: 10
    }

    public static void modifyValue(int value) {
        value = 20; // ä¿®æ”¹çš„æ˜¯ value çš„å‰¯æœ¬ï¼Œä¸ num æ— å…³
    }
}
```

**ç»“è®ºï¼š** åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ä¸ä¼šå—åˆ°æ–¹æ³•å†…ä¿®æ”¹çš„å½±å“ï¼Œå› ä¸ºæ–¹æ³•å†…æ“ä½œçš„æ˜¯å‰¯æœ¬ã€‚

------

### 2. å¼•ç”¨æ•°æ®ç±»å‹

å¯¹äº **å¼•ç”¨æ•°æ®ç±»å‹**ï¼ˆå¦‚æ•°ç»„ã€å¯¹è±¡ç­‰ï¼‰ï¼Œå‚æ•°ä¼ é€’çš„ä»ç„¶æ˜¯å€¼ï¼Œä½†è¿™ä¸ªå€¼æ˜¯**å¯¹è±¡çš„å¼•ç”¨åœ°å€çš„å‰¯æœ¬**ã€‚å› æ­¤ï¼Œé€šè¿‡è¿™ä¸ªå‰¯æœ¬ï¼Œæ–¹æ³•å¯ä»¥ä¿®æ”¹å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡å†…å®¹ï¼Œä½†ä¸èƒ½æ”¹å˜å¼•ç”¨æœ¬èº«çš„æŒ‡å‘ã€‚

**ç¤ºä¾‹ 1ï¼šä¿®æ”¹å¯¹è±¡çš„å†…å®¹**

```java
public class Test {
    public static void main(String[] args) {
        int[] arr = {1, 2, 3};
        modifyArray(arr);
        System.out.println("arr[0] çš„å€¼: " + arr[0]); // è¾“å‡º: arr[0] çš„å€¼: 99
    }

    public static void modifyArray(int[] array) {
        array[0] = 99; // ä¿®æ”¹äº†å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡
    }
}
```

**ç¤ºä¾‹ 2ï¼šå°è¯•ä¿®æ”¹å¼•ç”¨æœ¬èº«**

```java
public class Test {
    public static void main(String[] args) {
        int[] arr = {1, 2, 3};
        changeReference(arr);
        System.out.println("arr[0] çš„å€¼: " + arr[0]); // è¾“å‡º: arr[0] çš„å€¼: 1
    }

    public static void changeReference(int[] array) {
        array = new int[]{99, 98, 97}; // ä¿®æ”¹çš„æ˜¯ array çš„å‰¯æœ¬ï¼Œä¸åŸå¼•ç”¨æ— å…³
    }
}
```

**ç»“è®ºï¼š**

- æ–¹æ³•å¯ä»¥é€šè¿‡å¼•ç”¨åœ°å€ä¿®æ”¹å¯¹è±¡çš„å†…å®¹ã€‚
- æ–¹æ³•æ— æ³•æ”¹å˜å¤–éƒ¨å˜é‡çš„å¼•ç”¨åœ°å€ã€‚

------

### æ€»ç»“

1. **åŸºæœ¬æ•°æ®ç±»å‹**ï¼šå€¼ä¼ é€’ï¼Œæ–¹æ³•å†…æ“ä½œçš„æ˜¯å‰¯æœ¬ã€‚
2. **å¼•ç”¨æ•°æ®ç±»å‹**ï¼šå€¼ä¼ é€’ï¼Œæ–¹æ³•å†…æ“ä½œçš„æ˜¯å¯¹è±¡å¼•ç”¨åœ°å€çš„å‰¯æœ¬ï¼Œå¯ä»¥é€šè¿‡å®ƒä¿®æ”¹å¯¹è±¡çš„å†…å®¹ï¼Œä½†ä¸èƒ½ä¿®æ”¹å¼•ç”¨æœ¬èº«ã€‚

**è¿›ä¸€æ­¥æ€è€ƒï¼š**

- å¦‚æœéœ€è¦å®ç°ç±»ä¼¼â€œå¼•ç”¨ä¼ é€’â€çš„è¡Œä¸ºï¼Œå¯ä»¥ä½¿ç”¨åŒ…è£…ç±»ï¼ˆå¦‚ `AtomicInteger`ï¼‰æˆ–å°†å˜é‡å°è£…åœ¨è‡ªå®šä¹‰å¯¹è±¡ä¸­ã€‚



## Javaä¸­çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯ä»€ä¹ˆï¼Ÿ

![image-20241127141207657](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241127141207657.png)

![image-20241127141230685](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241127141230685.png)

### å®ç°è¿™ä¸ªæ¥å£çš„æ„ä¹‰

![image-20241127141255819](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241127141255819.png)

![image-20241127141711398](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241127141711398.png)

**é€šè¿‡idæ¥éªŒè¯åœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­æ˜¯å¦å‡ºé”™**

## Java ä¸­çš„ hashCode å’Œ equals æ–¹æ³•ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ 

åœ¨ Java ä¸­ï¼Œ`hashCode` å’Œ `equals` æ˜¯ Object ç±»ä¸­å®šä¹‰çš„ä¸¤ä¸ªé‡è¦æ–¹æ³•ã€‚å®ƒä»¬åœ¨é›†åˆæ¡†æ¶ä¸­ï¼ˆå¦‚ `HashMap`ã€`HashSet`ï¼‰å’Œå¯¹è±¡æ¯”è¾ƒä¸­å‘æŒ¥é‡è¦ä½œç”¨ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•ä¹‹é—´æœ‰ç´§å¯†çš„å…³ç³»ï¼Œå¹¶ä¸”éœ€è¦éµå¾ªç‰¹å®šçš„çº¦å®šã€‚

------

### **`hashCode` æ–¹æ³•**

- **ä½œç”¨**ï¼š
  - è¿”å›å¯¹è±¡çš„å“ˆå¸Œå€¼ï¼ˆä¸€ä¸ªæ•´æ•°ï¼‰ã€‚
  - ç”¨äºç¡®å®šå¯¹è±¡åœ¨åŸºäºå“ˆå¸Œçš„é›†åˆï¼ˆå¦‚ `HashMap`ã€`HashSet`ï¼‰ä¸­çš„å­˜å‚¨ä½ç½®ã€‚
- **é»˜è®¤å®ç°**ï¼š
  - é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Object` çš„ `hashCode` æ–¹æ³•è¿”å›å¯¹è±¡çš„å†…å­˜åœ°å€çš„å“ˆå¸Œç ã€‚
- **éœ€è¦é‡å†™æ—¶**ï¼š
  - å½“ç±»é‡å†™äº† `equals` æ–¹æ³•æ—¶ï¼Œä¹Ÿå¿…é¡»é‡å†™ `hashCode` æ–¹æ³•ï¼Œä»¥ç¡®ä¿é€»è¾‘ä¸€è‡´æ€§ã€‚

------

### **`equals` æ–¹æ³•**

- **ä½œç”¨**ï¼š
  - æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚
  - é»˜è®¤æ¯”è¾ƒå¯¹è±¡çš„å¼•ç”¨åœ°å€ã€‚
- **é»˜è®¤å®ç°**ï¼š
  - é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Object` çš„ `equals` æ–¹æ³•æ¯”è¾ƒå¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼Œå³ `obj1 == obj2`ã€‚
- **éœ€è¦é‡å†™æ—¶**ï¼š
  - å¦‚æœå¸Œæœ›æŒ‰å†…å®¹æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼ˆä¾‹å¦‚æ¯”è¾ƒä¸¤ä¸ª `Person` å¯¹è±¡çš„ `name` å’Œ `age`ï¼‰ï¼Œéœ€è¦é‡å†™ `equals` æ–¹æ³•ã€‚

------

### **`hashCode` å’Œ `equals` çš„å…³ç³»**

æ ¹æ® Java çš„è§„èŒƒï¼Œ`hashCode` å’Œ `equals` æ–¹æ³•å¿…é¡»æ»¡è¶³ä»¥ä¸‹å…³ç³»ï¼š

1. **ä¸€è‡´æ€§ï¼ˆConsistent Relationshipï¼‰**ï¼š
   - å¦‚æœä¸¤ä¸ªå¯¹è±¡æ ¹æ® `equals` æ–¹æ³•æ¯”è¾ƒæ˜¯ç›¸ç­‰çš„ï¼ˆå³ `a.equals(b)` è¿”å› `true`ï¼‰ï¼Œé‚£ä¹ˆå®ƒä»¬çš„ `hashCode` å€¼å¿…é¡»ç›¸åŒã€‚
2. **éå¼ºåˆ¶è¦æ±‚ï¼ˆNot Required but Encouragedï¼‰**ï¼š
   - å¦‚æœä¸¤ä¸ªå¯¹è±¡æ ¹æ® `equals` æ–¹æ³•æ¯”è¾ƒä¸ç›¸ç­‰ï¼Œåˆ™å®ƒä»¬çš„ `hashCode` å€¼å¯ä»¥ç›¸åŒï¼Œä½†ä¸å»ºè®®ã€‚
3. **ä¸€è‡´æ€§çº¦æŸï¼ˆHashCode Contractï¼‰**ï¼š
   - åœ¨åŒä¸€æ¬¡ç¨‹åºè¿è¡Œä¸­ï¼Œåªè¦å¯¹è±¡çš„å†…å®¹æœªå‘ç”Ÿå˜åŒ–ï¼Œå¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡çš„ `hashCode` æ–¹æ³•åº”è¯¥è¿”å›ç›¸åŒçš„å€¼ã€‚

å¦‚æœè¿™ä¸¤ä¸ªæ–¹æ³•çš„é€»è¾‘ä¸ä¸€è‡´ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŸºäºå“ˆå¸Œçš„æ•°æ®ç»“æ„ï¼ˆå¦‚ `HashMap` æˆ– `HashSet`ï¼‰å·¥ä½œå¼‚å¸¸ã€‚

------

### **ç¤ºä¾‹ä»£ç **

ä¸‹é¢æ˜¯ä¸€ä¸ªç±»é‡å†™ `equals` å’Œ `hashCode` çš„ç¤ºä¾‹ï¼š

```java
import java.util.Objects;

class Person {
    private String name;
    private int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true; // åŒä¸€å¯¹è±¡
        if (obj == null || getClass() != obj.getClass()) return false; // ç±»å‹ä¸åŒ
        Person person = (Person) obj; // ç±»å‹è½¬æ¢
        return age == person.age && Objects.equals(name, person.name); // æ¯”è¾ƒå†…å®¹
    }

    @Override
    public int hashCode() {
        return Objects.hash(name, age); // ç”Ÿæˆå“ˆå¸Œå€¼
    }

    @Override
    public String toString() {
        return "Person{name='" + name + "', age=" + age + '}';
    }
}

public class Main {
    public static void main(String[] args) {
        Person p1 = new Person("Alice", 25);
        Person p2 = new Person("Alice", 25);
        Person p3 = new Person("Bob", 30);

        // equals æ¯”è¾ƒ
        System.out.println("p1 equals p2: " + p1.equals(p2)); // true
        System.out.println("p1 equals p3: " + p1.equals(p3)); // false

        // hashCode æ¯”è¾ƒ
        System.out.println("p1 hashCode: " + p1.hashCode());
        System.out.println("p2 hashCode: " + p2.hashCode());
        System.out.println("p3 hashCode: " + p3.hashCode());

        // åŸºäº HashSet
        HashSet<Person> set = new HashSet<>();
        set.add(p1);
        set.add(p2); // ä¸ä¼šæ·»åŠ ï¼Œå› ä¸º p1.equals(p2)
        set.add(p3);
        System.out.println("HashSet å†…å®¹: " + set);
    }
}
```

------

### **é‡è¦æ³¨æ„ç‚¹**

1. **ä¸€è‡´æ€§é—®é¢˜**ï¼š å¦‚æœåªé‡å†™äº† `equals` è€Œæ²¡æœ‰é‡å†™ `hashCode`ï¼Œå¯èƒ½ä¼šå¯¼è‡´åœ¨ `HashMap` æˆ– `HashSet` ä¸­å­˜å‚¨å’ŒæŸ¥æ‰¾å¯¹è±¡æ—¶è¡Œä¸ºå¼‚å¸¸ã€‚
2. **æ€§èƒ½é—®é¢˜**ï¼š ä¸å»ºè®®ä¸¤ä¸ªä¸ç›¸ç­‰çš„å¯¹è±¡äº§ç”Ÿç›¸åŒçš„å“ˆå¸Œå€¼ï¼ˆå“ˆå¸Œå†²çªï¼‰ï¼Œå› ä¸ºè¿™ä¼šé™ä½å“ˆå¸Œç»“æ„çš„æ€§èƒ½ã€‚
3. **æ¨èä½¿ç”¨ `Objects.hash`**ï¼š
   - ä½¿ç”¨ `Objects.hash` æ–¹æ³•ç”Ÿæˆå“ˆå¸Œå€¼ï¼Œç®€åŒ–ä»£ç ã€‚

------

### **æ€»ç»“**

- `equals` å†³å®šå¯¹è±¡æ˜¯å¦â€œé€»è¾‘ç›¸ç­‰â€ã€‚
- `hashCode` å†³å®šå¯¹è±¡åœ¨åŸºäºå“ˆå¸Œçš„æ•°æ®ç»“æ„ä¸­çš„ä½ç½®ã€‚
- å¿…é¡»åŒæ—¶é‡å†™ `equals` å’Œ `hashCode`ï¼Œç¡®ä¿å®ƒä»¬é€»è¾‘ä¸€è‡´ã€‚



åœ¨ Java ä¸­ï¼Œ`hashCode` å’Œ `equals` çš„çŸ¥è¯†åœ¨é›†åˆæ¡†æ¶å’Œå®é™…å¼€å‘ä¸­éå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨é¢è¯•ä¸­å¸¸è¢«ç”¨ä½œæ ¸å¿ƒé—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ‰©å±•é—®é¢˜åŠå…¶è§£ç­”ï¼Œä»¥å¸®åŠ©ç†è§£è¿™äº›æ–¹æ³•çš„å®é™…åº”ç”¨å’Œæ½œåœ¨æŒ‘æˆ˜ã€‚

------

### **æ‰©å±•é—®é¢˜ 1ï¼š`hashCode` å’Œ `equals` åœ¨é›†åˆä¸­çš„ä½œç”¨**

#### **é—®é¢˜**ï¼šåœ¨ HashMap å’Œ HashSet ä¸­ï¼Œ`hashCode` å’Œ `equals` æ˜¯å¦‚ä½•å‘æŒ¥ä½œç”¨çš„ï¼Ÿ

#### **è§£ç­”**ï¼š

- **HashMap**ï¼š

  1. å­˜å‚¨é”®å€¼å¯¹æ—¶

     ï¼š

     - `hashCode` å†³å®šé”®å­˜å‚¨åœ¨å“ªä¸ªå“ˆå¸Œæ¡¶ï¼ˆbucketï¼‰ä¸­ã€‚
     - å¦‚æœä¸¤ä¸ªé”®çš„ `hashCode` ç›¸åŒï¼Œå®ƒä»¬ä¼šè¢«å­˜å‚¨åˆ°åŒä¸€ä¸ªæ¡¶ä¸­ï¼Œå½¢æˆé“¾è¡¨ï¼ˆæˆ–æ ‘å½¢ç»“æ„ï¼ŒJava 8 å¼•å…¥ï¼‰ã€‚
     - å†é€šè¿‡ `equals` æ–¹æ³•æ£€æŸ¥é“¾è¡¨ä¸­çš„å¯¹è±¡ï¼Œç¡®ä¿é”®çš„å”¯ä¸€æ€§ã€‚

  2. æŸ¥æ‰¾é”®å€¼å¯¹æ—¶

     ï¼š

     - é¦–å…ˆæ ¹æ® `hashCode` å®šä½æ¡¶ã€‚
     - ç„¶ååœ¨æ¡¶ä¸­é€šè¿‡ `equals` æ–¹æ³•æ‰¾åˆ°åŒ¹é…çš„é”®ã€‚

- **HashSet**ï¼š

  - å·¥ä½œåŸç†ä¸ HashMap ç±»ä¼¼ï¼Œä½† HashSet åº•å±‚æ˜¯é€šè¿‡ä¸€ä¸ª HashMap æ¥å®ç°çš„ï¼Œå…¶ä¸­é”®ä¸ºå¯¹è±¡ï¼Œå€¼æ˜¯ä¸€ä¸ªå›ºå®šå€¼ï¼ˆé€šå¸¸ä¸º `null`ï¼‰ã€‚

#### **ç¤ºä¾‹ä»£ç **ï¼š

```java
import java.util.HashSet;

class Example {
    private int value;

    public Example(int value) {
        this.value = value;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (obj == null || getClass() != obj.getClass()) return false;
        Example example = (Example) obj;
        return value == example.value;
    }

    @Override
    public int hashCode() {
        return Integer.hashCode(value);
    }
}

public class Main {
    public static void main(String[] args) {
        HashSet<Example> set = new HashSet<>();
        set.add(new Example(1));
        set.add(new Example(1)); // å› ä¸º equals è¿”å› trueï¼Œä¸ä¼šåŠ å…¥
        set.add(new Example(2));
        System.out.println("HashSet å†…å®¹: " + set.size()); // è¾“å‡º 2
    }
}
```

------

### **æ‰©å±•é—®é¢˜ 2ï¼š`hashCode` å’Œ `equals` ä¸ä¸€è‡´çš„åæœ**

#### **é—®é¢˜**ï¼šå¦‚æœ `hashCode` å’Œ `equals` é€»è¾‘ä¸ä¸€è‡´ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

#### **è§£ç­”**ï¼š

1. **ç»“æœé”™è¯¯**ï¼š
   - å¦‚æœå¯¹è±¡çš„ `hashCode` ç›¸åŒï¼Œä½† `equals` ä¸ä¸€è‡´ï¼ˆå³ä¸¤ä¸ªå¯¹è±¡å“ˆå¸Œå€¼ç›¸åŒï¼Œä½†å†…å®¹ä¸ç­‰ï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´å“ˆå¸Œè¡¨å­˜å‚¨é”™è¯¯ï¼Œå‡ºç°é‡å¤å¯¹è±¡æˆ–æ— æ³•æ‰¾åˆ°å¯¹è±¡ã€‚
2. **æŸ¥æ‰¾å¤±è´¥**ï¼š
   - å¦‚æœ `hashCode` é€»è¾‘é”™è¯¯ï¼Œå³ä½¿ `equals` è¿”å› `true`ï¼Œåœ¨åŸºäºå“ˆå¸Œçš„é›†åˆä¸­ä»å¯èƒ½æ‰¾ä¸åˆ°å¯¹è±¡ã€‚
3. **æ€§èƒ½ä¸‹é™**ï¼š
   - å¦‚æœå¤§é‡å¯¹è±¡çš„ `hashCode` å€¼ç›¸åŒï¼ˆå“ˆå¸Œå†²çªä¸¥é‡ï¼‰ï¼Œä¼šå¯¼è‡´å“ˆå¸Œè¡¨é€€åŒ–æˆé“¾è¡¨ï¼ŒæŸ¥æ‰¾æ€§èƒ½ä» O(1) é™ä½åˆ° O(n)ã€‚

------

### **æ‰©å±•é—®é¢˜ 3ï¼šå¦‚ä½•è®¾è®¡ä¸€ä¸ªè‰¯å¥½çš„ `hashCode` å’Œ `equals` å®ç°ï¼Ÿ**

#### **é—®é¢˜**ï¼šé‡å†™ `hashCode` å’Œ `equals` æ—¶æœ‰å“ªäº›æœ€ä½³å®è·µï¼Ÿ

#### **è§£ç­”**ï¼š

1. **`hashCode` çš„è®¾è®¡**ï¼š
   - ä½¿ç”¨æ‰€æœ‰å‚ä¸ `equals` æ¯”è¾ƒçš„å­—æ®µã€‚
   - å°½é‡å‡å°‘å“ˆå¸Œå†²çªï¼Œåˆ†å¸ƒå‡åŒ€ã€‚
   - æ¨èä½¿ç”¨ `Objects.hash` æ–¹æ³•ï¼Œæˆ–è€…å‚è€ƒç»å…¸ç®—æ³•ï¼ˆå¦‚ä¹˜æ³•æ•£åˆ—æ³•ï¼‰ã€‚
2. **`equals` çš„å®ç°**ï¼š
   - é¿å…ç›´æ¥ä½¿ç”¨ `==` æ¯”è¾ƒå¼•ç”¨ã€‚
   - æ£€æŸ¥å¯¹è±¡æ˜¯å¦ä¸º `null` å’Œç±»å‹æ˜¯å¦åŒ¹é…ã€‚
   - ä½¿ç”¨æ‰€æœ‰é‡è¦å­—æ®µè¿›è¡Œæ¯”è¾ƒã€‚
   - éµå¾ªå¯¹ç§°æ€§ã€ä¼ é€’æ€§ã€ä¸€è‡´æ€§ç­‰è§„èŒƒã€‚

------

### **æ‰©å±•é—®é¢˜ 4ï¼šä¸ºä»€ä¹ˆæ¨èåœ¨ `equals` ä¸­ä½¿ç”¨ `getClass` è€Œä¸æ˜¯ `instanceof`ï¼Ÿ**

#### **é—®é¢˜**ï¼šåœ¨ `equals` æ–¹æ³•ä¸­ï¼Œç”¨ `getClass` å’Œ `instanceof` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

#### **è§£ç­”**ï¼š

- **`getClass`**ï¼š
  - æ¯”è¾ƒæ—¶è¦æ±‚å¯¹è±¡å¿…é¡»æ˜¯åŒä¸€ç±»ã€‚
  - é€‚ç”¨äºç²¾ç¡®æ¯”è¾ƒï¼Œä¾‹å¦‚æ¯”è¾ƒä¸¤ä¸ªå®Œå…¨ç›¸åŒç±»å‹çš„ç±»ã€‚
- **`instanceof`**ï¼š
  - åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºæŸä¸ªç±»æˆ–å…¶å­ç±»çš„å®ä¾‹ã€‚
  - é€‚ç”¨äºå…è®¸å­ç±»é€»è¾‘ç›¸ç­‰çš„åœºæ™¯ã€‚

#### **ç¤ºä¾‹**ï¼š

```java
@Override
public boolean equals(Object obj) {
    if (this == obj) return true;
    if (obj == null || getClass() != obj.getClass()) return false; // ç²¾ç¡®åŒ¹é…
    MyClass other = (MyClass) obj;
    return field == other.field;
}

// æˆ–ä½¿ç”¨ instanceof
@Override
public boolean equals(Object obj) {
    if (this == obj) return true;
    if (!(obj instanceof MyClass)) return false; // å…è®¸å­ç±»
    MyClass other = (MyClass) obj;
    return field == other.field;
}
```

**åŒºåˆ«**ï¼š

- `getClass` æ›´ä¸¥æ ¼ï¼Œé€‚ç”¨äºä¸å¯å˜ç±»ï¼ˆä¾‹å¦‚ `Integer`ã€`String`ï¼‰ã€‚
- `instanceof` æ›´å®½æ¾ï¼Œé€‚ç”¨äºç»§æ‰¿å±‚æ¬¡ç»“æ„ä¸­çš„å¤šæ€æ¯”è¾ƒã€‚

------

### **æ‰©å±•é—®é¢˜ 5ï¼šé¢è¯•ä¸­å¯èƒ½è¡ç”Ÿçš„è¿›é˜¶é—®é¢˜**

1. **åœ¨ `TreeSet` æˆ– `TreeMap` ä¸­ï¼Œ`hashCode` å’Œ `equals` æ˜¯å¦é‡è¦ï¼Ÿ**
   - ç­”ï¼šå®ƒä»¬ä¸é‡è¦ï¼Œå› ä¸º `TreeSet` å’Œ `TreeMap` ä½¿ç”¨ `compareTo` æˆ–è‡ªå®šä¹‰çš„ `Comparator` æ–¹æ³•è¿›è¡Œæ’åºå’Œæ¯”è¾ƒã€‚
2. **å¦‚ä½•å®ç°å¯¹è±¡çš„æ·±æ‹·è´ï¼ˆåŸºäºåºåˆ—åŒ–ï¼‰ï¼Ÿ**
   - ç­”ï¼šé€šè¿‡åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¯ä»¥å®ç°æ·±æ‹·è´ï¼Œä½†éœ€è¦ç±»å®ç° `Serializable` æ¥å£ã€‚
3. **å¦‚ä½•é¿å… `HashMap` ä¸­çš„å“ˆå¸Œå†²çªï¼Ÿ**
   - ç­”ï¼šè®¾è®¡ä¸€ä¸ªå¥½çš„ `hashCode` æ–¹æ³•ä»¥å‡åŒ€åˆ†å¸ƒå¯¹è±¡ï¼›æ­¤å¤–ï¼ŒJava 8 ä¸­çš„ `HashMap` åœ¨å†²çªé“¾è¶…è¿‡ä¸€å®šé•¿åº¦åä¼šä½¿ç”¨çº¢é»‘æ ‘ä¼˜åŒ–ã€‚
4. **`hashCode` å’Œ `equals` æ˜¯å¦é€‚ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒï¼Ÿ**
   - ç­”ï¼šé»˜è®¤æƒ…å†µä¸‹å®ƒä»¬æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å¦‚æœæ¶‰åŠå¯å˜å­—æ®µä¸”è¿™äº›å­—æ®µè¢«å¤šä¸ªçº¿ç¨‹ä¿®æ”¹ï¼Œåˆ™éœ€è¦åŒæ­¥æˆ–ä½¿ç”¨ä¸å¯å˜å¯¹è±¡ã€‚

# Redis

## ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€

### å›ç­”é‡ç‚¹

**å¤§é‡çš„ç¼“å­˜keyï¼Œåœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œæ‰€æœ‰çš„è¯·æ±‚ç›´æ¥è®¿é—®åˆ°æ•°æ®åº“ä¸Š**

### è§£å†³æ–¹æ¡ˆ

- å¢åŠ keyè¿‡æœŸæ—¶é—´çš„éšæœºæ€§

### å…¶ä»–é—®é¢˜

![image-20250120172856643](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250120172856643.png)

# Spring

## Springäº‹åŠ¡

### 1.Springäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º

â€‹	ç†è§£Springçš„äº‹åŠ¡ï¼Œä¸»è¦ä»ä¸‰ç§è§’åº¦å»ç†è§£

- èå…¥ï¼š**ä¸€ä¸ªäº‹åŠ¡å‡ºç°åœ¨å¦å¤–ä¸€ä¸ªå«æœ‰äº‹åŠ¡çš„æ–¹æ³•å†…**ï¼Œå–æ¶ˆè‡ªèº«çš„äº‹åŠ¡ç‰¹æ•ˆï¼Œä¸å¤–éƒ¨äº‹åŠ¡æ„æˆå¤§äº‹åŠ¡
- æŒ‚è½½ï¼š**ä¸€ä¸ªäº‹åŠ¡å‡ºç°åœ¨å¦å¤–ä¸€ä¸ªå«æœ‰äº‹åŠ¡çš„æ–¹æ³•å†…**ï¼Œå½“å¤–éƒ¨äº‹åŠ¡æ‰§è¡Œåˆ°æœ¬èº«æ—¶å€™ï¼Œ**åˆ‡æ¢çº¿ç¨‹ç»‘å®š**ï¼ŒåŒæ—¶æš‚åœå¤–éƒ¨äº‹åŠ¡è¿›ç¨‹æ‰§è¡Œï¼ˆæŒ‚è½½ï¼‰ï¼Œç­‰å¾…è‡ªèº«äº‹åŠ¡æ‰§è¡Œåï¼Œ**å”¤é†’**å¤–éƒ¨äº‹åŠ¡ã€‚
- åµŒå¥—ï¼š
- ![image-20250411143707686](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250411143707686.png)

![image-20250411142955443](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250411142955443.png)

## @Resourceå’Œ@Autowireçš„åŒºåˆ«ï¼Ÿ

`https://www.pdai.tech/md/spring/spring-x-framework-ioc.html#%E6%B3%A8%E8%A7%A3%E6%B3%A8%E5%85%A5`å‚è€ƒé“¾æ¥

### å›ç­”é‡ç‚¹

`@Resource` å’Œ `@Autowired` æ˜¯ Spring æ¡†æ¶ä¸­ç”¨æ¥å®ç°ä¾èµ–æ³¨å…¥çš„ä¸¤ä¸ªæ³¨è§£ï¼ŒåŠŸèƒ½ç›¸ä¼¼ä½†æœ‰ä¸€äº›å…³é”®åŒºåˆ«ï¼š

- **æ¥æº**ï¼š
  - `@Resource` æ˜¯ JSR-250 è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå±äº Java æ ‡å‡†ï¼Œä½äº `javax.annotation` åŒ…ä¸­ã€‚
  - `@Autowired` æ˜¯ Spring æä¾›çš„æ³¨è§£ï¼Œä½äº `org.springframework.beans.factory.annotation` åŒ…ä¸­ã€‚
- **æ³¨å…¥æ–¹å¼**ï¼š
  - `@Resource` é»˜è®¤æŒ‰ **åç§°** æ³¨å…¥ï¼Œå¯ä»¥é€šè¿‡ `name` å±æ€§æŒ‡å®šæ³¨å…¥çš„ Bean åç§°ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š `name` ä¸”æ‰¾ä¸åˆ°å¯¹åº”çš„åç§° Beanï¼Œä¼šæŒ‰ **ç±»å‹** æ³¨å…¥ã€‚
  - `@Autowired` é»˜è®¤æŒ‰ **ç±»å‹** æ³¨å…¥ã€‚å¦‚æœéœ€è¦æŒ‰åç§°æ³¨å…¥ï¼Œå¯ä»¥ç»“åˆ `@Qualifier` æ³¨è§£ä½¿ç”¨ã€‚
- **é…ç½®å±æ€§**ï¼š
  - `@Resource` æä¾›äº† `name` å’Œ `type` ä¸¤ä¸ªå±æ€§ï¼Œç”¨äºç²¾ç¡®æŒ‡å®šæ³¨å…¥çš„ç›®æ ‡ã€‚
  - `@Autowired` æä¾›äº† `required` å±æ€§ï¼Œç”¨äºæ§åˆ¶æ˜¯å¦å¿…é¡»æ³¨å…¥ï¼ˆé»˜è®¤å€¼ä¸º `true`ï¼Œå³å¿…é¡»æ³¨å…¥ï¼‰ã€‚
- **é€‚ç”¨èŒƒå›´**ï¼š
  - `@Resource` é€šå¸¸ç”¨äºæ›´é€šç”¨çš„åœºæ™¯ï¼Œä¸ Java EE å…¼å®¹ã€‚
  - `@Autowired` æ˜¯ Spring ç‰¹æœ‰çš„ï¼Œä¾èµ–äº Spring å®¹å™¨ã€‚

------

### è¯¦ç»†è§£æ

#### 1. **`@Resource` çš„ä½¿ç”¨**

```java
@Resource(name = "myService")
private MyService service;
```

- **æŒ‰åç§°æ³¨å…¥**ï¼šå¦‚æœæŒ‡å®šäº† `name` å±æ€§ï¼ŒSpring ä¼šåœ¨å®¹å™¨ä¸­æŸ¥æ‰¾åä¸º `"myService"` çš„ Bean å¹¶æ³¨å…¥ã€‚
- **æŒ‰ç±»å‹æ³¨å…¥**ï¼šå¦‚æœæ²¡æœ‰æŒ‡å®š `name` å±æ€§ï¼ŒSpring ä¼šæ ¹æ®å­—æ®µæˆ–å±æ€§çš„ç±»å‹å¯»æ‰¾åŒ¹é…çš„ Beanã€‚

------

#### 2. **`@Autowired` çš„ä½¿ç”¨**

```java
@Autowired
private MyService service;
```

- **æŒ‰ç±»å‹æ³¨å…¥**ï¼šSpring æ ¹æ® `MyService` çš„ç±»å‹å¯»æ‰¾åŒ¹é…çš„ Beanã€‚
- **å¯é€‰æ€§æ§åˆ¶**ï¼š`@Autowired(required = false)` è¡¨ç¤ºæ³¨å…¥æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ Beanï¼Œå­—æ®µå°†ä¿æŒæœªèµ‹å€¼ã€‚

```java
@Autowired(required = false)
private Optional<MyService> service; // Java 8 çš„ Optional
```

------

#### 3. **ä¸¤è€…çš„å¯¹æ¯”ç¤ºä¾‹**

å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹é…ç½®ï¼š

```java
@Component("myService")
public class MyServiceImpl implements MyService {
    // å®ç°æ–¹æ³•
}
```

ä½¿ç”¨ `@Resource` å’Œ `@Autowired` æ³¨å…¥ï¼š

```java
@Component
public class MyController {

    @Resource(name = "myService")
    private MyService service1; // æŒ‰åç§°æ³¨å…¥

    @Autowired
    private MyService service2; // æŒ‰ç±»å‹æ³¨å…¥
}
```

**æ€»ç»“**ï¼š

- å¦‚æœ `@Resource(name = "myService")` æ‰¾ä¸åˆ°æŒ‡å®šåç§°çš„ Beanï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚
- å¦‚æœ `@Autowired` æ‰¾åˆ°å¤šä¸ª `MyService` ç±»å‹çš„ Beanï¼Œä¼šæŠ›å‡ºæ­§ä¹‰æ€§å¼‚å¸¸ã€‚

------

### çŸ¥è¯†æ‰©å±•

#### Spring æ¡†æ¶ä¸­çš„ä¾èµ–æ³¨å…¥æ¨¡å¼

1. **æ„é€ å™¨æ³¨å…¥**ï¼šé€šè¿‡æ„é€ å‡½æ•°å®ç°ä¾èµ–æ³¨å…¥ï¼Œæ¨èç”¨äºä¸å¯å˜å­—æ®µã€‚
2. **Setter æ³¨å…¥**ï¼šé€šè¿‡ Setter æ–¹æ³•æ³¨å…¥ï¼Œé€‚åˆå¯é€‰çš„ä¾èµ–ã€‚
3. **å­—æ®µæ³¨å…¥**ï¼šé€šè¿‡æ³¨è§£ç›´æ¥æ³¨å…¥ï¼Œç®€æ´ä½†éš¾ä»¥æµ‹è¯•ã€‚

#### ä¾èµ–æ³¨å…¥çš„ä¼˜å…ˆçº§

Spring ä¸­å¤šä¸ªæ³¨è§£å¯èƒ½åŒæ—¶ä½¿ç”¨æ—¶çš„ä¼˜å…ˆçº§ï¼š

- `@Resource` çš„ä¼˜å…ˆçº§é«˜äº `@Autowired`ï¼Œå¦‚æœä¸€ä¸ªå­—æ®µåŒæ—¶æ ‡æ³¨äº†ä¸¤è€…ï¼Œ`@Resource` ç”Ÿæ•ˆã€‚

#### å¤š Bean çš„æ³¨å…¥

å½“æœ‰å¤šä¸ªç±»å‹ç›¸åŒçš„ Bean æ—¶ï¼š

1. `@Qualifier` å’Œ `@Autowired` é…åˆä½¿ç”¨ï¼Œæ˜ç¡®æŒ‡å®š Bean åç§°ã€‚
2. ä½¿ç”¨ `@Primary` åœ¨ä¸€ä¸ª Bean ä¸Šæ ‡è®°ä¸ºé»˜è®¤æ³¨å…¥ã€‚

------

### æ€»ç»“

![image-20250109092346658](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109092346658.png)

- **`@Resource` æ›´å…³æ³¨åç§°åŒ¹é…ï¼Œå…¼å®¹æ€§å¼ºï¼Œé€‚åˆè·¨æ¡†æ¶ä½¿ç”¨ï¼Œæ˜¯javaåŸç”Ÿçš„javax.annotationä¸‹ã€‚**

- **`@Autowired` æ›´çµæ´»ï¼Œå¼ºç±»å‹æ³¨å…¥ï¼Œä¸ Spring æ¡†æ¶æ·±åº¦é›†æˆï¼Œå¦‚æœåˆå¤šä¸ªç›¸åŒTypeçš„ï¼Œå¯ä»¥ç»“åˆQualifieræ³¨è§£**

  ![ç»“åˆQualiferæ³¨è§£æ­é…Autowired](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109092226343.png)

![image-20250109092039180](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109092039180.png)

------

### ç›¸å…³é¢è¯•é¢˜

1. å¦‚æœå®¹å™¨ä¸­æœ‰ä¸¤ä¸ªç›¸åŒç±»å‹çš„ Beanï¼Œåˆ†åˆ«ä½¿ç”¨ `@Resource` å’Œ `@Autowired`ï¼Œç»“æœä¼šæ€æ ·ï¼Ÿ
2. è¯·è§£é‡Š `@Primary` å’Œ `@Qualifier` çš„ä½œç”¨åŠåŒºåˆ«ã€‚
3. å¦‚æœåŒæ—¶ä½¿ç”¨äº† `@Resource` å’Œ `@Autowired`ï¼Œå¦‚ä½•ç¡®å®šæœ€ç»ˆæ³¨å…¥çš„ Beanï¼Ÿ
4. ä½¿ç”¨ `@Autowired` æ³¨å…¥æ—¶ï¼Œå¦‚ä½•å¤„ç†å¯èƒ½ä¸ºç©ºçš„ä¾èµ–ï¼Ÿ

## IoCå’ŒDIçš„åŒºåˆ«ï¼Ÿ

IoCï¼ˆInverse of Control:æ§åˆ¶åè½¬ï¼‰æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³æˆ–è€…è¯´æ˜¯æŸç§æ¨¡å¼ã€‚è¿™ä¸ªè®¾è®¡æ€æƒ³å°±æ˜¯ **å°†åŸæœ¬åœ¨ç¨‹åºä¸­æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒäº¤ç»™ç¬¬ä¸‰æ–¹æ¯”å¦‚ IoC å®¹å™¨ã€‚** å¯¹äºæˆ‘ä»¬å¸¸ç”¨çš„ Spring æ¡†æ¶æ¥è¯´ï¼Œ IoC å®¹å™¨å®é™…ä¸Šå°±æ˜¯ä¸ª Mapï¼ˆkeyï¼Œvalueï¼‰,Map ä¸­å­˜æ”¾çš„æ˜¯å„ç§å¯¹è±¡ã€‚ä¸è¿‡ï¼ŒIoC åœ¨å…¶ä»–è¯­è¨€ä¸­ä¹Ÿæœ‰åº”ç”¨ï¼Œå¹¶é Spring ç‰¹æœ‰ã€‚

IoC æœ€å¸¸è§ä»¥åŠæœ€åˆç†çš„å®ç°æ–¹å¼å«åšä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼Œç®€ç§° DIï¼‰ã€‚

### æ€»ç»“

| **å¯¹æ¯”ç»´åº¦** | **IOC**                        | **DI**                       |
| ------------ | ------------------------------ | ---------------------------- |
| å®šä¹‰         | ä¸€ç§è®¾è®¡åŸåˆ™                   | å®ç°IOCçš„å…·ä½“æ–¹å¼            |
| æ ¸å¿ƒç›®æ ‡     | åè½¬å¯¹è±¡åˆ›å»ºå’Œä¾èµ–ç®¡ç†çš„æ§åˆ¶æƒ | æ³¨å…¥ä¾èµ–ï¼Œè§£è€¦å¯¹è±¡           |
| å®ç°æ–¹å¼     | å¯é€šè¿‡DIã€æœåŠ¡å®šä½å™¨ç­‰å®ç°     | é€šè¿‡æ„é€ å™¨ã€Setterç­‰æ–¹å¼å®ç° |
| ä¾èµ–äºå®¹å™¨   | æ˜¯                             | æ˜¯                           |



## Springæ³¨å…¥ä¾èµ–çš„å‡ ç§æ–¹å¼ï¼Ÿ

- Setterï¼šåœ¨xmlä¸­æ³¨å…¥setteræ–¹æ³•

æœ¬è´¨ä¸ŠåŒ…å«ä¸¤æ­¥ï¼š

1. **ç¬¬ä¸€æ­¥ï¼Œéœ€è¦new UserServiceImpl()åˆ›å»ºå¯¹è±¡, æ‰€ä»¥éœ€è¦é»˜è®¤æ„é€ å‡½æ•°**
2. **ç¬¬äºŒæ­¥ï¼Œè°ƒç”¨setUserDao()å‡½æ•°æ³¨å…¥userDaoçš„å€¼, æ‰€ä»¥éœ€è¦setUserDao()å‡½æ•°**

![image-20250109093938337](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109093938337.png)ã€

- æ„é€ å‡½æ•°æ³¨å…¥

![image-20250109094055803](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109094055803.png)

- æœ€åä¸€ä¸ªå°±æ˜¯æœ€å¸¸ç”¨çš„æ³¨è§£æ³¨å…¥

![image-20250109092526737](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109092526737.png)

## Springæ³¨å…¥IOCå®¹å™¨çš„å‡ ç§æ–¹æ³•

![image-20250109093716248](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109093716248.png)

- æ³¨è§£æ³¨å…¥

![image-20250109093824147](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109093824147.png)

- xmé…ç½®

![image-20250109093814489](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109093814489.png)

- @Configuration+@Bean
- ![image-20250109093747283](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109093747283.png)

## @Componentå’Œ@Configurationçš„åŒºåˆ«

### ä¸»è¦å›ç­”

![image-20250109093542631](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109093542631.png)



## Beançš„ä½œç”¨åŸŸæœ‰å‡ ç§

![image-20250109100026118](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109100026118.png)

**å®˜ç½‘æœ€æ–°çš„å…­ç§ä½œç”¨åŸŸ**

![image-20250109095919790](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109095919790.png)

### 1.Singleton(é»˜è®¤)

- **æè¿°**ï¼šé»˜è®¤ä½œç”¨åŸŸã€‚Spring å®¹å™¨ä¸­åªä¼šåˆ›å»ºè¯¥ Bean çš„ä¸€ä¸ªå®ä¾‹ï¼Œæ— è®ºä½ è·å–å¤šå°‘æ¬¡ï¼Œå§‹ç»ˆæ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚
- **ä½¿ç”¨åœºæ™¯**ï¼šé€‚åˆæ— çŠ¶æ€çš„ã€å…±äº«èµ„æºçš„ Beanã€‚
- **å£°æ˜æ–¹å¼**ï¼š`@Scope("singleton")` æˆ–é»˜è®¤ä¸å£°æ˜ã€‚

### 2. **Prototype**

- **æè¿°**ï¼šæ¯æ¬¡è·å–æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚
- **ä½¿ç”¨åœºæ™¯**ï¼šé€‚åˆéœ€è¦é¢‘ç¹åˆ›å»ºçš„ Beanï¼Œä¾‹å¦‚å¤šçº¿ç¨‹ä¸­éœ€è¦ç‹¬ç«‹çŠ¶æ€çš„ Beanã€‚
- **å£°æ˜æ–¹å¼**ï¼š`@Scope("prototype")`ã€‚

### 3. **Request**

- **æè¿°**ï¼šæ¯ä¸ª HTTP è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸä¸è¯·æ±‚ç›¸åŒã€‚
- **ä½¿ç”¨åœºæ™¯**ï¼šé€‚åˆ Web åº”ç”¨ä¸­ä¸å•æ¬¡è¯·æ±‚å…³è”çš„ Beanã€‚
- **å£°æ˜æ–¹å¼**ï¼š`@Scope("request")`ã€‚
- **å‰æ**ï¼šéœ€è¦åœ¨ Web åº”ç”¨ç¯å¢ƒä¸‹è¿è¡Œã€‚

### 4. **Session**

- **æè¿°**ï¼šæ¯ä¸ª HTTP Session ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸä¸ä¼šè¯ç›¸åŒã€‚
- **ä½¿ç”¨åœºæ™¯**ï¼šé€‚åˆ Web åº”ç”¨ä¸­éœ€è¦ä¸ç”¨æˆ·ä¼šè¯ç»‘å®šçš„ Beanã€‚
- **å£°æ˜æ–¹å¼**ï¼š`@Scope("session")`ã€‚
- **å‰æ**ï¼šéœ€è¦åœ¨ Web åº”ç”¨ç¯å¢ƒä¸‹è¿è¡Œã€‚

### 5. **Application**

- **æè¿°**ï¼šåœ¨ ServletContext çº§åˆ«å…±äº«åŒä¸€ä¸ªå®ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸä¸ Web åº”ç”¨ç¨‹åºä¸€è‡´ã€‚
- **ä½¿ç”¨åœºæ™¯**ï¼šé€‚åˆæ•´ä¸ªåº”ç”¨ç¨‹åºèŒƒå›´å…±äº«çš„ Beanã€‚
- **å£°æ˜æ–¹å¼**ï¼š`@Scope("application")`ã€‚
- **å‰æ**ï¼šéœ€è¦åœ¨ Web åº”ç”¨ç¯å¢ƒä¸‹è¿è¡Œã€‚

### 6. **WebSocket**

- **æè¿°**ï¼šæ¯ä¸ª WebSocket ä¼šè¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚
- **ä½¿ç”¨åœºæ™¯**ï¼šé€‚åˆåŸºäº WebSocket ä¼šè¯çš„ Beanã€‚
- **å£°æ˜æ–¹å¼**ï¼š`@Scope("websocket")`ã€‚
- **å‰æ**ï¼šéœ€è¦åœ¨æ”¯æŒ WebSocket çš„åº”ç”¨ä¸­è¿è¡Œã€‚



## æ€ä¹ˆç»‘å®šBeançš„ä½œç”¨åŸŸï¼Ÿ

**é‡ç‚¹**ï¼šé€šè¿‡Scopeæ¥ç»‘å®š

```java
@Component
@Scope(value = "request")
public class RequestScopedBean {
}

```



![image-20250109100457772](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109100457772.png)



## @RequestBodyçš„ä½œç”¨ï¼Ÿ

### å›ç­”é‡ç‚¹

`@RequestBody` æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºå°† HTTP è¯·æ±‚ä½“å†…å®¹ç»‘å®šåˆ° Java å¯¹è±¡çš„æ³¨è§£ï¼Œé€šå¸¸ç”¨äºå¤„ç† JSON æˆ– XML æ ¼å¼çš„æ•°æ®ã€‚åœ¨ Spring çš„ `@Controller` æˆ– `@RestController` æ–¹æ³•ä¸­ï¼Œ`@RequestBody` è§£æè¯·æ±‚ä½“ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ–¹æ³•å‚æ•°å¯¹è±¡ã€‚

------

### è¯¦ç»†è§£æ

#### ä½¿ç”¨åœºæ™¯

1. **å¤„ç† HTTP POST/PUT è¯·æ±‚çš„è¯·æ±‚ä½“**
   - é€šå¸¸ç”¨äº RESTful æ¥å£ï¼Œåœ¨å®¢æˆ·ç«¯æäº¤ JSON æˆ– XML æ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨ç«¯éœ€è¦å°†è¿™äº›æ•°æ®è½¬æ¢ä¸º Java å¯¹è±¡ä»¥ä¾¿è¿›ä¸€æ­¥å¤„ç†ã€‚
2. **ç»“åˆ Jackson åºåˆ—åŒ–**
   - Spring MVC ä½¿ç”¨ Jackson åº“ï¼ˆé»˜è®¤ï¼‰å°† JSON æ•°æ®ååºåˆ—åŒ–ä¸ºå¯¹åº”çš„ Java å¯¹è±¡ï¼Œæˆ–è€…å°† Java å¯¹è±¡åºåˆ—åŒ–ä¸º JSON æ•°æ®è¿”å›ã€‚

#### ç¤ºä¾‹ä»£ç 

```java
@RestController
public class UserController {
    @PostMapping("/users")
    public String createUser(@RequestBody User user) {
        return "User " + user.getName() + " created successfully!";
    }
}

class User {
    private String name;
    private int age;

    // getters and setters
}
```

#### è¯·æ±‚ç¤ºä¾‹

**è¯·æ±‚ URL:**
 `POST http://localhost:8080/users`

**è¯·æ±‚ä½“ (JSON):**

```json
{
    "name": "Alice",
    "age": 25
}
```

**æœåŠ¡å™¨è¾“å‡º:**
 `User Alice created successfully!`

#### å·¥ä½œåŸç†

1. Spring MVC ä½¿ç”¨ `HttpMessageConverter`ï¼ˆä¾‹å¦‚ `MappingJackson2HttpMessageConverter`ï¼‰è¯»å–è¯·æ±‚ä½“å¹¶å°†å…¶ååºåˆ—åŒ–ã€‚
2. é€šè¿‡ `@RequestBody` æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•å‚æ•°ä¼šè¢«è‡ªåŠ¨æ³¨å…¥ååºåˆ—åŒ–åçš„å¯¹è±¡ã€‚
3. å¦‚æœè¯·æ±‚ä½“ä¸ç›®æ ‡å¯¹è±¡ç»“æ„ä¸åŒ¹é…ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚ `HttpMessageNotReadableException`ã€‚

#### ç‰¹ç‚¹ä¸é™åˆ¶

- ä¼˜ç‚¹

  :

  - ç®€åŒ–äº†æ‰‹åŠ¨è§£æè¯·æ±‚ä½“çš„å·¥ä½œã€‚
  - ä¸ Spring çš„ä¾èµ–æ³¨å…¥æ— ç¼é›†æˆã€‚

- é™åˆ¶

  :

  - é»˜è®¤éœ€è¦è¯·æ±‚ä½“ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœè¯·æ±‚ä½“å¯é€‰ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® 

    ```
    required = false
    ```

     æ¥å®ç°:

    ```java
    public ResponseEntity<?> update(@RequestBody(required = false) User user) { ... }
    ```

------

### çŸ¥è¯†æ‰©å±•

#### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ³•

1. **`HttpMessageNotReadableException`**
   - åŸå› ï¼šè¯·æ±‚ä½“ä¸ Java å¯¹è±¡ç»“æ„ä¸åŒ¹é…ã€‚
   - è§£å†³ï¼šç¡®ä¿ JSON æ•°æ®ä¸ç›®æ ‡å¯¹è±¡çš„å­—æ®µå’Œç±»å‹ä¸€è‡´ã€‚
2. **ç¼ºå°‘é»˜è®¤æ„é€ å‡½æ•°**
   - åŸå› ï¼šç›®æ ‡å¯¹è±¡ç¼ºå°‘æ— å‚æ„é€ å‡½æ•°ã€‚
   - è§£å†³ï¼šä¸º POJO æ·»åŠ æ— å‚æ„é€ å‡½æ•°ã€‚
3. **å­—ç¬¦ç¼–ç é—®é¢˜**
   - ç¡®ä¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å­—ç¬¦é›†ä¸€è‡´ï¼ˆå¦‚ UTF-8ï¼‰ã€‚

#### ä¸å…¶ä»–æ³¨è§£çš„å¯¹æ¯”

| æ³¨è§£              | ä½œç”¨                                     |
| ----------------- | ---------------------------------------- |
| `@RequestBody`    | å°†è¯·æ±‚ä½“ç»‘å®šåˆ°æ–¹æ³•å‚æ•°å¯¹è±¡               |
| `@RequestParam`   | æå– URL ä¸­çš„æŸ¥è¯¢å‚æ•°æˆ–è¡¨å•å‚æ•°          |
| `@PathVariable`   | æå– URL è·¯å¾„ä¸­çš„åŠ¨æ€éƒ¨åˆ†                |
| `@ModelAttribute` | å°†è¡¨å•æ•°æ®ç»‘å®šåˆ°å¯¹è±¡ï¼ˆé€šå¸¸ç”¨äºè¡¨å•æäº¤ï¼‰ |

------

### æ€»ç»“

`@RequestBody` æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºç®€åŒ– JSON æˆ– XML è¯·æ±‚æ•°æ®åˆ° Java å¯¹è±¡çš„æ˜ å°„ã€‚å®ƒé€‚åˆåœ¨ RESTful é£æ ¼çš„ API ä¸­å¤„ç†å¤æ‚çš„è¯·æ±‚æ•°æ®ã€‚é€šè¿‡ç»“åˆ Spring çš„åºåˆ—åŒ–æœºåˆ¶ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿå®ç°æ¥å£åŠŸèƒ½ï¼ŒåŒæ—¶æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚





# MYSQL

## ä»€ä¹ˆæ˜¯æ•°æ®åº“çš„éš”ç¦»çº§åˆ«

### **ä»€ä¹ˆæ˜¯äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Ÿ**

**äº‹åŠ¡éš”ç¦»çº§åˆ«**æ˜¯æ•°æ®åº“ç³»ç»Ÿç”¨æ¥å®šä¹‰å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œç›¸äº’ä¹‹é—´éš”ç¦»ç¨‹åº¦çš„æœºåˆ¶ã€‚å®ƒä¸»è¦è§£å†³åœ¨å¹¶å‘äº‹åŠ¡ç¯å¢ƒä¸‹å¯èƒ½å‡ºç°çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œæ¯”å¦‚**è„è¯»**ã€**ä¸å¯é‡å¤è¯»**å’Œ**å¹»è¯»**ã€‚

äº‹åŠ¡éš”ç¦»çº§åˆ«é€šè¿‡è®¾ç½®ä¸åŒçš„é™åˆ¶ï¼Œæ¥æ§åˆ¶äº‹åŠ¡å¯¹å…±äº«èµ„æºï¼ˆå¦‚è¡¨ã€è¡Œã€é¡µï¼‰çš„è®¿é—®æ–¹å¼ï¼Œä»¥å¹³è¡¡æ•°æ®ä¸€è‡´æ€§å’Œç³»ç»Ÿæ€§èƒ½ã€‚

------

### **äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰ä¸éš”ç¦»æ€§**

äº‹åŠ¡çš„å››å¤§ç‰¹æ€§æ˜¯ **ACID**ï¼ˆAtomicity, Consistency, Isolation, Durabilityï¼‰ï¼Œå…¶ä¸­çš„ **Isolationï¼ˆéš”ç¦»æ€§ï¼‰** å°±æ˜¯äº‹åŠ¡éš”ç¦»çº§åˆ«çš„æ ¸å¿ƒæ‰€åœ¨ã€‚
 éš”ç¦»æ€§ç¡®ä¿ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸ä¼šå—åˆ°å…¶ä»–äº‹åŠ¡ä¸­é—´çŠ¶æ€çš„å¹²æ‰°ã€‚

------

### **äº‹åŠ¡éš”ç¦»çº§åˆ«çš„åˆ†ç±»**

SQLæ ‡å‡†å®šä¹‰äº† 4 ç§éš”ç¦»çº§åˆ«ï¼Œéš”ç¦»æ€§ä»ä½åˆ°é«˜ä¾æ¬¡ä¸ºï¼š

| **éš”ç¦»çº§åˆ«**            | **æè¿°**                                                     | **è§£å†³çš„é—®é¢˜**               | **å…¸å‹é—®é¢˜å¯èƒ½æ€§**     |
| ----------------------- | ------------------------------------------------------------ | ---------------------------- | ---------------------- |
| **1. READ UNCOMMITTED** | äº‹åŠ¡å¯ä»¥è¯»å–åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼ˆè„è¯»ï¼‰                   | æ— é™åˆ¶ï¼Œæ€§èƒ½æœ€é«˜ï¼Œä½†ä¸€è‡´æ€§å·® | è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯» |
| **2. READ COMMITTED**   | äº‹åŠ¡åªèƒ½è¯»å–åˆ°å…¶ä»–äº‹åŠ¡å·²æäº¤çš„æ•°æ®ï¼ˆé˜²æ­¢è„è¯»ï¼‰               | é¿å…è„è¯»                     | ä¸å¯é‡å¤è¯»ã€å¹»è¯»       |
| **3. REPEATABLE READ**  | äº‹åŠ¡å¤šæ¬¡è¯»å–åŒä¸€è¡Œæ•°æ®ï¼Œè¯»å–ç»“æœå§‹ç»ˆä¸€è‡´ï¼ˆé˜²æ­¢ä¸å¯é‡å¤è¯»ï¼‰ï¼Œä½†å¯èƒ½å‡ºç°å¹»è¯» | é¿å…è„è¯»å’Œä¸å¯é‡å¤è¯»         | å¹»è¯»                   |
| **4. SERIALIZABLE**     | æ‰€æœ‰äº‹åŠ¡ä¸²è¡ŒåŒ–æ‰§è¡Œï¼ˆå®Œå…¨éš”ç¦»ï¼Œé˜²æ­¢å¹»è¯»ï¼‰ï¼Œç›¸å½“äºåŠ é”å¤„ç†     | é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»   | æ— å¹¶å‘æ€§ï¼Œæ€§èƒ½æœ€ä½     |

------

### **å››ç§éš”ç¦»çº§åˆ«çš„è¡Œä¸ºå·®å¼‚**

éš”ç¦»çº§åˆ«çš„å®šä¹‰å†³å®šäº†èƒ½é˜²æ­¢å“ªäº›å¹¶å‘é—®é¢˜ï¼š

| éš”ç¦»çº§åˆ«             | è„è¯» (Dirty Read) | ä¸å¯é‡å¤è¯» (Non-Repeatable Read) | å¹»è¯» (Phantom Read) |
| -------------------- | ----------------- | -------------------------------- | ------------------- |
| **READ UNCOMMITTED** | å¯èƒ½              | å¯èƒ½                             | å¯èƒ½                |
| **READ COMMITTED**   | ç¦æ­¢              | å¯èƒ½                             | å¯èƒ½                |
| **REPEATABLE READ**  | ç¦æ­¢              | ç¦æ­¢                             | å¯èƒ½                |
| **SERIALIZABLE**     | ç¦æ­¢              | ç¦æ­¢                             | ç¦æ­¢                |

------

### **éš”ç¦»çº§åˆ«çš„è¯¦ç»†è¯´æ˜**

#### **1. READ UNCOMMITTEDï¼ˆè¯»æœªæäº¤ï¼‰**

- ç‰¹ç‚¹ï¼š
  - äº‹åŠ¡å¯ä»¥è¯»å–åˆ°å…¶ä»–äº‹åŠ¡å°šæœªæäº¤çš„æ•°æ®ã€‚
  - å¹¶å‘æ€§èƒ½æœ€å¥½ï¼Œä½†å¯èƒ½å¯¼è‡´æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚
- é—®é¢˜ï¼š
  - å¯èƒ½å‘ç”Ÿ **è„è¯»**ã€**ä¸å¯é‡å¤è¯»** å’Œ **å¹»è¯»**ã€‚
- é€‚ç”¨åœºæ™¯ï¼š
  - æ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒä½çš„åœºæ™¯ï¼Œä¾‹å¦‚æ—¥å¿—ç³»ç»Ÿã€‚

#### **2. READ COMMITTEDï¼ˆè¯»å·²æäº¤ï¼‰**

- ç‰¹ç‚¹ï¼š
  - ä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–åˆ°å…¶ä»–äº‹åŠ¡å·²æäº¤çš„æ•°æ®ã€‚
  - é¿å…äº† **è„è¯»**ã€‚
- é—®é¢˜ï¼š
  - å¯èƒ½å‘ç”Ÿ **ä¸å¯é‡å¤è¯»** å’Œ **å¹»è¯»**ã€‚
- é€‚ç”¨åœºæ™¯ï¼š
  - éœ€è¦é¿å…è„è¯»ï¼Œä¸”å¯¹ä¸å¯é‡å¤è¯»å’Œå¹»è¯»å®¹å¿çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¾‹å¦‚åœ¨çº¿æŸ¥è¯¢ç³»ç»Ÿã€‚
- MySQLä¸­ï¼š
  - Oracle æ•°æ®åº“é»˜è®¤éš”ç¦»çº§åˆ«ã€‚

#### **3. REPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰**

- ç‰¹ç‚¹ï¼š
  - åœ¨åŒä¸€äº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡è¯»å–åŒä¸€è¡Œçš„æ•°æ®æ—¶ï¼Œç»“æœæ˜¯ä¸€è‡´çš„ã€‚
  - é¿å…äº† **è„è¯»** å’Œ **ä¸å¯é‡å¤è¯»**ã€‚
- é—®é¢˜ï¼š
  - å¯èƒ½å‘ç”Ÿ **å¹»è¯»**ã€‚
- é€‚ç”¨åœºæ™¯ï¼š
  - è¯»ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œä¾‹å¦‚è´¢åŠ¡ç³»ç»Ÿã€‚
- MySQLä¸­ï¼š
  - é»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚MySQLé€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰æœºåˆ¶è§£å†³äº†å¹»è¯»é—®é¢˜ã€‚

#### **4. SERIALIZABLEï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰**

- ç‰¹ç‚¹ï¼š
  - å¼ºåˆ¶äº‹åŠ¡ä¸²è¡ŒåŒ–æ‰§è¡Œï¼Œé¿å…äº†æ‰€æœ‰å¹¶å‘é—®é¢˜ï¼ˆè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ï¼‰ã€‚
  - ç­‰æ•ˆäºå¯¹æ¯ä¸ªæŸ¥è¯¢åŠ é”ã€‚
- é—®é¢˜ï¼š
  - å¹¶å‘æ€§èƒ½æœ€ä½ï¼Œå¯èƒ½å‡ºç°å¤§é‡é”ç­‰å¾…ã€‚
- é€‚ç”¨åœºæ™¯ï¼š
  - æ•°æ®ä¸€è‡´æ€§è¦æ±‚æé«˜ä¸”å¹¶å‘éœ€æ±‚è¾ƒä½çš„åœºæ™¯ï¼Œä¾‹å¦‚é“¶è¡Œè½¬è´¦ç³»ç»Ÿã€‚

------

### **å¦‚ä½•é€‰æ‹©äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Ÿ**

é€‰æ‹©éš”ç¦»çº§åˆ«éœ€è¦æƒè¡¡**æ€§èƒ½**ä¸**ä¸€è‡´æ€§**ï¼š

1. æ€§èƒ½ä¼˜å…ˆï¼Œå®¹å¿ä¸€å®šçš„ä¸ä¸€è‡´æ€§ï¼š
   - ä½¿ç”¨ **READ UNCOMMITTED** æˆ– **READ COMMITTED**ã€‚
2. ä¸€è‡´æ€§ä¼˜å…ˆï¼Œä½†éœ€è¦è¾ƒé«˜å¹¶å‘ï¼š
   - ä½¿ç”¨ **REPEATABLE READ**ï¼ˆMySQL é»˜è®¤ï¼‰ã€‚
3. ä¸€è‡´æ€§ç»å¯¹ä¼˜å…ˆï¼Œå®Œå…¨é¿å…å¹¶å‘é—®é¢˜ï¼š
   - ä½¿ç”¨ **SERIALIZABLE**ï¼Œä½†æ€§èƒ½ä¼šæ˜¾è‘—ä¸‹é™ã€‚

------

### **MySQLä¸­çš„äº‹åŠ¡éš”ç¦»çº§åˆ«**

- é»˜è®¤éš”ç¦»çº§åˆ«ï¼š**REPEATABLE READ**ã€‚

- é…ç½®æ–¹æ³•ï¼š

  1. ä¿®æ”¹å…¨å±€æˆ–ä¼šè¯çº§åˆ«éš”ç¦»çº§åˆ«ï¼š

     ```sql
     SET GLOBAL TRANSACTION ISOLATION LEVEL REPEATABLE READ; -- å…¨å±€ä¿®æ”¹
     SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; -- ä¼šè¯ä¿®æ”¹
     ```

  2. åœ¨äº‹åŠ¡ä¸­è®¾ç½®éš”ç¦»çº§åˆ«ï¼š

     ```sql
     SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
     START TRANSACTION;
     ```

------

### **äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸å¸¸è§é—®é¢˜çš„ç¤ºä¾‹**

#### **(1) è„è¯»é—®é¢˜**

- **åœºæ™¯ï¼š** ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹æ•°æ®ã€‚
- **é¿å…æ–¹å¼ï¼š** é€‰æ‹© **READ COMMITTED** æˆ–æ›´é«˜ã€‚

#### **(2) ä¸å¯é‡å¤è¯»é—®é¢˜**

- **åœºæ™¯ï¼š** ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–åŒä¸€è¡Œæ•°æ®ï¼Œä½†å› ä¸ºå¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†æ•°æ®ï¼Œå¯¼è‡´ç»“æœä¸åŒã€‚
- **é¿å…æ–¹å¼ï¼š** é€‰æ‹© **REPEATABLE READ** æˆ–æ›´é«˜ã€‚

#### **(3) å¹»è¯»é—®é¢˜**

- **åœºæ™¯ï¼š** ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡æŸ¥è¯¢åŒä¸€æ¡ä»¶çš„æ•°æ®èŒƒå›´ï¼Œä½†å¦ä¸€ä¸ªäº‹åŠ¡æ’å…¥äº†æ–°æ•°æ®ï¼Œå¯¼è‡´æŸ¥è¯¢ç»“æœä¸ä¸€è‡´ã€‚
- **é¿å…æ–¹å¼ï¼š** é€‰æ‹© **SERIALIZABLE**ã€‚

------

### **äº‹åŠ¡éš”ç¦»çº§åˆ«çš„é‡è¦æ€§**

1. **ä¿æŠ¤æ•°æ®ä¸€è‡´æ€§ï¼š** é˜²æ­¢å¹¶å‘äº‹åŠ¡å¼•å‘æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚
2. **æå‡æ€§èƒ½ï¼š** é€šè¿‡é€‚å½“çš„éš”ç¦»çº§åˆ«ï¼Œå‡å°‘é”ç«äº‰ï¼Œæå‡å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚
3. **çµæ´»æ€§ï¼š** æ ¹æ®å®é™…éœ€æ±‚ï¼Œæƒè¡¡ä¸€è‡´æ€§å’Œæ€§èƒ½ï¼Œé€‰æ‹©é€‚åˆçš„éš”ç¦»çº§åˆ«ã€‚

å¦‚æœéœ€è¦æ›´è¯¦ç»†çš„å®è·µä»£ç æˆ–æ¡ˆä¾‹åˆ†æï¼Œæ¬¢è¿è¿›ä¸€æ­¥æé—®ï¼

## æ‰§è¡Œä¸€æ¡ select è¯­å¥ï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ



## â€œ**è„è¯»**â€ã€â€œ**ä¸å¯é‡å¤è¯»**â€ å’Œ â€œ**å¹»è¯»**ï¼Ÿ

åœ¨æ•°æ®åº“äº‹åŠ¡ç®¡ç†ä¸­ï¼Œâ€œ**è„è¯»**â€ã€â€œ**ä¸å¯é‡å¤è¯»**â€ å’Œ â€œ**å¹»è¯»**â€ æ˜¯ä¸äº‹åŠ¡éš”ç¦»æ€§ç›¸å…³çš„ä¸‰ç§å…¸å‹é—®é¢˜ã€‚å®ƒä»¬ä¸»è¦å‡ºç°åœ¨å¤šäº‹åŠ¡å¹¶å‘æ“ä½œæ—¶ï¼Œäº†è§£å®ƒä»¬å¯¹äºé€‰æ‹©åˆé€‚çš„éš”ç¦»çº§åˆ«ï¼ˆIsolation Levelï¼‰éå¸¸é‡è¦ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„è§£é‡Šï¼š

------

### **1. è„è¯» (Dirty Read)**

**å®šä¹‰ï¼š**
 ä¸€ä¸ªäº‹åŠ¡èƒ½å¤Ÿè¯»å–åˆ°å¦ä¸€ä¸ªäº‹åŠ¡å°šæœªæäº¤çš„æ•°æ®ã€‚å¦‚æœåè€…äº‹åŠ¡å›æ»šï¼Œé‚£ä¹ˆå‰è€…è¯»å–åˆ°çš„å°±æ˜¯æ— æ•ˆæˆ–â€œè„â€çš„æ•°æ®ã€‚

#### **ç¤ºä¾‹ï¼š**

1. äº‹åŠ¡Aæ›´æ–°äº†ä¸€è¡Œæ•°æ®ï¼Œä½†å°šæœªæäº¤ã€‚
2. äº‹åŠ¡Bè¯»å–äº†è¿™è¡Œæœªæäº¤çš„æ•°æ®ã€‚
3. äº‹åŠ¡Aå›æ»šäº†æ›´æ”¹ï¼Œäº‹åŠ¡Bæ­¤æ—¶è¯»å–çš„æ•°æ®æ˜¯æ— æ•ˆçš„ã€‚

#### **ä»£ç ç¤ºä¾‹ï¼š**

```sql
-- å‡è®¾æœ‰ä¸€å¼ è¡¨ account(balance INT)ï¼Œåˆå§‹ä½™é¢ä¸º 100ã€‚
-- äº‹åŠ¡A
START TRANSACTION;
UPDATE account SET balance = balance - 50 WHERE id = 1; -- å°†ä½™é¢å‡å°‘50

-- äº‹åŠ¡B
START TRANSACTION;
SELECT balance FROM account WHERE id = 1; -- äº‹åŠ¡Bè¯»å–åˆ°æœªæäº¤çš„æ–°ä½™é¢ï¼ˆå¯èƒ½ä¸º50ï¼‰

-- äº‹åŠ¡A
ROLLBACK; -- äº‹åŠ¡Aå›æ»šæ›´æ”¹

-- äº‹åŠ¡Bè¯»å–åˆ°çš„ä½™é¢ï¼ˆ50ï¼‰æ˜¯è„æ•°æ®ï¼Œå› ä¸ºå®é™…ä¸Šä½™é¢åº”è¯¥è¿˜æ˜¯100ã€‚
```

#### **é¿å…æ–¹æ³•ï¼š**

é€‰æ‹©éš”ç¦»çº§åˆ« **`READ COMMITTED`** æˆ–æ›´é«˜ã€‚

------

### **2. ä¸å¯é‡å¤è¯» (Non-Repeatable Read)**

**å®šä¹‰ï¼š**
 ä¸€ä¸ªäº‹åŠ¡åœ¨ä¸¤æ¬¡è¯»å–åŒä¸€æ•°æ®æ—¶ï¼Œæ•°æ®å€¼å› å¦ä¸€ä¸ªäº‹åŠ¡çš„æäº¤è€Œå‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´è¯»å–çš„ç»“æœä¸ä¸€è‡´ã€‚

#### **ç¤ºä¾‹ï¼š**

1. äº‹åŠ¡Aè¯»å–äº†æŸè¡Œæ•°æ®ã€‚
2. äº‹åŠ¡Bæ›´æ–°äº†è¯¥è¡Œæ•°æ®å¹¶æäº¤ã€‚
3. äº‹åŠ¡Aå†æ¬¡è¯»å–åŒä¸€è¡Œæ•°æ®ï¼Œå‘ç°å†…å®¹å·²è¢«ä¿®æ”¹ã€‚

#### **ä»£ç ç¤ºä¾‹ï¼š**

```sql
-- å‡è®¾è¡¨ account(balance INT)ï¼Œåˆå§‹ä½™é¢ä¸º 100ã€‚
-- äº‹åŠ¡A
START TRANSACTION;
SELECT balance FROM account WHERE id = 1; -- ç¬¬ä¸€æ¬¡è¯»å–ï¼Œä½™é¢ä¸º100

-- äº‹åŠ¡B
START TRANSACTION;
UPDATE account SET balance = balance + 50 WHERE id = 1; -- æ›´æ–°ä½™é¢ä¸º150
COMMIT; -- æäº¤æ›´æ”¹

-- äº‹åŠ¡A
SELECT balance FROM account WHERE id = 1; -- ç¬¬äºŒæ¬¡è¯»å–ï¼Œä½™é¢å˜ä¸º150
-- ä¸¤æ¬¡è¯»å–ç»“æœä¸åŒï¼Œä¸å¯é‡å¤è¯»é—®é¢˜ã€‚
```

#### **é¿å…æ–¹æ³•ï¼š**

é€‰æ‹©éš”ç¦»çº§åˆ« **`REPEATABLE READ`** æˆ–æ›´é«˜ã€‚

------

### **3. å¹»è¯» (Phantom Read)**

**å®šä¹‰ï¼š**
 ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡æŸ¥è¯¢æŸèŒƒå›´çš„æ•°æ®æ—¶ï¼Œå› å¦ä¸€ä¸ªäº‹åŠ¡æ’å…¥äº†æ–°çš„æ•°æ®è€Œå¯¼è‡´ç»“æœé›†ä¸ä¸€è‡´ã€‚

#### **ç¤ºä¾‹ï¼š**

1. äº‹åŠ¡AæŸ¥è¯¢æ»¡è¶³æŸæ¡ä»¶çš„è®°å½•é›†ã€‚
2. äº‹åŠ¡Bæ’å…¥äº†ä¸€æ¡æ–°è®°å½•å¹¶æäº¤ã€‚
3. äº‹åŠ¡Aå†æ¬¡æŸ¥è¯¢ç›¸åŒæ¡ä»¶ï¼Œå‘ç°å¤šäº†ä¸€æ¡è®°å½•ã€‚

#### **ä»£ç ç¤ºä¾‹ï¼š**

```sql
-- å‡è®¾è¡¨ account(balance INT)ï¼Œåˆå§‹æœ‰ä¸¤æ¡è®°å½• (id=1, id=2)ã€‚
-- äº‹åŠ¡A
START TRANSACTION;
SELECT * FROM account WHERE balance > 50; -- æŸ¥è¯¢ä½™é¢å¤§äº50çš„è®°å½•ï¼Œç»“æœå¯èƒ½æ˜¯ä¸¤æ¡

-- äº‹åŠ¡B
START TRANSACTION;
INSERT INTO account (id, balance) VALUES (3, 60); -- æ’å…¥æ–°è®°å½•
COMMIT; -- æäº¤æ›´æ”¹

-- äº‹åŠ¡A
SELECT * FROM account WHERE balance > 50; -- å†æ¬¡æŸ¥è¯¢ï¼Œç»“æœå¤šäº†ä¸€æ¡è®°å½•(id=3)
-- äº‹åŠ¡Aå‘ç°å¤šå‡ºäº†æ•°æ®ï¼Œå³ä¸ºå¹»è¯»ã€‚
```

#### **é¿å…æ–¹æ³•ï¼š**

é€‰æ‹©éš”ç¦»çº§åˆ« **`SERIALIZABLE`**ã€‚

------

### **æ€»ç»“ï¼šä¸åŒé—®é¢˜ä¸éš”ç¦»çº§åˆ«çš„å…³ç³»**

| éš”ç¦»çº§åˆ«             | è„è¯» | ä¸å¯é‡å¤è¯» | å¹»è¯» |
| -------------------- | ---- | ---------- | ---- |
| **READ UNCOMMITTED** | å¯èƒ½ | å¯èƒ½       | å¯èƒ½ |
| **READ COMMITTED**   | ç¦æ­¢ | å¯èƒ½       | å¯èƒ½ |
| **REPEATABLE READ**  | ç¦æ­¢ | ç¦æ­¢       | å¯èƒ½ |
| **SERIALIZABLE**     | ç¦æ­¢ | ç¦æ­¢       | ç¦æ­¢ |

------

### **å®ç”¨å»ºè®®**

1. **é€‰æ‹©éš”ç¦»çº§åˆ«**ï¼š
   - å¦‚æœè¯»ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜ä¸”æ€§èƒ½å¯æ¥å—ï¼Œä¼˜å…ˆä½¿ç”¨ **`REPEATABLE READ`**ã€‚
   - å¦‚æœå®Œå…¨é¿å…å¹¶å‘é—®é¢˜ä¸”ä¸å…³å¿ƒæ€§èƒ½ï¼Œåˆ™é€‰æ‹© **`SERIALIZABLE`**ã€‚
2. **MySQLé»˜è®¤éš”ç¦»çº§åˆ«ï¼š**
    MySQL çš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ **`REPEATABLE READ`**ï¼Œå®ƒé¿å…äº†è„è¯»å’Œä¸å¯é‡å¤è¯»é—®é¢˜ï¼Œä½†å¯èƒ½å­˜åœ¨å¹»è¯»ã€‚
3. **æµ‹è¯•ç¯å¢ƒä¸­å¤ç°é—®é¢˜ï¼š**
    åˆ©ç”¨äº‹åŠ¡æ¨¡æ‹Ÿä¸Šè¿°ä¸‰ç§é—®é¢˜ï¼Œèƒ½åŠ æ·±å¯¹éš”ç¦»çº§åˆ«çš„ç†è§£ã€‚

------

å¦‚æœéœ€è¦è¿›ä¸€æ­¥çš„å®è·µé¢˜æˆ–ä»£ç æ¼”ç»ƒï¼Œæ¬¢è¿ç»§ç»­æé—®ï¼

## Mysqlä¸­å¦‚ä½•å­˜å‚¨NULL

åœ¨ MySQL ä¸­ï¼Œ**NULL å€¼**çš„å­˜å‚¨æ–¹å¼å–å†³äºè¡¨çš„å­˜å‚¨å¼•æ“ï¼ˆå¦‚ InnoDB æˆ– MyISAMï¼‰ä»¥åŠåˆ—çš„å®šä¹‰æƒ…å†µã€‚NULL å€¼è¡¨ç¤ºå­—æ®µæ²¡æœ‰å€¼æˆ–æœªçŸ¥ï¼Œä¸æ•°å­— 0ã€ç©ºå­—ç¬¦ä¸² `''` å¹¶ä¸ç›¸åŒã€‚

ä»¥ä¸‹æ˜¯ MySQL ä¸­ NULL å€¼çš„å­˜å‚¨å’Œå¤„ç†æ–¹å¼çš„è¯¦ç»†è¯´æ˜ï¼š

------

### **1. NULL å€¼åœ¨å­˜å‚¨ä¸Šçš„å®ç°**

#### **1.1. InnoDB å­˜å‚¨å¼•æ“**

- **NULL å€¼åœ¨è®°å½•ä¸­çš„å­˜å‚¨ï¼š**

  - åœ¨ InnoDB ä¸­ï¼Œæ¯ä¸€è¡Œè®°å½•æœ‰ä¸€ä¸ªé¢å¤–çš„ **ä½å›¾ï¼ˆbitmapï¼‰**ï¼Œç”¨æ¥æ ‡è¯†åˆ—æ˜¯å¦ä¸º NULLã€‚
  - å¦‚æœæŸåˆ—å…è®¸ä¸º NULLï¼Œé‚£ä¹ˆåœ¨è¯¥åˆ—çš„ä½å›¾ä¸­ä¼šä¸ºå®ƒåˆ†é…ä¸€ä½ï¼Œç”¨æ¥å­˜å‚¨â€œæ˜¯å¦ä¸º NULLâ€çš„çŠ¶æ€ï¼š
    - **1ï¼šè¡¨ç¤ºè¯¥åˆ—ä¸º NULL**ã€‚
    - **0ï¼šè¡¨ç¤ºè¯¥åˆ—é NULL**ã€‚
  - NULL å€¼æœ¬èº«ä¸ä¼šå ç”¨é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼ˆå³è¯¥åˆ—çš„å®é™…å€¼æœªè¢«å­˜å‚¨ï¼‰ã€‚

- **å­˜å‚¨ç¤ºä¾‹ï¼š**

  - å¦‚æœè¡¨å®šä¹‰ä¸ºï¼š

    ```sql
    CREATE TABLE example (
        id INT NOT NULL,
        name VARCHAR(50),
        age INT NULL
    );
    ```

    - `name` åˆ—å¯ä»¥ä¸º NULLã€‚
    - `age` åˆ—å¯ä»¥ä¸º NULLï¼ŒInnoDB ä¼šä¸º `age` åˆ—åˆ†é… 1 ä½æ¥è¡¨ç¤ºæ˜¯å¦ä¸º NULLã€‚

------

#### **1.2. MyISAM å­˜å‚¨å¼•æ“**

- åœ¨ MyISAM ä¸­ï¼ŒNULL å€¼çš„å­˜å‚¨æ–¹å¼ç±»ä¼¼ InnoDBï¼š
  - ä½¿ç”¨é¢å¤–çš„ä½æ¥æ ‡è¯†åˆ—æ˜¯å¦ä¸º NULLã€‚
  - å¦‚æœä¸€ä¸ªè¡¨åŒ…å«å¤šä¸ªå…è®¸ä¸º NULL çš„åˆ—ï¼ŒMyISAM ä¼šç”¨ä¸€ä¸ª NULL æ ‡å¿—å­—èŠ‚æ¥å­˜å‚¨è¿™äº›åˆ—çš„ NULL çŠ¶æ€ï¼Œæ¯åˆ—å¯¹åº”ä¸€ä½ã€‚
- **å­˜å‚¨æ•ˆç‡ï¼š**
  - NULL å€¼æœ¬èº«ä¸ä¼šå ç”¨å®é™…å­˜å‚¨ç©ºé—´ï¼Œåªä¼šå½±å“ NULL æ ‡å¿—ä½ã€‚

------

### **2. NULL å€¼ä¸ç´¢å¼•**

- **ç´¢å¼•ä¸­å­˜å‚¨ NULL å€¼çš„å¤„ç†ï¼š**
  - InnoDB å¼•æ“ï¼š
    - NULL å€¼å¯ä»¥å­˜å‚¨åœ¨ç´¢å¼•ä¸­ã€‚
    - å¯¹äºå•åˆ—ç´¢å¼•ï¼ŒNULL å€¼ä¼šè¢«ç´¢å¼•ï¼Œä¸”å¤šæ¬¡å‡ºç°çš„ NULL å€¼ä¼šè¢«è§†ä¸ºç›¸åŒçš„é”®å€¼ã€‚
  - MyISAM å¼•æ“ï¼š
    - NULL å€¼ä¹Ÿä¼šè¢«ç´¢å¼•ï¼Œä½†å¤„ç†æ–¹å¼ä¸é NULL å€¼ç±»ä¼¼ã€‚
- **ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•ï¼š**
  - ä¸»é”®åˆ—ï¼ˆ`PRIMARY KEY`ï¼‰**ä¸å…è®¸ä¸º NULL**ï¼Œå› ä¸ºä¸»é”®è¦æ±‚æ¯ä¸€è¡Œè®°å½•å”¯ä¸€æ ‡è¯†ã€‚
  - å”¯ä¸€ç´¢å¼•ï¼ˆ`UNIQUE INDEX`ï¼‰å…è®¸åˆ—ä¸º NULLï¼Œå¹¶ä¸”å¤šä¸ª NULL å€¼è¢«è§†ä¸ºä¸åŒï¼ˆSQL æ ‡å‡†çš„è§„å®šï¼‰ã€‚

------

### **3. NULL å€¼çš„å¤„ç†é€»è¾‘**

#### **3.1. æ¯”è¾ƒæ“ä½œ**

NULL å€¼çš„æ¯”è¾ƒä¸å¸¸è§„å€¼ä¸åŒï¼Œä¸èƒ½ç›´æ¥ç”¨ `=` æˆ– `!=` åˆ¤æ–­ã€‚éœ€è¦ç”¨ **`IS NULL`** æˆ– **`IS NOT NULL`** åˆ¤æ–­æ˜¯å¦ä¸º NULLï¼š

```sql
-- æŸ¥æ‰¾æŸåˆ—å€¼ä¸º NULL çš„è®°å½•ï¼š
SELECT * FROM example WHERE age IS NULL;

-- æŸ¥æ‰¾æŸåˆ—å€¼é NULL çš„è®°å½•ï¼š
SELECT * FROM example WHERE age IS NOT NULL;
```

#### **3.2. NULL å€¼çš„å‚ä¸è®¡ç®—**

ä»»ä½•å€¼ä¸ NULL è¿›è¡Œç®—æœ¯æˆ–é€»è¾‘è¿ç®—ï¼Œç»“æœéƒ½ä¼šæ˜¯ NULLã€‚ä¾‹å¦‚ï¼š

```sql
SELECT 10 + NULL; -- ç»“æœä¸º NULL
SELECT 'abc' || NULL; -- ç»“æœä¸º NULL
```

#### **3.3. èšåˆå‡½æ•°ä¸ NULL**

èšåˆå‡½æ•°ä¼šè‡ªåŠ¨å¿½ç•¥ NULL å€¼ã€‚ä¾‹å¦‚ï¼š

```sql
SELECT AVG(age) FROM example; -- NULL å€¼ä¸ä¼šå‚ä¸å¹³å‡å€¼è®¡ç®—
SELECT COUNT(age) FROM example; -- COUNT åªç»Ÿè®¡é NULL å€¼
```

------

### **4. NULL å¯¹æ€§èƒ½çš„å½±å“**

- **å­˜å‚¨æ•ˆç‡ï¼š**

  - NULL å€¼ä¸ä¼šå ç”¨å®é™…çš„åˆ—å­˜å‚¨ç©ºé—´ï¼Œä½†ä¼šå¢åŠ  NULL æ ‡å¿—ä½ï¼Œé€šå¸¸ä¸ä¼šæ˜¾è‘—å½±å“å­˜å‚¨æ•ˆç‡ã€‚

- **æŸ¥è¯¢æ•ˆç‡ï¼š**

  - æŸ¥è¯¢ NULL å€¼æ—¶ï¼Œé€šå¸¸æ— æ³•åˆ©ç”¨ç´¢å¼•ï¼Œå¯èƒ½å¯¼è‡´å…¨è¡¨æ‰«æã€‚ä¾‹å¦‚ï¼š

    ```sql
    SELECT * FROM example WHERE age IS NULL;
    ```

------

### **5. ç‰¹æ®Šåœºæ™¯ï¼šNOT NULL å’Œ DEFAULT çš„å…³ç³»**

- å¦‚æœæŸåˆ—å®šä¹‰ä¸º `NOT NULL` ä¸”æ²¡æœ‰æŒ‡å®šé»˜è®¤å€¼ï¼ˆ`DEFAULT`ï¼‰ï¼Œé‚£ä¹ˆæ’å…¥æ—¶å¿…é¡»æ˜¾å¼æä¾›ä¸€ä¸ªå€¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚
- å¦‚æœæŸåˆ—å®šä¹‰ä¸ºå…è®¸ NULLï¼Œåˆ™å¯ä»¥æ’å…¥ `NULL` å€¼æˆ–ä¸æŒ‡å®šè¯¥åˆ—ï¼Œé»˜è®¤å€¼ä¸º `NULL`ã€‚

------

### **6. NULL å€¼çš„å¸¸è§é—®é¢˜ä¸è§£å†³**

#### **6.1. ä¸»é”®ä¸æ”¯æŒ NULL**

```sql
CREATE TABLE example (
    id INT PRIMARY KEY, -- ä¸»é”®ä¸å…è®¸ä¸º NULL
    name VARCHAR(50) NULL
);
```

è§£å†³æ–¹æ³•ï¼šä½¿ç”¨å…¶ä»–åˆ—ä½œä¸ºä¸»é”®ï¼Œæˆ–è®¾ç½®é NULL çš„æ›¿ä»£å€¼ã€‚

#### **6.2. NULL ä¸é»˜è®¤å€¼**

å¦‚æœæŸåˆ—æ—¢å…è®¸ NULLï¼Œåˆè®¾ç½®äº†é»˜è®¤å€¼ï¼Œé»˜è®¤å€¼ä»…åœ¨æ’å…¥æœªæä¾›è¯¥åˆ—å€¼æ—¶ç”Ÿæ•ˆã€‚æ’å…¥æ˜¾å¼ NULL æ—¶ï¼Œåˆ—å€¼ä¸º NULLã€‚

#### **6.3. æŸ¥è¯¢ä¸­çš„ NULL**

å¯¹äºå¤šæ¡ä»¶æŸ¥è¯¢ï¼Œè¦æ³¨æ„ NULL çš„ç‰¹æ®Šå¤„ç†ã€‚ä¾‹å¦‚ï¼š

```sql
SELECT * FROM example WHERE age = 30 OR age IS NULL;
-- éœ€è¦æ˜¾å¼åŠ å…¥ IS NULL æ¡ä»¶
```

------

### **æ€»ç»“**

1. **å­˜å‚¨ï¼š** NULL å€¼ä»¥é¢å¤–çš„æ ‡å¿—ä½å­˜å‚¨ï¼Œä¸å ç”¨å®é™…çš„åˆ—å­˜å‚¨ç©ºé—´ã€‚1è¡¨ç¤ºnullï¼Œå ç”¨ä¸€ä¸ªbitmapä¹Ÿå°±æ˜¯1å­—èŠ‚æ¥æ ‡è¯†
2. **ç´¢å¼•ï¼š** NULL å€¼ä¼šè¢«ç´¢å¼•ï¼Œä½†ä¸»é”®åˆ—ä¸å…è®¸ä¸º NULLã€‚
3. **æ¯”è¾ƒï¼š** éœ€è¦ç”¨ `IS NULL` æˆ– `IS NOT NULL` åˆ¤æ–­ NULL å€¼ã€‚
4. **èšåˆï¼š** èšåˆå‡½æ•°è‡ªåŠ¨å¿½ç•¥ NULL å€¼ã€‚

å¦‚æœä½ æœ‰æ›´å…·ä½“çš„åœºæ™¯éœ€æ±‚ï¼Œæ¬¢è¿ç»§ç»­æé—®ï¼



## varchar(n) ä¸­ n æœ€å¤§å–å€¼ä¸ºå¤šå°‘ï¼Ÿ

![image-20241126145754668](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241126145754668.png)

### å•å­—æ®µ

![image-20241126145818613](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241126145818613.png)

![image-20241126145831926](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241126145831926.png)

### å¦‚æœéœ€è¦æ›´å¤§çš„å­—æ®µæ€ä¹ˆåŠ

![image-20241126150912928](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241126150912928.png)

### **5. ç»¼åˆæ€»ç»“**

1. **ç†è®ºä¸Šï¼š** `VARCHAR(n)` çš„ `n` æœ€å¤§å€¼æ˜¯ 65535ï¼Œä½†å—é™äºå­—ç¬¦é›†å’Œå­˜å‚¨å¼•æ“çš„è¡Œå¤§å°é™åˆ¶ã€‚

> utf-8 3å­—èŠ‚ ASCII1å­—èŠ‚

1. å¸¸ç”¨èŒƒå›´ï¼š
   - `latin1` å­—ç¬¦é›†ï¼š`VARCHAR(65535)`ã€‚
   - `utf8mb4` å­—ç¬¦é›†ï¼šå®é™… `n` æœ€å¤§å€¼çº¦ä¸º 16383ã€‚
2. ä¼˜åŒ–å»ºè®®ï¼š
   - æ ¹æ®å®é™…éœ€è¦é€‰æ‹©åˆé€‚çš„å­—ç¬¦é›†å’Œå­—æ®µé•¿åº¦ã€‚
   - è¶…é•¿æ–‡æœ¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ `TEXT` ç±»å‹ã€‚

åŒæ—¶nullä¹Ÿä¼šå ç”¨ä¸€ä¸ªbitmap





## Mysqlsç´¢å¼•

- è¯¦ç»†å‚è€ƒé“¾æ¥

`https://javaguide.cn/database/mysql/mysql-index.html`



## æœ‰å“ªå‡ ç±»ç´¢å¼•

### å›ç­”é‡ç‚¹

ç´¢å¼•å¯ä»¥æ ¹æ®ä¸åŒç»´åº¦è¿›è¡Œåˆ†ç±»ï¼Œå¸¸è§åˆ†ç±»æ–¹æ³•å¦‚ä¸‹ï¼š

1. **æ ¹æ®åŠŸèƒ½åˆ†ç±»**ï¼š
   - **ä¸»é”®ç´¢å¼•**ï¼šå¼ºåˆ¶å”¯ä¸€æ€§çº¦æŸï¼Œç”¨äºä¸»é”®å­—æ®µã€‚
   - **å”¯ä¸€ç´¢å¼•**ï¼šé™åˆ¶å­—æ®µå€¼å”¯ä¸€æ€§ï¼Œå¯åŒ…å«ç©ºå€¼ã€‚
   - **æ™®é€šç´¢å¼•**ï¼šæ— çº¦æŸï¼Œä»…æå‡æŸ¥è¯¢æ€§èƒ½ã€‚
   - **å¤åˆç´¢å¼•**ï¼šåŒ…å«å¤šä¸ªå­—æ®µçš„ç´¢å¼•ï¼Œç”¨äºå¤šæ¡ä»¶ä¼˜åŒ–ã€‚
2. **æ ¹æ®æ•°æ®ç»“æ„åˆ†ç±»**ï¼š
   - **B-Tree ç´¢å¼•**ï¼šå¤§å¤šæ•°æ•°æ®åº“çš„é»˜è®¤ç´¢å¼•ç±»å‹ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œæ’åºã€‚
   - **Hash ç´¢å¼•**ï¼šåŸºäº Hash è¡¨ï¼Œé€‚åˆç²¾ç¡®åŒ¹é…ã€‚
   - **R-Tree ç´¢å¼•**ï¼šç”¨äºå¤šç»´æ•°æ®æŸ¥è¯¢ï¼ˆå¦‚åœ°ç†åæ ‡ï¼‰ã€‚
   - **å…¨æ–‡ç´¢å¼•ï¼ˆå€’æ’ç´¢å¼•ï¼‰**ï¼šä¸ºæ–‡æœ¬å­—æ®µè®¾è®¡ï¼Œæ”¯æŒå…³é”®è¯æœç´¢ã€‚
3. **æ ¹æ®ä½¿ç”¨åœºæ™¯åˆ†ç±»**ï¼š
   - **å•å­—æ®µç´¢å¼•**ï¼šä¼˜åŒ–å•ä¸ªå­—æ®µçš„æŸ¥è¯¢ã€‚
   - **å¤šå­—æ®µç´¢å¼•ï¼ˆå¤åˆç´¢å¼•ï¼‰**ï¼šä¼˜åŒ–å¤šä¸ªå­—æ®µç»„åˆçš„æŸ¥è¯¢ã€‚
   - **è¦†ç›–ç´¢å¼•**ï¼šç´¢å¼•å­—æ®µåŒ…å«æŸ¥è¯¢ä¸­æ‰€æœ‰éœ€è¦çš„å­—æ®µï¼Œé¿å…å›è¡¨ã€‚
   - **å”¯ä¸€çº¦æŸç´¢å¼•**ï¼šåŒæ—¶ä¿è¯å­—æ®µå”¯ä¸€æ€§å’ŒæŸ¥è¯¢æ•ˆç‡ã€‚
4. **æ ¹æ®å­˜å‚¨æ–¹å¼åˆ†ç±»**ï¼š
   - **èšç°‡ç´¢å¼•ï¼ˆClustered Indexï¼‰**ï¼šæ•°æ®å­˜å‚¨é¡ºåºä¸ç´¢å¼•é¡ºåºä¸€è‡´ï¼Œæ¯å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªã€‚
   - **éèšç°‡ç´¢å¼•ï¼ˆNon-Clustered Indexï¼‰**ï¼šç´¢å¼•å­˜å‚¨ä¸æ•°æ®åˆ†ç¦»ï¼Œå¯æœ‰å¤šä¸ªéèšç°‡ç´¢å¼•ã€‚
   - **ç‰©åŒ–ç´¢å¼•ï¼ˆMaterialized Indexï¼‰**ï¼šé¢„è®¡ç®—å¹¶å­˜å‚¨æŸ¥è¯¢ç»“æœçš„ç´¢å¼•ã€‚
5. **æ ¹æ®ç”Ÿå‘½å‘¨æœŸåˆ†ç±»**ï¼š
   - **æ°¸ä¹…ç´¢å¼•**ï¼šæ‰‹åŠ¨åˆ›å»ºå¹¶é•¿æœŸå­˜åœ¨ã€‚
   - **ä¸´æ—¶ç´¢å¼•**ï¼šæ•°æ®åº“åœ¨æŸ¥è¯¢ä¼˜åŒ–æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œç”Ÿå‘½å‘¨æœŸä»…é™äºæŸ¥è¯¢ã€‚

------

### è¯¦ç»†è§£æ

#### **1. åŠŸèƒ½åˆ†ç±»**

| **ç´¢å¼•ç±»å‹** | **æè¿°**                       | **é€‚ç”¨åœºæ™¯**                             |
| ------------ | ------------------------------ | ---------------------------------------- |
| ä¸»é”®ç´¢å¼•     | ç¡®ä¿ä¸»é”®å”¯ä¸€ï¼Œè‡ªåŠ¨ç”Ÿæˆ         | è¡¨çš„ä¸»é”®å­—æ®µï¼Œå¦‚ IDã€‚                    |
| å”¯ä¸€ç´¢å¼•     | ç¡®ä¿å­—æ®µå€¼å”¯ä¸€ï¼Œå…è®¸ `NULL` å€¼ | å¦‚é‚®ç®±ã€ç”¨æˆ·åå­—æ®µã€‚                     |
| æ™®é€šç´¢å¼•     | æ— å”¯ä¸€æ€§çº¦æŸï¼Œç”¨äºæå‡æŸ¥è¯¢æ€§èƒ½ | ç»å¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„æ™®é€šå­—æ®µã€‚             |
| å¤åˆç´¢å¼•     | åŸºäºå¤šä¸ªå­—æ®µçš„ç´¢å¼•             | å¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢ä¼˜åŒ–ï¼Œå¦‚ `WHERE A AND B`ã€‚ |

------

#### **2. æ•°æ®ç»“æ„åˆ†ç±»**

| **æ•°æ®ç»“æ„** | **ç‰¹ç‚¹**                             | **é€‚ç”¨åœºæ™¯**                         |
| ------------ | ------------------------------------ | ------------------------------------ |
| B-Tree       | é»˜è®¤ç´¢å¼•ç»“æ„ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œæ’åº     | å¤§å¤šæ•°æŸ¥è¯¢åœºæ™¯ï¼Œå¦‚èŒƒå›´æŸ¥è¯¢ã€æ’åºç­‰ã€‚ |
| Hash         | ç²¾ç¡®åŒ¹é…æŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢   | éœ€è¦é«˜æ•ˆé”®å€¼æŸ¥æ‰¾çš„åœºæ™¯ã€‚             |
| R-Tree       | æ”¯æŒå¤šç»´æ•°æ®ï¼ˆå¦‚åœ°ç†åæ ‡ï¼‰çš„èŒƒå›´æŸ¥æ‰¾ | GIS æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢ã€‚                 |
| å€’æ’ç´¢å¼•     | å°†å…³é”®è¯æ˜ å°„åˆ°æ–‡æ¡£ï¼Œé€‚åˆå…¨æ–‡æ£€ç´¢     | æ–‡æœ¬æœç´¢ï¼Œå¦‚å•†å“æè¿°ã€æ–‡ç« å†…å®¹ç­‰ã€‚   |

------

#### **3. ä½¿ç”¨åœºæ™¯åˆ†ç±»**

| **ç´¢å¼•ç±»å‹** | **æè¿°**                           | **é€‚ç”¨åœºæ™¯**                                      |
| ------------ | ---------------------------------- | ------------------------------------------------- |
| å•å­—æ®µç´¢å¼•   | ä¼˜åŒ–å•ä¸ªå­—æ®µçš„æŸ¥è¯¢                 | é’ˆå¯¹å•ä¸€æ¡ä»¶æŸ¥è¯¢ä¼˜åŒ–ï¼Œå¦‚ `WHERE name = 'Alice'`ã€‚ |
| å¤åˆç´¢å¼•     | åŸºäºå¤šå­—æ®µï¼ŒæŒ‰æœ€å·¦å‰ç¼€é¡ºåºä¼˜åŒ–æŸ¥è¯¢ | å¤šæ¡ä»¶è”åˆæŸ¥è¯¢ï¼Œå¦‚ `WHERE A = x AND B = y`ã€‚      |
| è¦†ç›–ç´¢å¼•     | åŒ…å«æŸ¥è¯¢ä¸­æ‰€æœ‰å­—æ®µï¼Œé¿å…å›è¡¨       | æŸ¥è¯¢å­—æ®µä¸ç´¢å¼•å®Œå…¨é‡åˆçš„åœºæ™¯ã€‚                    |
| å”¯ä¸€çº¦æŸç´¢å¼• | åŒæ—¶ç¡®ä¿å­—æ®µå”¯ä¸€æ€§ä¸æ€§èƒ½           | å”¯ä¸€æ€§å’ŒæŸ¥è¯¢ä¼˜åŒ–ï¼Œå¦‚ç”¨æˆ·åæˆ–é‚®ç®±ã€‚                |

------

#### **4. å­˜å‚¨æ–¹å¼åˆ†ç±»**

| **ç´¢å¼•ç±»å‹** | **æè¿°**                               | **é€‚ç”¨åœºæ™¯**                                 |
| ------------ | -------------------------------------- | -------------------------------------------- |
| èšç°‡ç´¢å¼•     | æ•°æ®æŒ‰ç´¢å¼•æ’åºå­˜å‚¨ï¼Œä¸»é”®å­—æ®µä¸Šè‡ªåŠ¨åˆ›å»º | è¡¨çš„ä¸»é”®ç´¢å¼•ï¼Œé€‚åˆç»å¸¸æ’åºã€èŒƒå›´æŸ¥è¯¢çš„å­—æ®µã€‚ |
| éèšç°‡ç´¢å¼•   | ç´¢å¼•å­˜å‚¨ä¸æ•°æ®åˆ†ç¦»ï¼Œå¯æœ‰å¤šä¸ªéèšç°‡ç´¢å¼• | éä¸»é”®å­—æ®µçš„ä¼˜åŒ–ï¼Œå¦‚ `name` æˆ– `email`ã€‚     |
| ç‰©åŒ–ç´¢å¼•     | é¢„è®¡ç®—å¹¶å­˜å‚¨æŸ¥è¯¢ç»“æœ                   | å¤§é‡å¤æ‚æŸ¥è¯¢ç»“æœé‡å¤çš„åœºæ™¯ã€‚                 |

------

### çŸ¥è¯†æ‰©å±•

#### **èšç°‡ç´¢å¼• vs éèšç°‡ç´¢å¼•**

1. èšç°‡ç´¢å¼•ï¼š
   - æ•°æ®ç‰©ç†é¡ºåºä¸ç´¢å¼•é¡ºåºä¸€è‡´ï¼Œä¸»é”®ç´¢å¼•ä¸ºèšç°‡ç´¢å¼•ã€‚
   - æ¯å¼ è¡¨ä»…æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚
   - ä¼˜ç‚¹ï¼šæŸ¥è¯¢å¿«ï¼Œç‰¹åˆ«æ˜¯èŒƒå›´æŸ¥è¯¢ã€‚
   - ç¼ºç‚¹ï¼šæ’å…¥æ–°è®°å½•å¯èƒ½å¯¼è‡´æ•°æ®é¡µé‡æ–°æ’åºã€‚
2. éèšç°‡ç´¢å¼•ï¼š
   - ç´¢å¼•å’Œæ•°æ®ç‹¬ç«‹å­˜å‚¨ï¼Œå¯æœ‰å¤šä¸ªéèšç°‡ç´¢å¼•ã€‚
   - ä¼˜ç‚¹ï¼šçµæ´»ï¼Œå¯ç”¨äºå¤šä¸ªå­—æ®µã€‚
   - ç¼ºç‚¹ï¼šæŸ¥è¯¢éœ€è¦å›è¡¨å¢åŠ å¼€é”€ã€‚

#### **B-Tree vs Hash**

1. B-Tree ç´¢å¼•ï¼š
   - æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ `<`ã€`>`ï¼‰ã€‚
   - é€‚åˆæ’åºå’ŒèŒƒå›´æ¡ä»¶ã€‚
2. Hash ç´¢å¼•ï¼š
   - æŸ¥è¯¢å¤æ‚åº¦ O(1)ï¼Œä½†ä¸æ”¯æŒæ’åºå’ŒèŒƒå›´æ¡ä»¶ã€‚
   - é€‚åˆç­‰å€¼æŸ¥è¯¢ã€‚

------

### æ€»ç»“

ç´¢å¼•åˆ†ç±»æ–¹å¼å¤šæ ·åŒ–ï¼Œå…·ä½“é€‰æ‹©è¦ç»“åˆä¸šåŠ¡éœ€æ±‚ã€‚åŠŸèƒ½ã€æ•°æ®ç»“æ„å’Œå­˜å‚¨æ–¹å¼åˆ†ç±»æ˜¯æœ€å¸¸ç”¨çš„è§’åº¦ã€‚åˆç†ä½¿ç”¨ç´¢å¼•å¯ä»¥æœ‰æ•ˆæå‡æŸ¥è¯¢æ€§èƒ½ï¼ŒåŒæ—¶é¿å…ç´¢å¼•è¿‡å¤šå¯¼è‡´å†™å…¥å¼€é”€å¢åŠ ã€‚

------

## ä»€ä¹ˆæ˜¯ç´¢å¼•ä¸‹æ¨

### å›ç­”é‡ç‚¹

**ç´¢å¼•ä¸‹æ¨**ï¼ˆIndex Condition Pushdown, ICPï¼‰æ˜¯ MySQL 5.6 å¼•å…¥çš„ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œç”¨äºå‡å°‘å›è¡¨æ¬¡æ•°ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡ã€‚

åœ¨ä¼ ç»Ÿçš„ç´¢å¼•æŸ¥è¯¢ä¸­ï¼Œå¦‚æœæœ‰ç´¢å¼•è¦†ç›–äº†éƒ¨åˆ†æŸ¥è¯¢æ¡ä»¶ï¼ŒæŸ¥è¯¢ä¼šé€šè¿‡ç´¢å¼•æ‰¾åˆ°åŒ¹é…çš„è®°å½•æŒ‡é’ˆï¼Œç„¶åå›è¡¨æ£€æŸ¥å‰©ä½™çš„æ¡ä»¶æ˜¯å¦æ»¡è¶³ã€‚è€Œç´¢å¼•ä¸‹æ¨æŠ€æœ¯å…è®¸ MySQL åœ¨**å­˜å‚¨å¼•æ“å±‚**ç›´æ¥ä½¿ç”¨éƒ¨åˆ†æŸ¥è¯¢æ¡ä»¶è¿‡æ»¤æ•°æ®ï¼Œå‡å°‘éœ€è¦å›è¡¨çš„è®°å½•æ•°ã€‚

------

### è¯¦ç»†è§£æ

#### **1. ç´¢å¼•ä¸‹æ¨çš„å·¥ä½œåŸç†**

![image-20241213222557566](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241213222557566.png)

- **ä¼ ç»Ÿç´¢å¼•æŸ¥è¯¢ï¼ˆæ— ç´¢å¼•ä¸‹æ¨ï¼‰**ï¼š
   æŸ¥è¯¢æ¡ä»¶åœ¨ MySQL **æœåŠ¡å™¨å±‚**å¤„ç†ï¼Œå­˜å‚¨å¼•æ“åªé€šè¿‡ç´¢å¼•æŸ¥æ‰¾åˆ°è®°å½•çš„ä¸»é”®å€¼æˆ–è¡Œä½ç½®ã€‚å¯¹äºæ¯æ¡å€™é€‰è®°å½•ï¼Œå­˜å‚¨å¼•æ“éƒ½è¦å›è¡¨è¯»å–å®Œæ•´è®°å½•ï¼Œè¿”å›ç»™æœåŠ¡å™¨å±‚ï¼Œå†ç”±æœåŠ¡å™¨å±‚åˆ¤æ–­æ˜¯å¦ç¬¦åˆå…¶ä»–æŸ¥è¯¢æ¡ä»¶ã€‚
- **ç´¢å¼•ä¸‹æ¨**ï¼š
   ä¸€éƒ¨åˆ†æŸ¥è¯¢æ¡ä»¶ï¼ˆä¸ç´¢å¼•ç›¸å…³çš„æ¡ä»¶ï¼‰è¢«ä¸‹æ¨åˆ°**å­˜å‚¨å¼•æ“å±‚**ï¼Œå­˜å‚¨å¼•æ“å¯ä»¥åœ¨ç´¢å¼•ä¸­ç›´æ¥è¿‡æ»¤æ•°æ®ï¼Œåªæœ‰æ»¡è¶³æ¡ä»¶çš„è®°å½•æ‰ä¼šå›è¡¨ã€‚

#### **2. ç´¢å¼•ä¸‹æ¨çš„é€‚ç”¨åœºæ™¯**

ç´¢å¼•ä¸‹æ¨ä¸»è¦åœ¨ä»¥ä¸‹åœºæ™¯ä¸­ç”Ÿæ•ˆï¼š

1. å¤åˆç´¢å¼•

   ï¼š

   - æŸ¥è¯¢æ¡ä»¶ä¸­åŒ…å«å¤šä¸ªå­—æ®µï¼Œä½†ä¸å…¨æ˜¯æœ€å·¦å‰ç¼€çš„å­—æ®µã€‚

2. èŒƒå›´æŸ¥è¯¢

   ï¼š

   - æŸäº›æ¡ä»¶éœ€è¦å›è¡¨è¿›ä¸€æ­¥åˆ¤æ–­ï¼Œä¾‹å¦‚ `LIKE` æˆ–èŒƒå›´è¿‡æ»¤ã€‚

#### **3. ç¤ºä¾‹è¯´æ˜**

å‡è®¾æœ‰å¦‚ä¸‹è¡¨å’Œç´¢å¼•ï¼š

```sql
CREATE TABLE employees (
    id INT NOT NULL,
    name VARCHAR(100),
    age INT,
    department VARCHAR(50),
    PRIMARY KEY (id),
    KEY idx_name_age (name, age)
);
```

**æŸ¥è¯¢ï¼š**

```sql
SELECT * FROM employees WHERE name LIKE 'A%' AND age > 30;
```

- **æ— ç´¢å¼•ä¸‹æ¨**ï¼š
  1. ä½¿ç”¨ç´¢å¼• `idx_name_age` æ‰¾åˆ° `name LIKE 'A%'` çš„åŒ¹é…è®°å½•ã€‚
  2. å¯¹æ¯æ¡åŒ¹é…è®°å½•è¿›è¡Œå›è¡¨æ“ä½œï¼Œè¯»å–å®Œæ•´è®°å½•ã€‚
  3. å›è¡¨åï¼Œå†ç”±æœåŠ¡å™¨å±‚åˆ¤æ–­ `age > 30` æ˜¯å¦æ»¡è¶³ã€‚
- **ç´¢å¼•ä¸‹æ¨**ï¼š
  1. å­˜å‚¨å¼•æ“å…ˆåœ¨ `idx_name_age` ä¸­æ‰¾åˆ° `name LIKE 'A%'` çš„åŒ¹é…è®°å½•ã€‚
  2. åŒæ—¶ç›´æ¥åœ¨å­˜å‚¨å¼•æ“ä¸­åˆ¤æ–­ `age > 30`ï¼Œä»…ä¿ç•™ç¬¦åˆæ¡ä»¶çš„è®°å½•ã€‚
  3. åªå¯¹ç¬¦åˆä¸¤ä¸ªæ¡ä»¶çš„è®°å½•å›è¡¨è¯»å–å®Œæ•´æ•°æ®ã€‚

------

### çŸ¥è¯†æ‰©å±•

#### **ç´¢å¼•ä¸‹æ¨çš„ä¼˜ç‚¹**

1. å‡å°‘å›è¡¨æ¬¡æ•°

   ï¼š

   - å­˜å‚¨å¼•æ“è¿‡æ»¤æ‰ä¸å¿…è¦çš„è®°å½•ï¼Œé™ä½ç£ç›˜ I/O å¼€é”€ã€‚

2. æå‡æŸ¥è¯¢æ€§èƒ½

   ï¼š

   - å‡å°‘æœåŠ¡å™¨å±‚çš„è®¡ç®—å‹åŠ›ã€‚

#### **ç´¢å¼•ä¸‹æ¨çš„é™åˆ¶**

1. æ¡ä»¶å¿…é¡»ä¸ç´¢å¼•ç›¸å…³

   ï¼š

   - åªæœ‰èƒ½é€šè¿‡ç´¢å¼•è®¿é—®çš„å­—æ®µæ¡ä»¶æ‰å¯ä»¥ä¸‹æ¨ã€‚

2. ä¸æ”¯æŒéç´¢å¼•å­—æ®µçš„æ¡ä»¶

   ï¼š

   - ä¾‹å¦‚ `WHERE name LIKE 'A%' AND department = 'HR'`ï¼Œ`department` çš„æ¡ä»¶ä¸ä¼šè¢«ä¸‹æ¨ã€‚

------

### ç´¢å¼•ä¸‹æ¨çš„æ‰§è¡Œè¿‡ç¨‹ç¤ºæ„å›¾

```plaintext
ä¼ ç»Ÿæ–¹å¼ï¼ˆæ— ç´¢å¼•ä¸‹æ¨ï¼‰ï¼š
ç´¢å¼•åŒ¹é… â†’ å›è¡¨æ‰€æœ‰å€™é€‰è®°å½• â†’ æœåŠ¡å™¨å±‚è¿‡æ»¤å‰©ä½™æ¡ä»¶

ç´¢å¼•ä¸‹æ¨ï¼š
ç´¢å¼•åŒ¹é… â†’ å­˜å‚¨å¼•æ“å±‚è¿‡æ»¤éƒ¨åˆ†æ¡ä»¶ â†’ å›è¡¨ç¬¦åˆæ¡ä»¶çš„è®°å½• â†’ æœåŠ¡å™¨å±‚å®Œæˆå‰©ä½™æ¡ä»¶è¿‡æ»¤
```

------

### æ€»ç»“

![image-20241213222635662](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241213222635662.png)

## é˜²æ­¢ç´¢å¼•å¤±æ•ˆ

![å›¾ç‰‡.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/76b70720b0cb422fb2583fb80a745e99~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

![image-20241213224322902](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241213224322902.png)

![image-20241213224350318](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241213224350318.png)

## Bæ ‘ä¸B+æ ‘çš„åŒºåˆ«

*å‚è€ƒè§†é¢‘åœ°å€*ï¼šhttps://www.bilibili.com/video/BV1zE421F7TA?t=151.2

![image-20250120141331829](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250120141331829.png)

# Javaé›†åˆ

## Java ä¸­çš„ HashSet å’Œ HashMap æœ‰ä»€ä¹ˆåŒºåˆ«

![image-20241127144114391](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20241127144114391.png)

åœ¨ Java ä¸­ï¼Œ`HashSet` å’Œ `HashMap` éƒ½æ˜¯åŸºäºå“ˆå¸Œè¡¨çš„é›†åˆç±»ï¼Œä½†å®ƒä»¬çš„ç”¨é€”å’Œåº•å±‚å®ç°æœ‰æ‰€ä¸åŒã€‚ä»¥ä¸‹ä»ç†è®ºè§’åº¦è¯¦ç»†è§£æä¸¤è€…çš„åŒºåˆ«ï¼Œé‡ç‚¹åœ¨åº•å±‚é€»è¾‘å’Œä½¿ç”¨åœºæ™¯ã€‚

------

### **1. æ ¸å¿ƒåŒºåˆ«æ€»ç»“**

1. **ç”¨é€”**ï¼š
   - **`HashSet`**ï¼šç”¨äºå­˜å‚¨ **å”¯ä¸€å…ƒç´ **ï¼Œä¿è¯æ— é‡å¤ã€‚
   - **`HashMap`**ï¼šç”¨äºå­˜å‚¨ **é”®å€¼å¯¹**ï¼ˆKey-Valueï¼‰ï¼Œé€šè¿‡é”®å¿«é€ŸæŸ¥æ‰¾å€¼ã€‚
2. **åº•å±‚å®ç°**ï¼š
   - **`HashSet`**ï¼šåŸºäº `HashMap` å®ç°ï¼Œå†…éƒ¨ä½¿ç”¨ `HashMap` å­˜å‚¨å…ƒç´ ã€‚
   - **`HashMap`**ï¼šåŸºäºæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘å®ç°ï¼Œæ˜¯æ›´åº•å±‚çš„å®ç°ç»“æ„ã€‚
3. **å­˜å‚¨ç»“æ„**ï¼š
   - **`HashSet`**ï¼šå°†å…ƒç´ å­˜å‚¨ä¸º `HashMap` çš„é”®ï¼ˆ`Key`ï¼‰ï¼Œå€¼ï¼ˆ`Value`ï¼‰ä¸ºå›ºå®šçš„å¸¸é‡å¯¹è±¡ï¼ˆ`PRESENT`ï¼‰ã€‚
   - **`HashMap`**ï¼šå­˜å‚¨é”®å’Œå€¼ï¼Œæ¯ä¸ªé”®å€¼å¯¹æ˜¯ä¸€ä¸ª `Node<K, V>`ã€‚
4. **å”¯ä¸€æ€§**ï¼š
   - **`HashSet`**ï¼šå…ƒç´ çš„å”¯ä¸€æ€§é€šè¿‡ `hashCode` å’Œ `equals` ä¿è¯ã€‚
   - **`HashMap`**ï¼šé”®çš„å”¯ä¸€æ€§é€šè¿‡ `hashCode` å’Œ `equals` ä¿è¯ï¼Œä½†å€¼å¯ä»¥é‡å¤ã€‚

------

### **2. ç†è®ºæ·±åº¦è§£æ**

#### **2.1 ä¸ºä»€ä¹ˆ HashSet åŸºäº HashMap å®ç°ï¼Ÿ**

- `HashSet` çš„ä¸»è¦åŠŸèƒ½æ˜¯å­˜å‚¨å”¯ä¸€å…ƒç´ ï¼Œè€Œ `HashMap` çš„é”®ï¼ˆ`Key`ï¼‰æœ¬èº«å°±æ˜¯å”¯ä¸€çš„ã€‚
- åˆ©ç”¨ `HashMap` çš„é”®å­˜å‚¨å…ƒç´ ï¼Œå¯ä»¥å¤ç”¨ `HashMap` çš„åº•å±‚å“ˆå¸Œè¡¨ã€å†²çªå¤„ç†ï¼ˆé“¾è¡¨/çº¢é»‘æ ‘ï¼‰ã€æ‰©å®¹æœºåˆ¶ç­‰å¤æ‚é€»è¾‘ï¼Œä»è€Œç®€åŒ– `HashSet` çš„å®ç°ã€‚

#### **2.2 HashSet çš„åº•å±‚ç»“æ„**

- `HashSet` ä½¿ç”¨ `HashMap` å­˜å‚¨å…ƒç´ ï¼Œæ‰€æœ‰å­˜å‚¨åœ¨ `HashSet` çš„å…ƒç´ éƒ½ä½œä¸º `HashMap` çš„é”®ï¼ˆ`Key`ï¼‰ï¼Œå¯¹åº”çš„å€¼ï¼ˆ`Value`ï¼‰æ˜¯ä¸€ä¸ªå›ºå®šçš„å¸¸é‡å¯¹è±¡ï¼ˆ`PRESENT`ï¼‰ã€‚

- ç¤ºä¾‹ï¼ˆå†…éƒ¨å®ç°é€»è¾‘ï¼‰ï¼š

  ```java
  private static final Object PRESENT = new Object();
  private transient HashMap<E, Object> map;
  
  public boolean add(E e) {
      return map.put(e, PRESENT) == null;
  }
  ```

#### **2.3 HashMap çš„åº•å±‚ç»“æ„**

- `HashMap` ä½¿ç”¨ **æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘** å­˜å‚¨é”®å€¼å¯¹ã€‚
  - æ•°ç»„ï¼šç”¨æ¥å¿«é€Ÿå®šä½å­˜å‚¨æ¡¶ï¼ˆBucketï¼‰ã€‚
  - é“¾è¡¨ï¼šè§£å†³å“ˆå¸Œå†²çªï¼ˆå¤šä¸ªé”®æ˜ å°„åˆ°åŒä¸€ä¸ªæ¡¶æ—¶ï¼‰ã€‚
  - çº¢é»‘æ ‘ï¼šå½“å†²çªé“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤ 8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œæé«˜æŸ¥æ‰¾æ•ˆç‡ã€‚
- å…³é”®ç‚¹ï¼š
  - é”®ï¼ˆKeyï¼‰çš„å”¯ä¸€æ€§é€šè¿‡ `hashCode` å’Œ `equals` ä¿è¯ã€‚
  - å€¼ï¼ˆValueï¼‰å¯ä»¥é‡å¤ã€‚

------

### **3. ä½¿ç”¨åœºæ™¯åˆ†æ**

#### **3.1 HashSet**

- **å»é‡**ï¼šç”¨äºå­˜å‚¨å”¯ä¸€å…ƒç´ ï¼Œä¾‹å¦‚å»é™¤é‡å¤çš„é›†åˆæ•°æ®ã€‚

- **å¿«é€ŸæŸ¥æ‰¾**ï¼šå¯ä»¥é«˜æ•ˆåˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå…ƒç´ ã€‚

- ç¤ºä¾‹ï¼š

  ```java
  HashSet<String> set = new HashSet<>();
  set.add("A");
  set.add("B");
  set.add("A"); // æ— æ•ˆï¼ŒHashSet ä¿è¯å”¯ä¸€æ€§
  ```

#### **3.2 HashMap**

- **å­˜å‚¨é”®å€¼å¯¹**ï¼šç”¨äºå¿«é€ŸæŸ¥æ‰¾å€¼ï¼Œä¾‹å¦‚å®ç°ç¼“å­˜ã€‚

- **ç»Ÿè®¡è®¡æ•°**ï¼šå¯ä»¥é€šè¿‡é”®å€¼å¯¹å­˜å‚¨ç»Ÿè®¡æ•°æ®ï¼Œä¾‹å¦‚å•è¯é¢‘ç‡è®¡æ•°ã€‚

- ç¤ºä¾‹ï¼š

  ```java
  HashMap<String, Integer> map = new HashMap<>();
  map.put("A", 1);
  map.put("B", 2);
  map.put("A", 3); // é”® "A" çš„å€¼è¢«æ›´æ–°ä¸º 3
  ```

------

### **4. å…³é”®åŒºåˆ«æ€»ç»“**

| ç‰¹æ€§           | **HashSet**         | **HashMap**                  |
| -------------- | ------------------- | ---------------------------- |
| **ç”¨é€”**       | å­˜å‚¨å”¯ä¸€å…ƒç´         | å­˜å‚¨é”®å€¼å¯¹                   |
| **åº•å±‚å®ç°**   | åŸºäº `HashMap` å®ç° | åŸºäºæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘å®ç° |
| **å­˜å‚¨å†…å®¹**   | ä»…å­˜å‚¨é”®ï¼ˆKeyï¼‰     | å­˜å‚¨é”®ï¼ˆKeyï¼‰å’Œå€¼ï¼ˆValueï¼‰   |
| **é”®çš„å”¯ä¸€æ€§** | å…ƒç´ å”¯ä¸€            | é”®å”¯ä¸€ï¼Œå€¼å¯é‡å¤             |
| **çº¿ç¨‹å®‰å…¨æ€§** | å¦                  | å¦                           |

------

### **5. é¢è¯•é«˜é¢‘é—®é¢˜**

#### **5.1 ä¸ºä»€ä¹ˆ HashSet åŸºäº HashMap å®ç°ï¼Ÿ**

- `HashSet` åªéœ€è¦å­˜å‚¨å”¯ä¸€å…ƒç´ ï¼Œè€Œ `HashMap` çš„é”®ï¼ˆKeyï¼‰å·²ç»æ˜¯å”¯ä¸€çš„ã€‚
- å¤ç”¨ `HashMap` çš„å“ˆå¸Œè¡¨ç»“æ„ï¼Œå¯ä»¥é¿å…é‡æ–°å®ç°å¤æ‚çš„å“ˆå¸Œç®—æ³•å’Œå†²çªå¤„ç†é€»è¾‘ã€‚

#### **5.2 HashSet å’Œ HashMap çš„æ€§èƒ½å¦‚ä½•ï¼Ÿ**

- ä¸¤è€…æ€§èƒ½åŸºæœ¬ç›¸åŒï¼Œå› ä¸º `HashSet` å†…éƒ¨ä¾èµ–äº `HashMap`ã€‚
- åœ¨æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œä¸­ï¼Œæ—¶é—´å¤æ‚åº¦é€šå¸¸ä¸º **O(1)**ï¼ˆå“ˆå¸Œå†²çªå°‘çš„æƒ…å†µä¸‹ï¼‰ã€‚

#### **5.3 HashSet æ˜¯å¦å…è®¸ nullï¼ŸHashMap æ˜¯å¦å…è®¸ nullï¼Ÿ**

- **HashSet**ï¼šå…è®¸å­˜å‚¨ä¸€ä¸ª `null`ã€‚
- **HashMap**ï¼šå…è®¸ä¸€ä¸ª `null` é”®å’Œå¤šä¸ª `null` å€¼ã€‚

#### **5.4 HashSet å’Œ HashMap çš„çº¿ç¨‹å®‰å…¨æ€§å¦‚ä½•ï¼Ÿ**

- éƒ½æ˜¯ **éçº¿ç¨‹å®‰å…¨** çš„ã€‚
- åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ï¼š
  - `HashSet`ï¼šé€šè¿‡ `Collections.synchronizedSet` å®ç°çº¿ç¨‹å®‰å…¨ã€‚
  - `HashMap`ï¼šæ¨èä½¿ç”¨ `ConcurrentHashMap`ã€‚

------

### **6. æ€»ç»“å¤ä¹ **

- **æ ¸å¿ƒç‚¹**ï¼š
  - `HashSet` æ˜¯åŸºäº `HashMap` å®ç°çš„ï¼Œå†…éƒ¨é€šè¿‡ `HashMap` å­˜å‚¨å…ƒç´ ã€‚
  - `HashMap` æ˜¯ä¸€ä¸ªåº•å±‚ç»“æ„å¤æ‚ã€åŠŸèƒ½æ›´å¼ºå¤§çš„æ•°æ®ç»“æ„ï¼Œæ”¯æŒé”®å€¼å¯¹å­˜å‚¨ã€‚
- **é€‚ç”¨åœºæ™¯**ï¼š
  - ä½¿ç”¨ `HashSet` å­˜å‚¨å”¯ä¸€å€¼ã€‚
  - ä½¿ç”¨ `HashMap` å®ç°é”®å€¼å¯¹æ˜ å°„æˆ–æ•°æ®ç»Ÿè®¡ã€‚
- **é¢è¯•å…³é”®è¯**ï¼š
  1. åº•å±‚ç»“æ„ï¼šæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ã€‚
  2. å”¯ä¸€æ€§ï¼šé€šè¿‡ `hashCode` å’Œ `equals` ä¿è¯ã€‚
  3. çº¿ç¨‹å®‰å…¨ï¼šé»˜è®¤éçº¿ç¨‹å®‰å…¨ï¼Œéœ€ä½¿ç”¨åŒæ­¥åŒ…è£…ç±»æˆ–å¹¶å‘å®ç°ã€‚



## Java å¹¶å‘é›†åˆå¯¹æ¯”åˆ†æï¼šHashMapã€Hashtable ä¸ ConcurrentHashMap

![image-20250218105026792](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250218105026792.png)

### ğŸ” 1. æ¦‚è¿°

åœ¨ Java ä¸­ï¼Œ`HashMap`ã€`Hashtable` å’Œ `ConcurrentHashMap` éƒ½æ˜¯ `Map` æ¥å£çš„å®ç°ï¼Œä½†å®ƒä»¬åœ¨**çº¿ç¨‹å®‰å…¨æ€§**ã€**æ€§èƒ½**å’Œ**é€‚ç”¨åœºæ™¯**ä¸Šå­˜åœ¨æ˜¾è‘—åŒºåˆ«ã€‚

| âš¡ ç‰¹æ€§              | ğŸŸ¢ HashMap     | ğŸ”µ Hashtable                     | ğŸ”´ ConcurrentHashMap                     |
| ------------------- | ------------- | ------------------------------- | --------------------------------------- |
| ğŸ” çº¿ç¨‹å®‰å…¨          | âŒ ä¸å®‰å…¨      | âœ… å®‰å…¨ï¼ˆ`synchronized` å…¨å±€é”ï¼‰ | âœ… å®‰å…¨ï¼ˆCAS + `synchronized` ç»†ç²’åº¦é”ï¼‰ |
| ğŸ”„ åŒæ­¥æœºåˆ¶          | æ—             | `synchronized`                  | CAS + `synchronized`                    |
| âœ… å…è®¸ `null` é”®/å€¼ | âœ… å…è®¸ `null` | âŒ ä¸å…è®¸ `null`                 | âŒ ä¸å…è®¸ `null` é”®ï¼Œâœ… å…è®¸ `null` å€¼    |
| ğŸš€ æ€§èƒ½              | æœ€é«˜          | æœ€ä½                            | é«˜å¹¶å‘                                  |
| ğŸ“Œ é€‚ç”¨åœºæ™¯          | å•çº¿ç¨‹        | æ—§ä»£ç ç»´æŠ¤                      | é«˜å¹¶å‘åœºæ™¯                              |

------

### ğŸ“Œ 2. HashMap è¯¦è§£

- **ğŸ› ï¸ åº•å±‚æ•°æ®ç»“æ„**ï¼šæ•°ç»„ + é“¾è¡¨ï¼ˆJDK 1.8 ä»¥åï¼Œå½“é“¾è¡¨é•¿åº¦è¶…è¿‡ 8 æ—¶è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼‰
- **âš ï¸ çº¿ç¨‹ä¸å®‰å…¨**ï¼šå¤šçº¿ç¨‹ä¸‹ `put/get` å¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´
- **âœ… é€‚ç”¨åœºæ™¯**ï¼šå•çº¿ç¨‹ç¯å¢ƒï¼Œä¾‹å¦‚ä¸´æ—¶æ•°æ®ç¼“å­˜ã€éå¹¶å‘æ•°æ®å­˜å‚¨

ç¤ºä¾‹ä»£ç ï¼š

```java
Map<String, Integer> map = new HashMap<>();
map.put("key", 1);
System.out.println(map.get("key"));
```

------

### ğŸ“Œ 3. Hashtable è¯¦è§£

- **ğŸ› ï¸ åº•å±‚æ•°æ®ç»“æ„**ï¼šæ•°ç»„ + é“¾è¡¨
- **ğŸ” çº¿ç¨‹å®‰å…¨ä½†æ€§èƒ½ä½**ï¼šä½¿ç”¨ `synchronized` é”ä½å…¨éƒ¨æ“ä½œï¼Œå¯¼è‡´çº¿ç¨‹é˜»å¡
- **âœ… é€‚ç”¨åœºæ™¯**ï¼šæ—©æœŸ Java ä»£ç ï¼Œè¾ƒå°‘ä½¿ç”¨

ç¤ºä¾‹ä»£ç ï¼š

```java
Map<String, Integer> table = new Hashtable<>();
table.put("key", 1);
System.out.println(table.get("key"));
```

------

### ğŸ“Œ 4. ConcurrentHashMap è¯¦è§£

#### ğŸ”„ JDK 1.7 ä¸ JDK 1.8 å®ç°å¯¹æ¯”

| ğŸ·ï¸ ç‰ˆæœ¬  | ğŸ” åº•å±‚ç»“æ„                | ğŸ”„ å¹¶å‘æœºåˆ¶                        |
| ------- | ------------------------- | --------------------------------- |
| JDK 1.7 | `Segment[] + HashEntry[]` | **åˆ†æ®µé”** (`ReentrantLock`)      |
| JDK 1.8 | `Node[] + é“¾è¡¨ + çº¢é»‘æ ‘`  | **CAS + `synchronized` + çº¢é»‘æ ‘** |

#### âš¡ JDK 1.8 å…³é”®ä¼˜åŒ–ç‚¹

1. **ğŸš€ ç§»é™¤ `Segment`**ï¼Œå‡å°‘å†…å­˜æ¶ˆè€—ï¼Œæé«˜æ‰©å®¹æ•ˆç‡ã€‚
2. **ğŸ”„ CASï¼ˆCompare-And-Swapï¼‰æ“ä½œ**ï¼Œé¿å…å…¨å±€é”ï¼Œæé«˜å¹¶å‘èƒ½åŠ›ã€‚
3. **ğŸ” æ›´ç²¾ç»†çš„é”æœºåˆ¶**ï¼Œåªé”å®šç‰¹å®š `Node`ï¼Œè€Œéæ•´ä¸ª `Map`ï¼Œå‡å°‘é”å†²çªã€‚
4. **ğŸŒ³ çº¢é»‘æ ‘ä¼˜åŒ–**ï¼Œåœ¨é“¾è¡¨é•¿åº¦è¶…è¿‡ 8 æ—¶è‡ªåŠ¨è½¬æ¢ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚

#### ğŸŒ³ çº¢é»‘æ ‘è¯¦è§£

çº¢é»‘æ ‘ï¼ˆRed-Black Treeï¼‰æ˜¯ä¸€ç§**è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘**ï¼Œå…¶ç‰¹ç‚¹åŒ…æ‹¬ï¼š

- ğŸ”´ **èŠ‚ç‚¹é¢œè‰²**ï¼šæ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ˜¯çº¢è‰²ï¼Œè¦ä¹ˆæ˜¯é»‘è‰²ã€‚
- âš« **æ ¹èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²**ã€‚
- âŒ **çº¢è‰²èŠ‚ç‚¹ä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²å­èŠ‚ç‚¹**ã€‚
- ğŸ—ï¸ **ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„ä¸Šï¼Œé»‘è‰²èŠ‚ç‚¹æ•°é‡å¿…é¡»ç›¸åŒ**ã€‚
- ğŸ”„ **æ’å…¥å’Œåˆ é™¤æ“ä½œåï¼Œæ ‘ä¼šè¿›è¡Œé¢œè‰²è°ƒæ•´å’Œæ—‹è½¬ï¼Œä»¥ä¿æŒå¹³è¡¡ã€‚**

åœ¨ `ConcurrentHashMap` ä¸­ï¼Œçº¢é»‘æ ‘çš„ä¸»è¦ä½œç”¨æ˜¯**åœ¨å“ˆå¸Œå†²çªè¾ƒå¤šæ—¶ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡**ï¼š

- **å½“é“¾è¡¨é•¿åº¦è¶…è¿‡ 8**ï¼Œä¼šè‡ªåŠ¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä½¿æŸ¥è¯¢å¤æ‚åº¦ç”± O(n) é™ä½åˆ° O(log n)ã€‚
- **å¦‚æœæ‰©å®¹åå†²çªå‡å°‘ï¼Œçº¢é»‘æ ‘å¯èƒ½ä¼šé€€åŒ–å›é“¾è¡¨**ï¼Œä»¥å‡å°‘ç©ºé—´æ¶ˆè€—ã€‚

ç¤ºä¾‹ä»£ç ï¼š

```java
TreeMap<Integer, String> treeMap = new TreeMap<>();
treeMap.put(1, "A");
treeMap.put(2, "B");
System.out.println(treeMap.get(1));
```

------

### ğŸ“Œ 5. ç»“è®º

1. **âœ… å•çº¿ç¨‹ç¯å¢ƒå»ºè®®ä½¿ç”¨ `HashMap`**ï¼Œæ€§èƒ½æœ€é«˜ã€‚
2. **âš ï¸ `Hashtable` å·²è¿‡æ—¶ï¼Œå»ºè®®ä½¿ç”¨ `ConcurrentHashMap` ä»£æ›¿ã€‚**
3. **ğŸ”„ é«˜å¹¶å‘ç¯å¢ƒå»ºè®®ä½¿ç”¨ `ConcurrentHashMap`**ï¼Œé¿å…å…¨å±€é”ï¼Œæé«˜æ€§èƒ½ã€‚

------

## ConcurrentHashMapåœ¨java7å’Œjava8çš„åŒºåˆ«

![image-20250213160054153](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250213160054153.png)

1.7ä¸­

![image-20250213160113751](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250213160113751.png)

**1.8ä¸­**

![image-20250213160306289](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250213160306289.png)

### æ‰©å®¹æœºåˆ¶çš„åŒºåˆ«



# Mybatis

## åœ¨ MyBatis ä¸­ï¼Œ#{} å’Œ ${} çš„åŒºåˆ«ï¼Ÿ

###   å›ç­”é‡ç‚¹

åœ¨ MyBatis ä¸­ï¼Œ`#{} å’Œ ${}` çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1. **SQL å‚æ•°å¤„ç†æ–¹å¼**ï¼š
   - `#{}ï¼š` é¢„ç¼–è¯‘æ–¹å¼ï¼Œä½¿ç”¨å ä½ç¬¦ `?`ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢ SQL æ³¨å…¥ã€‚
   - `${}`ï¼šç›´æ¥å°†å˜é‡çš„å€¼æ‹¼æ¥åˆ° SQL è¯­å¥ä¸­ï¼Œå¯èƒ½å­˜åœ¨ SQL æ³¨å…¥é£é™©ã€‚
2. **ä½¿ç”¨åœºæ™¯**ï¼š
   - `#{}ï¼š` ç”¨äºä¼ é€’å‚æ•°å€¼ï¼ˆå®‰å…¨ä¼˜å…ˆï¼‰ã€‚
   - `${}`ï¼šç”¨äºåŠ¨æ€æ‹¼æ¥ SQL è¯­å¥ï¼ˆå¦‚è¡¨åã€åˆ—åç­‰ï¼‰ã€‚
3. **æ€§èƒ½ä¸å®‰å…¨**ï¼š
   - `#{}ï¼š` ç”±äºå‚æ•°ç»‘å®šæ˜¯åœ¨é¢„ç¼–è¯‘æ—¶å®Œæˆçš„ï¼Œæ€§èƒ½å’Œå®‰å…¨æ€§æ›´é«˜ã€‚
   - `${}`ï¼šç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œæ˜“è¢«æ¶æ„æ³¨å…¥æ”»å‡»ï¼Œä¸å»ºè®®ç”¨äºç”¨æˆ·è¾“å…¥çš„å€¼ã€‚

------

### è¯¦ç»†è§£æ

#### 1. `#{} çš„å·¥ä½œæœºåˆ¶`

å½“ä½¿ç”¨ `#{} æ—¶ï¼ŒMyBatis ä¼šï¼š

- å°† `#{}` å†…çš„å‚æ•°è½¬æ¢ä¸º SQL è¯­å¥ä¸­çš„ `?`ã€‚
- åœ¨æ‰§è¡Œæ—¶ï¼Œé€šè¿‡ PreparedStatement å¯¹å‚æ•°è¿›è¡Œç»‘å®šã€‚

**ç¤ºä¾‹**ï¼š

```xml
<select id="selectById" parameterType="int" resultType="User">
  SELECT * FROM user WHERE id = #{id}
</select>
```

ç”Ÿæˆçš„ SQLï¼š

```sql
SELECT * FROM user WHERE id = ?
```

#### 2. `${}` çš„å·¥ä½œæœºåˆ¶

å½“ä½¿ç”¨ `${}` æ—¶ï¼ŒMyBatis ä¼šï¼š

- ç›´æ¥å°†å‚æ•°å€¼æ›¿æ¢åˆ° SQL è¯­å¥ä¸­ã€‚

**ç¤ºä¾‹**ï¼š

```xml
<select id="selectByColumn" parameterType="map" resultType="User">
  SELECT * FROM user WHERE ${column} = #{value}
</select>
```

å‡å¦‚å‚æ•°ä¸º `column="username"` å’Œ `value="John"`ï¼Œç”Ÿæˆçš„ SQLï¼š

```sql
SELECT * FROM user WHERE username = ?
```

#### 3. SQL æ³¨å…¥é£é™©

ç”±äº `${}` ä¼šç›´æ¥æ‹¼æ¥åˆ° SQL ä¸­ï¼Œå¦‚æœå‚æ•°æ¥è‡ªç”¨æˆ·è¾“å…¥è€Œæœªåšä¸¥æ ¼æ ¡éªŒï¼Œå¯èƒ½ä¼šå¯¼è‡´ SQL æ³¨å…¥æ”»å‡»ã€‚ä¾‹å¦‚ï¼š

```xml
<select id="deleteByCondition">
  DELETE FROM user WHERE ${condition}
</select>
```

ä¼ å…¥ `condition="1=1; DROP TABLE user"` æ—¶ï¼Œç”Ÿæˆçš„ SQLï¼š

```sql
DELETE FROM user WHERE 1=1; DROP TABLE user
```

è¿™æ˜¯éå¸¸å±é™©çš„ã€‚

#### 4. åŠ¨æ€ SQL çš„åº”ç”¨åœºæ™¯

å¯¹äºåŠ¨æ€ SQLï¼Œä¾‹å¦‚åŠ¨æ€æ‹¼æ¥è¡¨åæˆ–åˆ—åï¼Œå¿…é¡»ä½¿ç”¨ `${}`ï¼Œå› ä¸º `#{} ä¸æ”¯æŒè¡¨åæˆ–åˆ—åçš„åŠ¨æ€æ›¿æ¢ã€‚ä¾‹å¦‚ï¼š

```xml
<select id="selectDynamicTable" resultType="User">
  SELECT * FROM ${tableName} WHERE id = #{id}
</select>
```

æ­¤æ—¶çš„mapperçš„å†™æ³•

```java
  /**
     * æŸ¥è¯¢åŠ¨æ€è¡¨çš„æ•°æ®
     * @param tableName è¡¨å
     * @param id ä¸»é”® ID
     * @return æŸ¥è¯¢ç»“æœï¼ˆå¯ä»¥æ˜¯å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯ Mapï¼Œæ ¹æ®éœ€è¦å®šä¹‰è¿”å›å€¼ç±»å‹ï¼‰
     */
    Map<String, Object> selectDynamicTable(@Param("tableName") String tableName, @Param("id") Long id);
}
```



------

### çŸ¥è¯†æ‰©å±•

#### 1. å®‰å…¨æ€§å¯¹æ¯”

| ç‰¹æ€§         | `#{} (å®‰å…¨)` | `${} (ä¸å®‰å…¨)`    |
| ------------ | ------------ | ----------------- |
| é¢„ç¼–è¯‘       | æ˜¯           | å¦                |
| SQL æ³¨å…¥é£é™© | æ—            | é«˜                |
| ä½¿ç”¨åœºæ™¯     | ä¼ é€’å‚æ•°å€¼   | åŠ¨æ€æ‹¼æ¥è¡¨å/åˆ—å |

#### 2. ä¼˜åŒ–å»ºè®®

1. **ä¼˜å…ˆä½¿ç”¨ `#{}`**ï¼Œé¿å… SQL æ³¨å…¥é£é™©ã€‚
2. **åŠ¨æ€ SQL åœºæ™¯æ ¡éªŒè¾“å…¥**ï¼šå½“å¿…é¡»ä½¿ç”¨ `${}` æ—¶ï¼ŒåŠ¡å¿…å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼æ ¡éªŒï¼Œé¿å…æ‹¼æ¥æ¶æ„æ•°æ®ã€‚
3. **ä½¿ç”¨æ¡†æ¶æä¾›çš„å·¥å…·**ï¼šå¦‚ MyBatis åŠ¨æ€ SQL æ ‡ç­¾ `<if>ã€<choose>` ç­‰ï¼Œæ›¿ä»£ç›´æ¥æ‹¼æ¥ã€‚

#### 3. åŠ¨æ€ SQL æ ‡ç­¾ç¤ºä¾‹

```xml
<select id="findUserByCondition" parameterType="map" resultType="User">
  SELECT * FROM user
  <where>
    <if test="name != null"> AND name = #{name}</if>
    <if test="age != null"> AND age = #{age}</if>
  </where>
</select>
```

------

### æ€»ç»“

1. `#{}` å’Œ `${}` åŒºåˆ«ï¼š
   - `#{}` å®‰å…¨ï¼Œé¢„ç¼–è¯‘ï¼Œä¼ é€’å‚æ•°å€¼ã€‚
   - `${}` çµæ´»ï¼Œç›´æ¥æ‹¼æ¥ï¼Œå­˜åœ¨é£é™©ã€‚
2. **å»ºè®®ä¼˜å…ˆä½¿ç”¨ `#{}`ï¼Œä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨ `${}`ã€‚**

# JUC

![img](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/java-concurrent-overview-1.png)

## ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿå’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿjavaä¸­æ”¯æŒåç¨‹å—

![image-20250109140053377](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109140053377.png)

### åç¨‹çš„ç‰¹ç‚¹

- **è½»é‡çº§**ï¼šå‡å°‘äº†çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ï¼Œé¿å…äº†å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´åˆ‡æ¢çš„æ—¶é—´æˆæœ¬
- **éæŠ¢å å¼è°ƒåº¦**
- **å¼‚æ­¥åŒ–ç¼–æ’**

![image-20250109140139540](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109140139540.png)

### å’Œçº¿ç¨‹çš„åŒºåˆ«

![image-20250109140321588](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109140321588.png)

## javaä¸­å¦‚ä½•åˆ›å»ºå¤šçº¿ç¨‹

## è¿›ç¨‹çš„å‡ ç§çŠ¶æ€

**æ–°å»ºã€å°±ç»ªã€è¿è¡Œã€é˜»å¡ã€ç»ˆæ­¢**

![image-20250109142500914](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109142500914.png)

## çº¿ç¨‹æ± çš„ä¸ƒä¸ªå‚æ•°

![image-20250220165746720](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250220165746720.png)

https://www.cnblogs.com/vipstone/p/15983907.htmlè¯¦ç»†åšå®¢é“¾æ¥

## å¹¶å‘ä¸‰è¦ç´ 

- åŸå­æ€§ ï¼š**è¿›ç¨‹çš„åˆ‡æ¢å¯¼è‡´äº†åŸå­æ€§çš„é—®é¢˜**
- å¯è§æ€§ï¼š**CPUå­˜åœ¨ç¼“å­˜å¯¼è‡´äº†å¼•å‡ºå¯è§æ€§çš„é—®é¢˜**
- æœ‰åºæ€§

![image-20250109142840594](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109142840594.png)

![image-20250109142915097](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109142915097.png)

![image-20250109142932419](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109142932419.png)

**æœ‰åºæ€§**ï¼Œjvmä¼šä¼˜åŒ–æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåº

![image-20250109143356270](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250109143356270.png)

# è®¾è®¡æ¨¡å¼

## ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ

- è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§é€šç”¨çš„ä»£ç ç¼–ç¨‹æ‰‹æ®µï¼Œåˆé€‚çš„åœºæ™¯ç”¨ä¸Šåˆé€‚çš„è®¾è®¡æ¨¡å¼ï¼Œ**å¯ä»¥å¢å¼ºä»£ç çš„çµæ´»æ€§ã€å¯ç»´æŠ¤æ€§ã€è¿˜æœ‰å¯æ‰©å±•æ€§**

**ç»“æ„å‹**ï¼šè§£å†³ç±»ä¸ç±»ä¹‹é—´æ­å»ºæ›´å¤§çš„ç§¯æœ¨äº§ç”Ÿçš„å´©å¡Œé—®é¢˜

## è®¾è®¡æ¨¡å¼åˆ†ä¸ºå“ªä¸‰ç±»

å…³é”®è¯ï¼šåˆ›å»ºã€ç»“æ„ã€è¡Œä¸º

![image-20250114163004851](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250114163004851.png)

## ä»€ä¹ˆæ˜¯ç­–ç•¥æ¨¡å¼ï¼Ÿ

![image-20250114162446726](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250114162446726.png)

ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°†å®ƒä»¬å°è£…èµ·æ¥ï¼Œå¹¶ä½¿å®ƒä»¬å¯ä»¥äº’ç›¸æ›¿æ¢ï¼Œä»è€Œä½¿ç®—æ³•çš„å˜åŒ–ä¸ä¼šå½±å“åˆ°ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ä»£ç ã€‚

### å›ç­”é‡ç‚¹

1. **æ ¸å¿ƒæ¦‚å¿µ**ï¼šç­–ç•¥æ¨¡å¼é€šè¿‡å°†ç®—æ³•å°è£…åˆ°ç‹¬ç«‹çš„ç±»ä¸­ï¼Œä½¿å¾—å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°é€‰æ‹©åˆé€‚çš„ç®—æ³•ã€‚
2. **å‚ä¸è§’è‰²**ï¼š
   - **æŠ½è±¡ç­–ç•¥ï¼ˆStrategyï¼‰**ï¼šå®šä¹‰ç®—æ³•çš„æ¥å£ã€‚
   - **å…·ä½“ç­–ç•¥ï¼ˆConcreteStrategyï¼‰**ï¼šå®ç°ç®—æ³•çš„ä¸åŒç‰ˆæœ¬ã€‚
   - **ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰**ï¼šä½¿ç”¨ç­–ç•¥çš„ç¯å¢ƒï¼Œç»´æŠ¤å¯¹ç­–ç•¥å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶è´Ÿè´£ä¸ç­–ç•¥çš„äº¤äº’ã€‚
3. **åº”ç”¨åœºæ™¯**ï¼š
   - ç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å¤šä¸ªç®—æ³•ä¹‹é—´åˆ‡æ¢ã€‚
   - å„ç§ç®—æ³•çš„é€»è¾‘æ˜¯ç‹¬ç«‹çš„ï¼Œå¹¶ä¸”å¯èƒ½ç»å¸¸å˜åŒ–ã€‚
   - éœ€è¦é¿å…åœ¨ç±»ä¸­ä½¿ç”¨å¤šä¸ªæ¡ä»¶è¯­å¥æ¥é€‰æ‹©ç®—æ³•ã€‚

------

### è¯¦ç»†è§£æ

**ç¤ºä¾‹ä»£ç **ï¼ˆä»¥æŠ˜æ‰£è®¡ç®—ä¸ºä¾‹ï¼‰ï¼š
 å‡è®¾ä¸€ä¸ªç”µå•†ç³»ç»Ÿæ ¹æ®ä¸åŒç”¨æˆ·ç±»å‹ï¼ˆæ™®é€šç”¨æˆ·ã€ä¼šå‘˜ç”¨æˆ·ã€VIPç”¨æˆ·ï¼‰æä¾›ä¸åŒçš„æŠ˜æ‰£ç­–ç•¥ã€‚

```java
// æŠ½è±¡ç­–ç•¥
public interface DiscountStrategy {
    double calculateDiscount(double amount);
}

// å…·ä½“ç­–ç•¥
public class NoDiscountStrategy implements DiscountStrategy {
    @Override
    public double calculateDiscount(double amount) {
        return amount;
    }
}

public class MemberDiscountStrategy implements DiscountStrategy {
    @Override
    public double calculateDiscount(double amount) {
        return amount * 0.9;
    }
}

public class VIPDiscountStrategy implements DiscountStrategy {
    @Override
    public double calculateDiscount(double amount) {
        return amount * 0.8;
    }
}

// ä¸Šä¸‹æ–‡
public class ShoppingCart {
    private DiscountStrategy discountStrategy;

    public ShoppingCart(DiscountStrategy discountStrategy) {
        this.discountStrategy = discountStrategy;
    }

    public double calculateFinalAmount(double amount) {
        return discountStrategy.calculateDiscount(amount);
    }

    public void setDiscountStrategy(DiscountStrategy discountStrategy) {
        this.discountStrategy = discountStrategy;
    }
}

// æµ‹è¯•
public class StrategyPatternDemo {
    public static void main(String[] args) {
        //æŒ‡å®šä¸Šä¸‹æ–‡
        ShoppingCart cart = new ShoppingCart(new NoDiscountStrategy());
        System.out.println("Final Amount: " + cart.calculateFinalAmount(100));
		
        //æŒ‡å®šä¸Šä¸‹æ–‡ä¸ºä¼šå‘˜ç”¨æˆ·
        cart.setDiscountStrategy(new MemberDiscountStrategy());
        System.out.println("Final Amount: " + cart.calculateFinalAmount(100));
		
        //æŒ‡å®šä¸Šä¸‹é—®ä½¿ç”¨VIPç”¨æˆ·çš„ç­–ç•¥
        cart.setDiscountStrategy(new VIPDiscountStrategy());
        System.out.println("Final Amount: " + cart.calculateFinalAmount(100));
    }
}
```

**è¿è¡Œç»“æœ**ï¼š

```
Final Amount: 100.0
Final Amount: 90.0
Final Amount: 80.0
```

------

### çŸ¥è¯†æ‰©å±•

1. **ä¼˜ç‚¹**ï¼š
   - **å¼€é—­åŸåˆ™**ï¼šå¢åŠ æ–°ç­–ç•¥æ—¶æ— éœ€ä¿®æ”¹ä¸Šä¸‹æ–‡ä»£ç ã€‚
   - **ä»£ç æ¸…æ™°**ï¼šé¿å…äº†å†—é•¿çš„æ¡ä»¶è¯­å¥ã€‚
   - **æé«˜çµæ´»æ€§**ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ›´æ”¹ç­–ç•¥ã€‚
2. **ç¼ºç‚¹**ï¼š
   - ç­–ç•¥ç±»æ•°é‡å¯èƒ½è¿‡å¤šï¼Œå¯¼è‡´ä»£ç å¤æ‚åº¦å¢åŠ ã€‚
   - å®¢æˆ·ç«¯éœ€è¦äº†è§£ä¸åŒç­–ç•¥çš„è¡Œä¸ºã€‚
3. **å®é™…åº”ç”¨**ï¼š
   - æ”¯ä»˜æ–¹å¼é€‰æ‹©ï¼ˆæ”¯ä»˜å®ã€å¾®ä¿¡ã€é“¶è¡Œå¡ç­‰ï¼‰ã€‚
   - æ’åºç®—æ³•åˆ‡æ¢ï¼ˆå¿«é€Ÿæ’åºã€å½’å¹¶æ’åºç­‰ï¼‰ã€‚
   - æ—¥å¿—ç­–ç•¥ï¼ˆæ§åˆ¶å°æ—¥å¿—ã€æ–‡ä»¶æ—¥å¿—ç­‰ï¼‰ã€‚

------

### æ€»ç»“

![image-20250114162613592](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250114162613592.png)

ç­–ç•¥æ¨¡å¼é€šè¿‡å°†ç®—æ³•æˆ–è¡Œä¸ºå°è£…åˆ°ç‹¬ç«‹çš„ç±»ä¸­ï¼Œæä¾›äº†çµæ´»ã€å¯æ‰©å±•çš„è§£å†³æ–¹æ¡ˆï¼Œé€‚åˆéœ€è¦åŠ¨æ€åˆ‡æ¢æˆ–å¢åŠ ç®—æ³•çš„åœºæ™¯ã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ—¶éœ€è¦æ³¨æ„ç­–ç•¥ç±»çš„æ•°é‡å¢é•¿å¯èƒ½å¸¦æ¥çš„å¤æ‚æ€§ã€‚

------

### ç›¸å…³é¢è¯•é¢˜

1. **ä¸ºä»€ä¹ˆç­–ç•¥æ¨¡å¼æ¯”æ¡ä»¶è¯­å¥æ›´ä¼˜é›…ï¼Ÿ**
2. **åœ¨ç­–ç•¥æ¨¡å¼ä¸­å¦‚ä½•é¿å…ç­–ç•¥ç±»è¿‡å¤šçš„é—®é¢˜ï¼Ÿ**
3. **ç­–ç•¥æ¨¡å¼å’Œå·¥å‚æ¨¡å¼çš„åŒºåˆ«å’Œè”ç³»æ˜¯ä»€ä¹ˆï¼Ÿ**
4. **åœ¨Javaä¸­ï¼Œç­–ç•¥æ¨¡å¼å¦‚ä½•ä¸Lambdaè¡¨è¾¾å¼ç»“åˆä½¿ç”¨ï¼Ÿ**

## ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿ

**å•ä¾‹æ¨¡å¼**æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œ è®©ä½ èƒ½å¤Ÿä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œ å¹¶æä¾›ä¸€ä¸ªè®¿é—®è¯¥å®ä¾‹çš„å…¨å±€èŠ‚ç‚¹ã€‚

![image-20250114164137625](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250114164137625.png)

### å•ä¾‹æ¨¡å¼çš„ä¼˜ç¼ºç‚¹

![image-20250114164315335](https://raw.githubusercontent.com/xiechen274/ChenCsNote/images/images/image-20250114164315335.png)

### è§£å†³å¤šçº¿ç¨‹æ¨¡å¼ä¸‹çš„å•ä¾‹é‡å¤åˆ›å»º

åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å®ç°å•ä¾‹æ¨¡å¼æ—¶ï¼Œéœ€è¦ç¡®ä¿å•ä¾‹å®ä¾‹çš„åˆ›å»ºè¿‡ç¨‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºäº **åŒé‡æ£€æŸ¥é”å®šï¼ˆDouble-Checked Lockingï¼‰** çš„çº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼ç¤ºä¾‹ï¼Œè¿™æ˜¯å¸¸è§çš„é«˜æ•ˆå®ç°æ–¹å¼ã€‚

#### åŒé‡æ£€æŸ¥é”å®šçš„å•ä¾‹æ¨¡å¼ç¤ºä¾‹

```java
public class Singleton {
    // ä½¿ç”¨ volatile å…³é”®å­—ç¡®ä¿å˜é‡çš„å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’åº
    private static volatile Singleton instance;

    // ç§æœ‰æ„é€ å‡½æ•°ï¼Œé˜²æ­¢å¤–éƒ¨å®ä¾‹åŒ–
    private Singleton() {
        System.out.println("å•ä¾‹å®ä¾‹è¢«åˆ›å»º");
    }

    // æä¾›å…¨å±€è®¿é—®ç‚¹
    public static Singleton getInstance() {
        if (instance == null) { // ç¬¬ä¸€æ¬¡æ£€æŸ¥
            synchronized (Singleton.class) {
                if (instance == null) { // ç¬¬äºŒæ¬¡æ£€æŸ¥
                    instance = new Singleton();
                }
            }
        }
        return instance;
    }

    // æµ‹è¯•æ–¹æ³•
    public void doSomething() {
        System.out.println("å•ä¾‹æ–¹æ³•æ‰§è¡Œ");
    }
}

// æµ‹è¯•ç±»
public class SingletonTest {
    public static void main(String[] args) {
        // å¯åŠ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–å•ä¾‹å®ä¾‹
        Runnable task = () -> {
            Singleton singleton = Singleton.getInstance();
            singleton.doSomething();
        };

        Thread thread1 = new Thread(task);
        Thread thread2 = new Thread(task);
        Thread thread3 = new Thread(task);

        thread1.start();
        thread2.start();
        thread3.start();
    }
}
```

#### ä»£ç è¯´æ˜

1. **`volatile` å…³é”®å­—**
    ç¡®ä¿ `instance` åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¯è§ï¼ŒåŒæ—¶ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œé¿å…åˆå§‹åŒ–è¿‡ç¨‹ä¸­æœªå®Œæˆå°±è¢«è¯»å–çš„é—®é¢˜ã€‚
2. **åŒé‡æ£€æŸ¥é”å®š**
   - ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼šé¿å…æ— æ„ä¹‰çš„åŒæ­¥ï¼Œæå‡æ€§èƒ½ã€‚
   - ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼šç¡®ä¿åœ¨ `synchronized` å—å†…ä¹Ÿä¸ä¼šé‡å¤åˆ›å»ºå®ä¾‹ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚
3. **`synchronized` å—**
    åªåœ¨å®ä¾‹æœªåˆ›å»ºæ—¶è¿›å…¥åŒæ­¥å—ï¼Œç¡®ä¿æ€§èƒ½æŸè€—æœ€å°åŒ–ã€‚
4. **çº¿ç¨‹å®‰å…¨æµ‹è¯•**
    åœ¨æµ‹è¯•ç±»ä¸­é€šè¿‡å¤šä¸ªçº¿ç¨‹å¹¶å‘è°ƒç”¨ `getInstance`ï¼ŒéªŒè¯å•ä¾‹æ¨¡å¼çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚

#### è¾“å‡ºç¤ºä¾‹ï¼ˆå¯èƒ½ç•¥æœ‰ä¸åŒï¼Œå–å†³äºçº¿ç¨‹è°ƒåº¦ï¼‰ï¼š

```
å•ä¾‹å®ä¾‹è¢«åˆ›å»º
å•ä¾‹æ–¹æ³•æ‰§è¡Œ
å•ä¾‹æ–¹æ³•æ‰§è¡Œ
å•ä¾‹æ–¹æ³•æ‰§è¡Œ
```

#### ä¼˜ç‚¹

1. **çº¿ç¨‹å®‰å…¨**ï¼šä½¿ç”¨ `synchronized` å’Œ `volatile` ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚
2. **é«˜æ•ˆ**ï¼šåŒé‡æ£€æŸ¥é”å®šé¿å…æ¯æ¬¡è·å–å®ä¾‹æ—¶çš„åŒæ­¥æ“ä½œï¼Œæ€§èƒ½æ›´ä¼˜ã€‚
3. **æ‡’åŠ è½½**ï¼šåªæœ‰åœ¨é¦–æ¬¡è°ƒç”¨ `getInstance` æ—¶æ‰ä¼šåˆ›å»ºå®ä¾‹ï¼ŒèŠ‚çœèµ„æºã€‚

#### ç¼ºç‚¹

1. å®ç°ç¨å¾®å¤æ‚ï¼Œéœ€è¦ç†è§£ `volatile` å’ŒæŒ‡ä»¤é‡æ’åºé—®é¢˜ã€‚
2. å¦‚æœç³»ç»Ÿå¯¹æ€§èƒ½è¦æ±‚æé«˜ï¼Œå¯ä»¥è€ƒè™‘å…¶ä»–æ–¹å¼ï¼Œå¦‚é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹ã€‚

#### é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹çš„æ›¿ä»£æ–¹å¼ï¼ˆæ›´ç®€å•çš„çº¿ç¨‹å®‰å…¨å®ç°ï¼‰

```java
public class Singleton {
    // é™æ€å†…éƒ¨ç±»
    private static class SingletonHolder {
        private static final Singleton INSTANCE = new Singleton();
    }

    // ç§æœ‰æ„é€ å‡½æ•°
    private Singleton() {
        System.out.println("å•ä¾‹å®ä¾‹è¢«åˆ›å»º");
    }

    // æä¾›å…¨å±€è®¿é—®ç‚¹
    public static Singleton getInstance() {
        return SingletonHolder.INSTANCE;
    }
}
```

è¿™ç§æ–¹å¼åŸºäºç±»åŠ è½½æœºåˆ¶ï¼Œçº¿ç¨‹å®‰å…¨ä¸”ç®€å•ï¼Œæ— éœ€æ˜¾å¼åŒæ­¥ã€‚